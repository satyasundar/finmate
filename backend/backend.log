2025-07-14 03:57:59,091 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 03:57:59,092 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 03:57:59,092 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}], 'validated_query': None}
2025-07-14 03:57:59,154 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11b782a50> default_metadata=() model_kwargs={}
2025-07-14 03:57:59,178 - graph - INFO - 1.Planning Node entered...
2025-07-14 03:57:59,178 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 03:57:59,179 - graph - INFO - 2.Validation Node entered...
2025-07-14 03:58:01,820 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 03:58:01,821 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 03:58:01,821 - graph - INFO - Merged final_query: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 03:58:01,821 - graph - WARNING - Missing required fields: bank or month or account_no
2025-07-14 03:58:01,821 - graph - INFO - Start routing logic
2025-07-14 03:58:01,821 - graph - INFO - Validated Query Check: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: ['bank', 'month', 'account_no']
2025-07-14 03:58:01,822 - graph - INFO - üîÅ Clarify Node: Asking user to fill missing fields.
2025-07-14 03:58:01,822 - graph - INFO - Current state at start of Clarify Node 
{'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='076df82e-76c5-459b-a641-98433be0acf3'), AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ac27b27b-4fa5-4cb7-a6f9-26665500ec61'), AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='21874422-1394-4450-aef1-b17dfeb279b0')], 'plan': "<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'), 'confirmed': False}

2025-07-14 03:58:01,822 - graph - INFO - q from state: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 03:58:01,825 - main - INFO - === FINAL STATE ===
{'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='076df82e-76c5-459b-a641-98433be0acf3'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ac27b27b-4fa5-4cb7-a6f9-26665500ec61'),
              AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='21874422-1394-4450-aef1-b17dfeb279b0'),
              AIMessage(content=' To proceed, could you specify your bank and month and account_number?', additional_kwargs={}, response_metadata={}, id='cf123dea-ca72-4534-82f7-5c684bdff9bb')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 04:41:54,607 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 04:41:54,609 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 04:41:54,609 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}], 'validated_query': None}
2025-07-14 04:41:54,675 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x112bcaa50> default_metadata=() model_kwargs={}
2025-07-14 04:41:54,702 - graph - INFO - 1.Planning Node entered...
2025-07-14 04:41:54,702 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 04:41:54,703 - graph - INFO - 2.Validation Node entered...
2025-07-14 04:41:56,986 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 04:41:56,987 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 04:41:56,987 - graph - INFO - Merged final_query: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 04:41:56,987 - graph - WARNING - Missing required fields: bank or month or account_no
2025-07-14 04:41:56,987 - graph - INFO - Start routing logic
2025-07-14 04:41:56,987 - graph - INFO - Validated Query Check: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: ['bank', 'month', 'account_no']
2025-07-14 04:41:56,988 - graph - INFO - üîÅ Clarify Node: Asking user to fill missing fields.
2025-07-14 04:41:56,988 - graph - INFO - Current state at start of Clarify Node 
{'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='80163aa5-3c2f-4501-992a-377571aa0d94'), AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='7f9531d6-f862-4929-b39b-b555467b5ea4'), AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='81d4b25d-334f-47f2-945c-13a2879101b6')], 'plan': "<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'), 'confirmed': False}

2025-07-14 04:41:56,988 - graph - INFO - q from state: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 04:41:56,990 - main - INFO - === FINAL STATE ===
{'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='80163aa5-3c2f-4501-992a-377571aa0d94'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='7f9531d6-f862-4929-b39b-b555467b5ea4'),
              AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='81d4b25d-334f-47f2-945c-13a2879101b6'),
              AIMessage(content=' To proceed, could you specify your bank and month and account_number?', additional_kwargs={}, response_metadata={}, id='ab02681d-c03b-4126-a931-057de7f4c872')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 05:01:24,452 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:01:24,453 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 05:01:24,453 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}], 'validated_query': None}
2025-07-14 05:01:24,493 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x128766a50> default_metadata=() model_kwargs={}
2025-07-14 05:01:24,523 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:01:24,523 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:01:24,524 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:01:26,816 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:01:26,817 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:01:26,817 - graph - INFO - Merged final_query: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:01:26,817 - graph - WARNING - Missing required fields: bank or month or account_no
2025-07-14 05:01:26,818 - graph - INFO - Start routing logic
2025-07-14 05:01:26,818 - graph - INFO - Validated Query Check: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: ['bank', 'month', 'account_no']
2025-07-14 05:01:26,819 - graph - INFO - üîÅ Clarify Node: Asking user to fill missing fields.
2025-07-14 05:01:26,819 - graph - INFO - Current state at start of Clarify Node 
{'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='ef1b02b9-d0b8-4134-a14b-59f20b0d466a'), AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='3b6fcbd1-4e5e-4a80-96b8-b7de6612dea8'), AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='57b84920-c99d-4b26-848c-7a744c17908d')], 'plan': "<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'), 'confirmed': False}

2025-07-14 05:01:26,819 - graph - INFO - q from state: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:01:26,821 - main - INFO - === FINAL STATE ===
{'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='ef1b02b9-d0b8-4134-a14b-59f20b0d466a'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='3b6fcbd1-4e5e-4a80-96b8-b7de6612dea8'),
              AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='57b84920-c99d-4b26-848c-7a744c17908d'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='43722c0c-1740-4a08-8b8e-a6187e0fc03a')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 05:02:43,129 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:02:43,130 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='Provide me spending details of ICICI bank account number 9469')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')
2025-07-14 05:02:43,131 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'Provide me spending details of ICICI bank account number 9469'}], 'validated_query': {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}}
2025-07-14 05:02:43,135 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12885e5d0> default_metadata=() model_kwargs={}
2025-07-14 05:02:43,174 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:02:43,174 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:02:43,174 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:02:45,376 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:02:45,376 - graph - INFO - vq after - new parsed message from user: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:02:45,376 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:02:45,376 - graph - WARNING - Missing required fields: bank or month or account_no
2025-07-14 05:02:45,377 - graph - INFO - Start routing logic
2025-07-14 05:02:45,377 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: ['month']
2025-07-14 05:02:45,378 - graph - INFO - üîÅ Clarify Node: Asking user to fill missing fields.
2025-07-14 05:02:45,378 - graph - INFO - Current state at start of Clarify Node 
{'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='37cf5aec-5524-454f-8ee8-17489e713b96'), AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='1b1733d4-1b26-48a8-9546-9610b1d8eead'), HumanMessage(content='Provide me spending details of ICICI bank account number 9469', additional_kwargs={}, response_metadata={}, id='a93e9915-59ba-4321-b9b3-ef2daabc74e9'), AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='1ef3fca2-bb51-440d-b598-c866b3bbee31'), AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='652da82b-3a2a-4d9e-8093-d37d9f1f1ed4')], 'plan': "<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'), 'confirmed': False}

2025-07-14 05:02:45,379 - graph - INFO - q from state: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: None, Year: None, Date Range: None Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:02:45,380 - main - INFO - === FINAL STATE ===
{'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='37cf5aec-5524-454f-8ee8-17489e713b96'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='1b1733d4-1b26-48a8-9546-9610b1d8eead'),
              HumanMessage(content='Provide me spending details of ICICI bank account number 9469', additional_kwargs={}, response_metadata={}, id='a93e9915-59ba-4321-b9b3-ef2daabc74e9'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='1ef3fca2-bb51-440d-b598-c866b3bbee31'),
              AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='652da82b-3a2a-4d9e-8093-d37d9f1f1ed4'),
              AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='daaa41ad-8038-4811-a67f-17621fd21b5c')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 05:03:27,611 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:03:27,612 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='Provide me spending details of ICICI bank account number 9469'), Message(role='ai', content=' To proceed, could you specify your month?'), Message(role='user', content='I am interested to analyse the expenses in the month of June 2025')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month=None, year=None, date_range=None, query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')
2025-07-14 05:03:27,612 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'Provide me spending details of ICICI bank account number 9469'}, {'role': 'ai', 'content': ' To proceed, could you specify your month?'}, {'role': 'user', 'content': 'I am interested to analyse the expenses in the month of June 2025'}], 'validated_query': {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}}
2025-07-14 05:03:27,615 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12876efd0> default_metadata=() model_kwargs={}
2025-07-14 05:03:27,651 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:03:27,651 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:03:27,652 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:03:29,890 - graph - INFO - Existing vq : {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:03:29,891 - graph - INFO - vq after - new parsed message from user: {'intent': 'analyse expenses', 'bank': None, 'account_no': None, 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None}
2025-07-14 05:03:29,891 - graph - INFO - Merged final_query: Intent: analyse expenses, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:03:29,891 - graph - INFO - Start routing logic
2025-07-14 05:03:29,891 - graph - INFO - Validated Query Check: {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: []
2025-07-14 05:03:29,891 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:03:29,892 - graph - INFO - Confirm node start...
2025-07-14 05:03:29,892 - graph - INFO - user's last message: content='I am interested to analyse the expenses in the month of June 2025' additional_kwargs={} response_metadata={} id='3562cca4-ac03-4c0e-9851-1430c14cce1d'
2025-07-14 05:03:29,892 - graph - INFO - Start routing logic
2025-07-14 05:03:29,894 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='132827f0-b6e9-45e2-9e63-c9c0de7f4374'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='dab3cfce-b4b8-4887-a148-e9ba8d3aba6c'),
              HumanMessage(content='Provide me spending details of ICICI bank account number 9469', additional_kwargs={}, response_metadata={}, id='bd9f8998-795d-456e-96db-17ef6e9525d6'),
              AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='4891a6ab-edd7-4cc5-884a-878c1fecb2c6'),
              HumanMessage(content='I am interested to analyse the expenses in the month of June 2025', additional_kwargs={}, response_metadata={}, id='3562cca4-ac03-4c0e-9851-1430c14cce1d'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='efce1b5c-4052-4a96-8269-cfde3209ba58'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='658b87ce-1d6f-40d3-880c-c71e2ec5d9c8')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='analyse expenses', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 05:04:31,118 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:04:31,119 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='Provide me spending details of ICICI bank account number 9469'), Message(role='ai', content=' To proceed, could you specify your month?'), Message(role='user', content='I am interested to analyse the expenses in the month of June 2025'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?"), Message(role='user', content='modify the account number to 6110')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='analyse expenses', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')
2025-07-14 05:04:31,119 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'Provide me spending details of ICICI bank account number 9469'}, {'role': 'ai', 'content': ' To proceed, could you specify your month?'}, {'role': 'user', 'content': 'I am interested to analyse the expenses in the month of June 2025'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the account number to 6110'}], 'validated_query': {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}}
2025-07-14 05:04:31,123 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12887a2c0> default_metadata=() model_kwargs={}
2025-07-14 05:04:31,157 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:04:31,157 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:04:31,158 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:04:33,210 - graph - INFO - Existing vq : {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:04:33,210 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': 'XXXXXXXX6110', 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:04:33,210 - graph - INFO - Merged final_query: Intent: analyse expenses, Bank: ICICI, Account No: XXXXXXXX6110, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:04:33,211 - graph - INFO - Start routing logic
2025-07-14 05:04:33,211 - graph - INFO - Validated Query Check: {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6110', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: []
2025-07-14 05:04:33,212 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:04:33,212 - graph - INFO - Confirm node start...
2025-07-14 05:04:33,212 - graph - INFO - user's last message: content='modify the account number to 6110' additional_kwargs={} response_metadata={} id='abd038bb-d965-47b0-9e9e-e778c99cc0dd'
2025-07-14 05:04:33,213 - graph - INFO - Start routing logic
2025-07-14 05:04:33,215 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='1199fe57-9287-48a7-ab31-c86968c8f065'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='b99332d7-e370-4d97-bb4f-26400fbc376f'),
              HumanMessage(content='Provide me spending details of ICICI bank account number 9469', additional_kwargs={}, response_metadata={}, id='284f9dcb-cc21-4617-9d17-216559d8a0ec'),
              AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='4260097c-a179-459b-bb35-5c00ad202139'),
              HumanMessage(content='I am interested to analyse the expenses in the month of June 2025', additional_kwargs={}, response_metadata={}, id='ff7eed35-9457-4abe-a57d-a3389d177ddb'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='8cef94b5-2098-4e51-87b9-d156e7ceabd9'),
              HumanMessage(content='modify the account number to 6110', additional_kwargs={}, response_metadata={}, id='abd038bb-d965-47b0-9e9e-e778c99cc0dd'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='dd40769f-c8c6-4e8e-871d-db1644cb069e'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX6110\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='8ef992c0-cb7f-42b8-ab75-53a4c08d5a01')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='analyse expenses', bank='ICICI', account_no='XXXXXXXX6110', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 05:05:03,437 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:05:03,439 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='Provide me spending details of ICICI bank account number 9469'), Message(role='ai', content=' To proceed, could you specify your month?'), Message(role='user', content='I am interested to analyse the expenses in the month of June 2025'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?"), Message(role='user', content='modify the account number to 6110'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX6110\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?"), Message(role='user', content='modify the bank to SBI')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='analyse expenses', bank='ICICI', account_no='XXXXXXXX6110', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')
2025-07-14 05:05:03,439 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'Provide me spending details of ICICI bank account number 9469'}, {'role': 'ai', 'content': ' To proceed, could you specify your month?'}, {'role': 'user', 'content': 'I am interested to analyse the expenses in the month of June 2025'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the account number to 6110'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX6110\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the bank to SBI'}], 'validated_query': {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6110', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}}
2025-07-14 05:05:03,443 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x128752d70> default_metadata=() model_kwargs={}
2025-07-14 05:05:03,479 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:05:03,479 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6110', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:05:03,479 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:05:05,541 - graph - INFO - Existing vq : {'intent': 'analyse expenses', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6110', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:05:05,542 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': 'SBI', 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:05:05,542 - graph - INFO - Merged final_query: Intent: analyse expenses, Bank: SBI, Account No: XXXXXXXX6110, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:05:05,543 - graph - INFO - Start routing logic
2025-07-14 05:05:05,543 - graph - INFO - Validated Query Check: {'intent': 'analyse expenses', 'bank': 'SBI', 'account_no': 'XXXXXXXX6110', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: []
2025-07-14 05:05:05,544 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:05:05,545 - graph - INFO - Confirm node start...
2025-07-14 05:05:05,546 - graph - INFO - user's last message: content='modify the bank to SBI' additional_kwargs={} response_metadata={} id='e14927e3-0f48-4d14-a1cd-87e9a7f74679'
2025-07-14 05:05:05,546 - graph - INFO - Start routing logic
2025-07-14 05:05:05,549 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='c15e05cd-ec81-48ad-a603-46383f7c0398'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='9979580c-8e51-4f6c-b793-ec0fd595d9ba'),
              HumanMessage(content='Provide me spending details of ICICI bank account number 9469', additional_kwargs={}, response_metadata={}, id='baac02a6-92ab-4d50-a083-5665f523cd26'),
              AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='aa31b96c-9198-41ab-8faf-eae141319551'),
              HumanMessage(content='I am interested to analyse the expenses in the month of June 2025', additional_kwargs={}, response_metadata={}, id='d36f8a01-90e7-465c-9fb5-d59ed2cdc50c'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='8885ccd3-c0f0-46d4-b920-a16c3ad55092'),
              HumanMessage(content='modify the account number to 6110', additional_kwargs={}, response_metadata={}, id='efd09839-dd01-4eb5-9f11-2ae1def25c79'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: ICICI\naccount_no: XXXXXXXX6110\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='6243006f-a322-4b93-9b74-270416869028'),
              HumanMessage(content='modify the bank to SBI', additional_kwargs={}, response_metadata={}, id='e14927e3-0f48-4d14-a1cd-87e9a7f74679'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='2a31c7df-c62b-481d-9eee-5ce3b89cad44'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse expenses\nbank: SBI\naccount_no: XXXXXXXX6110\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ab34e3a2-7c9d-49c9-b49d-3ce92e64f163')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='analyse expenses', bank='SBI', account_no='XXXXXXXX6110', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 05:06:16,911 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:06:16,913 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='Analyse the transactions for ICICI bank account 9469 for the month of June')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 05:06:16,913 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'Analyse the transactions for ICICI bank account 9469 for the month of June'}], 'validated_query': None}
2025-07-14 05:06:16,917 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x128c98050> default_metadata=() model_kwargs={}
2025-07-14 05:06:16,950 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:06:16,950 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:06:16,950 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:06:19,611 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:06:19,612 - graph - INFO - vq after - new parsed message from user: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': None, 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:06:19,612 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:06:19,613 - graph - INFO - Start routing logic
2025-07-14 05:06:19,613 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:06:19,613 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:06:19,614 - graph - INFO - Confirm node start...
2025-07-14 05:06:19,614 - graph - INFO - user's last message: content='Analyse the transactions for ICICI bank account 9469 for the month of June' additional_kwargs={} response_metadata={} id='2ac63c70-2052-46c8-9356-2d5f9822fddf'
2025-07-14 05:06:19,615 - graph - INFO - Start routing logic
2025-07-14 05:06:19,616 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='Analyse the transactions for ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='2ac63c70-2052-46c8-9356-2d5f9822fddf'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='f50df37e-be41-42d2-9447-49601cdaf7aa'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='2e3bf314-3414-46ba-9414-deccea74f427')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 05:06:34,365 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:06:34,366 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='Analyse the transactions for ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 05:06:34,366 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'Analyse the transactions for ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 05:06:34,369 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12877f460> default_metadata=() model_kwargs={}
2025-07-14 05:06:34,402 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:06:34,402 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:06:34,402 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:06:36,572 - graph - INFO - Existing vq : {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'}
2025-07-14 05:06:36,573 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:06:36,573 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy 
2025-07-14 05:06:36,574 - graph - INFO - Start routing logic
2025-07-14 05:06:36,574 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: []
2025-07-14 05:06:36,574 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:06:36,575 - graph - INFO - Confirm node start...
2025-07-14 05:06:36,575 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='340de1dc-79b0-42e8-91b3-e11e0d5fc761'
2025-07-14 05:06:36,575 - graph - INFO - Start routing logic
2025-07-14 05:06:36,576 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy'} ‚Äî Missing: []
2025-07-14 05:06:36,576 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 05:06:36,576 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:06:36,577 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='Analyse the transactions for ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='290963d7-66e3-4210-8de9-fd7832c35d51'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bb7643af-4e51-4ed1-a2d5-62af41c27b67'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='340de1dc-79b0-42e8-91b3-e11e0d5fc761'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='d4c3cc9a-8a04-4acb-af6b-52dc4571c9c1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='999f9f70-3b25-4486-a942-e68150d1455c'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='92ee8714-1650-45cf-a480-b16c279cbbba'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:06:37,903 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="\n\n**Step 1: Check existing data in the database**\n\nI'll start by checking if the transaction data for ICICI account XXXXXXXX9469 in June 2025 is already available in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6dcaf7f1-1245-4e10-8355-fc9cb8a445cf-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': '2c4d2e3d-8388-4849-8f44-34b6cd6269eb', 'type': 'tool_call'}], usage_metadata={'input_tokens': 863, 'output_tokens': 108, 'total_tokens': 971, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:06:37,907 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 05:06:37,982 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:06:37,982 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='Analyse the transactions for ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='290963d7-66e3-4210-8de9-fd7832c35d51'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bb7643af-4e51-4ed1-a2d5-62af41c27b67'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='340de1dc-79b0-42e8-91b3-e11e0d5fc761'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='d4c3cc9a-8a04-4acb-af6b-52dc4571c9c1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='999f9f70-3b25-4486-a942-e68150d1455c'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='92ee8714-1650-45cf-a480-b16c279cbbba'),
 AIMessage(content="\n\n\n**Step 1: Check existing data in the database**\n\nI'll start by checking if the transaction data for ICICI account XXXXXXXX9469 in June 2025 is already available in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6dcaf7f1-1245-4e10-8355-fc9cb8a445cf-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': '2c4d2e3d-8388-4849-8f44-34b6cd6269eb', 'type': 'tool_call'}], usage_metadata={'input_tokens': 863, 'output_tokens': 108, 'total_tokens': 971, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='af030bac-565f-4cca-857a-544ee76efa91', tool_call_id='2c4d2e3d-8388-4849-8f44-34b6cd6269eb'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:06:39,333 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="I checked the database, and I don't have any transactions for ICICI account XXXXXXXX9469 in June 2025. I will now fetch the bank statement from Gmail.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement June 2025 account:XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7a123465-ff29-4371-af57-791fe1198d22-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement June 2025 account:XXXXXXXX9469'}, 'id': 'fa5342d4-58fe-4c7b-a1d7-61d8d51a20ed', 'type': 'tool_call'}], usage_metadata={'input_tokens': 933, 'output_tokens': 68, 'total_tokens': 1001, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:06:39,338 - utils - INFO - Entering search_gmail_with_pdfs...
2025-07-14 05:06:39,362 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-07-14 05:06:39,378 - utils - INFO - Search Query : from:(estatement@icicibank.com) label:inbox subject:ICICI Bank Statement June 2025 account:XXXXXXXX9469 
2025-07-14 05:06:40,181 - utils - INFO - ‚úÖ Found 0 message(s) for query
2025-07-14 05:06:40,182 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:06:40,184 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='Analyse the transactions for ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='290963d7-66e3-4210-8de9-fd7832c35d51'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bb7643af-4e51-4ed1-a2d5-62af41c27b67'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='340de1dc-79b0-42e8-91b3-e11e0d5fc761'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='d4c3cc9a-8a04-4acb-af6b-52dc4571c9c1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='999f9f70-3b25-4486-a942-e68150d1455c'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='92ee8714-1650-45cf-a480-b16c279cbbba'),
 AIMessage(content="\n\n\n**Step 1: Check existing data in the database**\n\nI'll start by checking if the transaction data for ICICI account XXXXXXXX9469 in June 2025 is already available in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6dcaf7f1-1245-4e10-8355-fc9cb8a445cf-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': '2c4d2e3d-8388-4849-8f44-34b6cd6269eb', 'type': 'tool_call'}], usage_metadata={'input_tokens': 863, 'output_tokens': 108, 'total_tokens': 971, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='af030bac-565f-4cca-857a-544ee76efa91', tool_call_id='2c4d2e3d-8388-4849-8f44-34b6cd6269eb'),
 AIMessage(content="\nI checked the database, and I don't have any transactions for ICICI account XXXXXXXX9469 in June 2025. I will now fetch the bank statement from Gmail.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement June 2025 account:XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7a123465-ff29-4371-af57-791fe1198d22-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement June 2025 account:XXXXXXXX9469'}, 'id': 'fa5342d4-58fe-4c7b-a1d7-61d8d51a20ed', 'type': 'tool_call'}], usage_metadata={'input_tokens': 933, 'output_tokens': 68, 'total_tokens': 1001, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No PDFs found', name='fetch_gmail_pdfs', id='5ee02468-d51b-47c3-aea7-20f87233f3f1', tool_call_id='fa5342d4-58fe-4c7b-a1d7-61d8d51a20ed'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:06:41,490 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='I could not find any transactions for ICICI bank account XXXXXXXX9469 in June 2025. I also searched my Gmail but could not find any bank statements for the specified account and time period. Please check if the account number and time period are correct. I can perform the search again if needed.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--0d2de9df-1a76-425b-ab89-80b7f3e001be-0', usage_metadata={'input_tokens': 969, 'output_tokens': 67, 'total_tokens': 1036, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:06:41,494 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='Analyse the transactions for ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='290963d7-66e3-4210-8de9-fd7832c35d51'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bb7643af-4e51-4ed1-a2d5-62af41c27b67'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='340de1dc-79b0-42e8-91b3-e11e0d5fc761'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='d4c3cc9a-8a04-4acb-af6b-52dc4571c9c1'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='999f9f70-3b25-4486-a942-e68150d1455c'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='92ee8714-1650-45cf-a480-b16c279cbbba'),
              AIMessage(content="\n\n\n**Step 1: Check existing data in the database**\n\nI'll start by checking if the transaction data for ICICI account XXXXXXXX9469 in June 2025 is already available in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6dcaf7f1-1245-4e10-8355-fc9cb8a445cf-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': '2c4d2e3d-8388-4849-8f44-34b6cd6269eb', 'type': 'tool_call'}], usage_metadata={'input_tokens': 863, 'output_tokens': 108, 'total_tokens': 971, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='No data found.', name='query_duckdb_tool', id='af030bac-565f-4cca-857a-544ee76efa91', tool_call_id='2c4d2e3d-8388-4849-8f44-34b6cd6269eb'),
              AIMessage(content="\nI checked the database, and I don't have any transactions for ICICI account XXXXXXXX9469 in June 2025. I will now fetch the bank statement from Gmail.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement June 2025 account:XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7a123465-ff29-4371-af57-791fe1198d22-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement June 2025 account:XXXXXXXX9469'}, 'id': 'fa5342d4-58fe-4c7b-a1d7-61d8d51a20ed', 'type': 'tool_call'}], usage_metadata={'input_tokens': 933, 'output_tokens': 68, 'total_tokens': 1001, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='No PDFs found', name='fetch_gmail_pdfs', id='5ee02468-d51b-47c3-aea7-20f87233f3f1', tool_call_id='fa5342d4-58fe-4c7b-a1d7-61d8d51a20ed'),
              AIMessage(content='\nI could not find any transactions for ICICI bank account XXXXXXXX9469 in June 2025. I also searched my Gmail but could not find any bank statements for the specified account and time period. Please check if the account number and time period are correct. I can perform the search again if needed.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--0d2de9df-1a76-425b-ab89-80b7f3e001be-0', usage_metadata={'input_tokens': 969, 'output_tokens': 67, 'total_tokens': 1036, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from dd-mm-yyyy to dd-mm-yyyy')}
2025-07-14 05:33:31,227 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:33:31,229 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the transactions of ICICI bank account 9469 for the month of June')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 05:33:31,229 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the transactions of ICICI bank account 9469 for the month of June'}], 'validated_query': None}
2025-07-14 05:33:31,255 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e366a50> default_metadata=() model_kwargs={}
2025-07-14 05:33:31,283 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:33:31,283 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {}
2025-07-14 05:33:31,284 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:33:33,913 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:33:33,913 - graph - INFO - vq after - new parsed message from user: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:33:33,913 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:33:33,913 - graph - INFO - Start routing logic
2025-07-14 05:33:33,914 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:33:33,914 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:33:33,914 - graph - INFO - Confirm node start...
2025-07-14 05:33:33,914 - graph - INFO - user's last message: content='analyse the transactions of ICICI bank account 9469 for the month of June' additional_kwargs={} response_metadata={} id='53228ddc-0593-4722-942f-6b72bfd65fa9'
2025-07-14 05:33:33,915 - graph - INFO - Start routing logic
2025-07-14 05:33:33,916 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='53228ddc-0593-4722-942f-6b72bfd65fa9'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='acc4a2e6-f089-4dc6-bafd-7be10d506011'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d9d137c9-7051-4cd5-bcdb-db430be60181')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 05:33:52,170 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:33:52,172 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the transactions of ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 05:33:52,172 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the transactions of ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 05:33:52,183 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e57a5d0> default_metadata=() model_kwargs={}
2025-07-14 05:33:52,225 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:33:52,225 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:33:52,226 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:33:54,351 - graph - INFO - Existing vq : {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:33:54,351 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:33:54,351 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:33:54,352 - graph - INFO - Start routing logic
2025-07-14 05:33:54,352 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:33:54,352 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:33:54,353 - graph - INFO - Confirm node start...
2025-07-14 05:33:54,353 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='ab9067dc-f12f-472f-8229-5b56bb94be54'
2025-07-14 05:33:54,354 - graph - INFO - Start routing logic
2025-07-14 05:33:54,354 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:33:54,354 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 05:33:54,355 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:33:54,356 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='6333d697-1889-4754-81f5-386dce405241'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c100e194-2a23-44b3-a832-052d6b25b5af'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ab9067dc-f12f-472f-8229-5b56bb94be54'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c1ae1ccf-3251-4ed0-97d7-50e52e8f2cd8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ce603757-31d6-450d-b82a-e644dddda57b'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='5c77011e-636c-43fd-8816-0c693d6c4d75'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:33:55,721 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='\n\n**Step 1: Check existing data in the database**\n\nI will first check if the transaction data for ICICI account XXXXXXXX9469 for June 2025 is already available in the database.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f35255f3-d63e-47c3-ac2c-df6e82b8c23a-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': 'bd388b10-8d18-4996-b537-58678457cdd9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 882, 'output_tokens': 106, 'total_tokens': 988, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:33:55,725 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 05:33:55,754 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:33:55,755 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='6333d697-1889-4754-81f5-386dce405241'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c100e194-2a23-44b3-a832-052d6b25b5af'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ab9067dc-f12f-472f-8229-5b56bb94be54'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c1ae1ccf-3251-4ed0-97d7-50e52e8f2cd8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ce603757-31d6-450d-b82a-e644dddda57b'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='5c77011e-636c-43fd-8816-0c693d6c4d75'),
 AIMessage(content='\n\n\n**Step 1: Check existing data in the database**\n\nI will first check if the transaction data for ICICI account XXXXXXXX9469 for June 2025 is already available in the database.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f35255f3-d63e-47c3-ac2c-df6e82b8c23a-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': 'bd388b10-8d18-4996-b537-58678457cdd9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 882, 'output_tokens': 106, 'total_tokens': 988, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='2a84fe8b-631c-46b2-b2b7-477c2cee0902', tool_call_id='bd388b10-8d18-4996-b537-58678457cdd9'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:33:56,850 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='OK. No data found in the database. I will now fetch the bank statement from Gmail.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--05e69163-d2df-4bba-9dd6-1cc4820dfdbe-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': '8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b', 'type': 'tool_call'}], usage_metadata={'input_tokens': 952, 'output_tokens': 64, 'total_tokens': 1016, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:33:56,854 - utils - INFO - Entering search_gmail_with_pdfs...
2025-07-14 05:33:56,861 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-07-14 05:33:56,865 - utils - INFO - Search Query : from:(estatement@icicibank.com) label:inbox subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:33:57,654 - utils - INFO - ‚úÖ Found 1 message(s) for query
2025-07-14 05:33:58,104 - utils - INFO - Enetering print_email_summary()
2025-07-14 05:33:58,105 - utils - INFO - Subject: ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469
2025-07-14 05:33:58,106 - utils - INFO - From: Estatement <estatement@icicibank.com>
2025-07-14 05:33:58,107 - utils - INFO - No plain text body found
2025-07-14 05:33:58,107 - utils - INFO - Entering save_pdf_from_message() ...
2025-07-14 05:33:58,802 - utils - INFO - PDFs found : ['Downloaded: downloads/Statement_2025MTH06_787512432.pdf']
2025-07-14 05:33:58,802 - utils - INFO - Exitting save_pdf_from_message() ...
2025-07-14 05:33:58,804 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:33:58,806 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='6333d697-1889-4754-81f5-386dce405241'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c100e194-2a23-44b3-a832-052d6b25b5af'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ab9067dc-f12f-472f-8229-5b56bb94be54'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c1ae1ccf-3251-4ed0-97d7-50e52e8f2cd8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ce603757-31d6-450d-b82a-e644dddda57b'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='5c77011e-636c-43fd-8816-0c693d6c4d75'),
 AIMessage(content='\n\n\n**Step 1: Check existing data in the database**\n\nI will first check if the transaction data for ICICI account XXXXXXXX9469 for June 2025 is already available in the database.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f35255f3-d63e-47c3-ac2c-df6e82b8c23a-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': 'bd388b10-8d18-4996-b537-58678457cdd9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 882, 'output_tokens': 106, 'total_tokens': 988, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='2a84fe8b-631c-46b2-b2b7-477c2cee0902', tool_call_id='bd388b10-8d18-4996-b537-58678457cdd9'),
 AIMessage(content='\nOK. No data found in the database. I will now fetch the bank statement from Gmail.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--05e69163-d2df-4bba-9dd6-1cc4820dfdbe-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': '8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b', 'type': 'tool_call'}], usage_metadata={'input_tokens': 952, 'output_tokens': 64, 'total_tokens': 1016, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='faf659b3-dc41-46c3-8949-223618de333d', tool_call_id='8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:33:59,935 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8b050354-6a58-48ba-a766-47457284a865-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '4b7f71da-946e-411c-9c8a-5f8960d13ad7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1029, 'output_tokens': 33, 'total_tokens': 1062, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:33:59,940 - utils - INFO - Entering decrypt_with_pikepdf() ...
2025-07-14 05:33:59,962 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:33:59,963 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='6333d697-1889-4754-81f5-386dce405241'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c100e194-2a23-44b3-a832-052d6b25b5af'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ab9067dc-f12f-472f-8229-5b56bb94be54'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c1ae1ccf-3251-4ed0-97d7-50e52e8f2cd8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ce603757-31d6-450d-b82a-e644dddda57b'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='5c77011e-636c-43fd-8816-0c693d6c4d75'),
 AIMessage(content='\n\n\n**Step 1: Check existing data in the database**\n\nI will first check if the transaction data for ICICI account XXXXXXXX9469 for June 2025 is already available in the database.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f35255f3-d63e-47c3-ac2c-df6e82b8c23a-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': 'bd388b10-8d18-4996-b537-58678457cdd9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 882, 'output_tokens': 106, 'total_tokens': 988, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='2a84fe8b-631c-46b2-b2b7-477c2cee0902', tool_call_id='bd388b10-8d18-4996-b537-58678457cdd9'),
 AIMessage(content='\nOK. No data found in the database. I will now fetch the bank statement from Gmail.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--05e69163-d2df-4bba-9dd6-1cc4820dfdbe-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': '8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b', 'type': 'tool_call'}], usage_metadata={'input_tokens': 952, 'output_tokens': 64, 'total_tokens': 1016, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='faf659b3-dc41-46c3-8949-223618de333d', tool_call_id='8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8b050354-6a58-48ba-a766-47457284a865-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '4b7f71da-946e-411c-9c8a-5f8960d13ad7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1029, 'output_tokens': 33, 'total_tokens': 1062, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='66f24085-8843-46b9-9dc7-6717ef1618fc', tool_call_id='4b7f71da-946e-411c-9c8a-5f8960d13ad7'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:34:00,918 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--9e099207-89ff-4891-b429-d5b03d764f93-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': 'd96731f4-c468-428f-847a-36365805e56c', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1094, 'output_tokens': 47, 'total_tokens': 1141, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:34:00,925 - utils - INFO - Entering parse_icici__statement() ...
2025-07-14 05:34:00,931 - utils - INFO - 
üìÑ Processing page 1
2025-07-14 05:34:01,026 - utils - INFO - Extracted 40 lines from page 1
2025-07-14 05:34:01,026 - utils - INFO - 
üìÑ Processing page 2
2025-07-14 05:34:01,085 - utils - INFO - Extracted 178 lines from page 2
2025-07-14 05:34:01,086 - duckdb_tools - INFO - Entering store_transactions_to_duckdb() with 5 transactions and finance.db database 
2025-07-14 05:34:01,115 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:34:01,116 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='6333d697-1889-4754-81f5-386dce405241'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c100e194-2a23-44b3-a832-052d6b25b5af'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ab9067dc-f12f-472f-8229-5b56bb94be54'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c1ae1ccf-3251-4ed0-97d7-50e52e8f2cd8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ce603757-31d6-450d-b82a-e644dddda57b'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='5c77011e-636c-43fd-8816-0c693d6c4d75'),
 AIMessage(content='\n\n\n**Step 1: Check existing data in the database**\n\nI will first check if the transaction data for ICICI account XXXXXXXX9469 for June 2025 is already available in the database.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f35255f3-d63e-47c3-ac2c-df6e82b8c23a-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': 'bd388b10-8d18-4996-b537-58678457cdd9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 882, 'output_tokens': 106, 'total_tokens': 988, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='2a84fe8b-631c-46b2-b2b7-477c2cee0902', tool_call_id='bd388b10-8d18-4996-b537-58678457cdd9'),
 AIMessage(content='\nOK. No data found in the database. I will now fetch the bank statement from Gmail.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--05e69163-d2df-4bba-9dd6-1cc4820dfdbe-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': '8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b', 'type': 'tool_call'}], usage_metadata={'input_tokens': 952, 'output_tokens': 64, 'total_tokens': 1016, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='faf659b3-dc41-46c3-8949-223618de333d', tool_call_id='8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8b050354-6a58-48ba-a766-47457284a865-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '4b7f71da-946e-411c-9c8a-5f8960d13ad7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1029, 'output_tokens': 33, 'total_tokens': 1062, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='66f24085-8843-46b9-9dc7-6717ef1618fc', tool_call_id='4b7f71da-946e-411c-9c8a-5f8960d13ad7'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--9e099207-89ff-4891-b429-d5b03d764f93-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': 'd96731f4-c468-428f-847a-36365805e56c', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1094, 'output_tokens': 47, 'total_tokens': 1141, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Inserted 5 new transactions out of 5 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='40667a88-0949-4a3e-aa46-cf59ecbeb071', tool_call_id='d96731f4-c468-428f-847a-36365805e56c'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:34:02,148 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--cbcc2e6e-169f-40ca-9fb7-fc6065cdc6c2-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': '07a5fca9-e584-4dad-a6af-4f0804a88ea6', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1170, 'output_tokens': 59, 'total_tokens': 1229, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:34:02,153 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 05:34:02,184 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:34:02,185 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='6333d697-1889-4754-81f5-386dce405241'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c100e194-2a23-44b3-a832-052d6b25b5af'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ab9067dc-f12f-472f-8229-5b56bb94be54'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c1ae1ccf-3251-4ed0-97d7-50e52e8f2cd8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ce603757-31d6-450d-b82a-e644dddda57b'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='5c77011e-636c-43fd-8816-0c693d6c4d75'),
 AIMessage(content='\n\n\n**Step 1: Check existing data in the database**\n\nI will first check if the transaction data for ICICI account XXXXXXXX9469 for June 2025 is already available in the database.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f35255f3-d63e-47c3-ac2c-df6e82b8c23a-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': 'bd388b10-8d18-4996-b537-58678457cdd9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 882, 'output_tokens': 106, 'total_tokens': 988, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='2a84fe8b-631c-46b2-b2b7-477c2cee0902', tool_call_id='bd388b10-8d18-4996-b537-58678457cdd9'),
 AIMessage(content='\nOK. No data found in the database. I will now fetch the bank statement from Gmail.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--05e69163-d2df-4bba-9dd6-1cc4820dfdbe-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': '8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b', 'type': 'tool_call'}], usage_metadata={'input_tokens': 952, 'output_tokens': 64, 'total_tokens': 1016, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='faf659b3-dc41-46c3-8949-223618de333d', tool_call_id='8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8b050354-6a58-48ba-a766-47457284a865-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '4b7f71da-946e-411c-9c8a-5f8960d13ad7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1029, 'output_tokens': 33, 'total_tokens': 1062, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='66f24085-8843-46b9-9dc7-6717ef1618fc', tool_call_id='4b7f71da-946e-411c-9c8a-5f8960d13ad7'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--9e099207-89ff-4891-b429-d5b03d764f93-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': 'd96731f4-c468-428f-847a-36365805e56c', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1094, 'output_tokens': 47, 'total_tokens': 1141, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Inserted 5 new transactions out of 5 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='40667a88-0949-4a3e-aa46-cf59ecbeb071', tool_call_id='d96731f4-c468-428f-847a-36365805e56c'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--cbcc2e6e-169f-40ca-9fb7-fc6065cdc6c2-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': '07a5fca9-e584-4dad-a6af-4f0804a88ea6', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1170, 'output_tokens': 59, 'total_tokens': 1229, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='| date                | description                                                                                       |   amount |   balance | mode            | type    | receiver        | bank   | account_no   |\n|:--------------------|:--------------------------------------------------------------------------------------------------|---------:|----------:|:----------------|:--------|:----------------|:-------|:-------------|\n| 2025-06-01 00:00:00 | Balance Forward                                                                                   |        0 |    276.25 | B/F             | BALANCE |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-13 00:00:00 | MMT/IMPS/516407166609/SATYA SUND/SBIN0018701                                                      |        3 |    273.25 | MOBILE BANKING  | DEBIT   |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-20 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/IDFOP0482ylnAhGLyKNOBFbC0FRjUUe okzR |     2000 |   2273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-29 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/IDFOP2382zBCm7MgqfHTVwfEIBJ7QKI NW8k |     3000 |   5273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-30 00:00:00 | NW8k 000201599469:Int.Pd:29-03-2025 to 29-06-2025 Total: 5,007.00 3.00 5,280.25                   |        7 |   5280.25 | Interest Credit | CREDIT  | ICICI           | ICICI  | XXXXXXXX9469 |', name='query_duckdb_tool', id='8087963e-12bc-44d9-b80b-d86726fa5d65', tool_call_id='07a5fca9-e584-4dad-a6af-4f0804a88ea6'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:34:04,882 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='Here are the transactions for ICICI bank account XXXXXXXX9469 in June 2025:\n\n*   **2025-06-01:** Balance Forward, Amount: 0, Balance: 276.25, Type: BALANCE\n*   **2025-06-13:** MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25, Type: DEBIT\n*   **2025-06-20:** UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124, Amount: 2000, Balance: 2273.25, Type: CREDIT\n*   **2025-06-29:** UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771, Amount: 3000, Balance: 5273.25, Type: CREDIT\n*   **2025-06-30:** NW8k 000201599469:Int.Pd:29-03-2025 to 29-06-2025 Total: 5,007.00 3.00 5,280.25, Amount: 7, Balance: 5280.25, Type: CREDIT', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7f522b29-4fa1-451a-8b83-5bf891761f36-0', usage_metadata={'input_tokens': 1837, 'output_tokens': 377, 'total_tokens': 2214, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:34:04,888 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the transactions of ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='6333d697-1889-4754-81f5-386dce405241'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c100e194-2a23-44b3-a832-052d6b25b5af'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ab9067dc-f12f-472f-8229-5b56bb94be54'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c1ae1ccf-3251-4ed0-97d7-50e52e8f2cd8'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ce603757-31d6-450d-b82a-e644dddda57b'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='5c77011e-636c-43fd-8816-0c693d6c4d75'),
              AIMessage(content='\n\n\n**Step 1: Check existing data in the database**\n\nI will first check if the transaction data for ICICI account XXXXXXXX9469 for June 2025 is already available in the database.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--f35255f3-d63e-47c3-ac2c-df6e82b8c23a-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': 'bd388b10-8d18-4996-b537-58678457cdd9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 882, 'output_tokens': 106, 'total_tokens': 988, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='No data found.', name='query_duckdb_tool', id='2a84fe8b-631c-46b2-b2b7-477c2cee0902', tool_call_id='bd388b10-8d18-4996-b537-58678457cdd9'),
              AIMessage(content='\nOK. No data found in the database. I will now fetch the bank statement from Gmail.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--05e69163-d2df-4bba-9dd6-1cc4820dfdbe-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': '8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b', 'type': 'tool_call'}], usage_metadata={'input_tokens': 952, 'output_tokens': 64, 'total_tokens': 1016, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='faf659b3-dc41-46c3-8949-223618de333d', tool_call_id='8474ad2c-eac2-40b6-ae9c-eb4c68e6c88b'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8b050354-6a58-48ba-a766-47457284a865-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '4b7f71da-946e-411c-9c8a-5f8960d13ad7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1029, 'output_tokens': 33, 'total_tokens': 1062, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='66f24085-8843-46b9-9dc7-6717ef1618fc', tool_call_id='4b7f71da-946e-411c-9c8a-5f8960d13ad7'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--9e099207-89ff-4891-b429-d5b03d764f93-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': 'd96731f4-c468-428f-847a-36365805e56c', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1094, 'output_tokens': 47, 'total_tokens': 1141, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='Inserted 5 new transactions out of 5 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='40667a88-0949-4a3e-aa46-cf59ecbeb071', tool_call_id='d96731f4-c468-428f-847a-36365805e56c'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--cbcc2e6e-169f-40ca-9fb7-fc6065cdc6c2-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30'"}, 'id': '07a5fca9-e584-4dad-a6af-4f0804a88ea6', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1170, 'output_tokens': 59, 'total_tokens': 1229, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='| date                | description                                                                                       |   amount |   balance | mode            | type    | receiver        | bank   | account_no   |\n|:--------------------|:--------------------------------------------------------------------------------------------------|---------:|----------:|:----------------|:--------|:----------------|:-------|:-------------|\n| 2025-06-01 00:00:00 | Balance Forward                                                                                   |        0 |    276.25 | B/F             | BALANCE |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-13 00:00:00 | MMT/IMPS/516407166609/SATYA SUND/SBIN0018701                                                      |        3 |    273.25 | MOBILE BANKING  | DEBIT   |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-20 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/IDFOP0482ylnAhGLyKNOBFbC0FRjUUe okzR |     2000 |   2273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-29 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/IDFOP2382zBCm7MgqfHTVwfEIBJ7QKI NW8k |     3000 |   5273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-30 00:00:00 | NW8k 000201599469:Int.Pd:29-03-2025 to 29-06-2025 Total: 5,007.00 3.00 5,280.25                   |        7 |   5280.25 | Interest Credit | CREDIT  | ICICI           | ICICI  | XXXXXXXX9469 |', name='query_duckdb_tool', id='8087963e-12bc-44d9-b80b-d86726fa5d65', tool_call_id='07a5fca9-e584-4dad-a6af-4f0804a88ea6'),
              AIMessage(content='\nHere are the transactions for ICICI bank account XXXXXXXX9469 in June 2025:\n\n*   **2025-06-01:** Balance Forward, Amount: 0, Balance: 276.25, Type: BALANCE\n*   **2025-06-13:** MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25, Type: DEBIT\n*   **2025-06-20:** UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124, Amount: 2000, Balance: 2273.25, Type: CREDIT\n*   **2025-06-29:** UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771, Amount: 3000, Balance: 5273.25, Type: CREDIT\n*   **2025-06-30:** NW8k 000201599469:Int.Pd:29-03-2025 to 29-06-2025 Total: 5,007.00 3.00 5,280.25, Amount: 7, Balance: 5280.25, Type: CREDIT', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7f522b29-4fa1-451a-8b83-5bf891761f36-0', usage_metadata={'input_tokens': 1837, 'output_tokens': 377, 'total_tokens': 2214, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 05:51:26,646 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:51:26,649 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 05:51:26,649 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}], 'validated_query': None}
2025-07-14 05:51:26,661 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e36fb10> default_metadata=() model_kwargs={}
2025-07-14 05:51:26,695 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:51:26,696 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {}
2025-07-14 05:51:26,696 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:51:28,779 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:51:28,779 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:51:28,779 - graph - INFO - Merged final_query: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: None 
2025-07-14 05:51:28,780 - graph - WARNING - Missing required fields: bank or month or account_no
2025-07-14 05:51:28,780 - graph - INFO - Start routing logic
2025-07-14 05:51:28,780 - graph - INFO - Validated Query Check: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None} ‚Äî Missing: ['bank', 'month', 'account_no']
2025-07-14 05:51:28,781 - graph - INFO - üîÅ Clarify Node: Asking user to fill missing fields.
2025-07-14 05:51:28,781 - graph - INFO - Current state at start of Clarify Node 
{'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='b3e28d90-a7b6-431c-b825-d3ed70046b60'), AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='9a99f4e3-fb74-4875-baea-1d2675c6a13f'), AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='0226bfba-c9b7-45a8-a120-83632e8d4de0')], 'plan': "<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint=None), 'confirmed': False}

2025-07-14 05:51:28,781 - graph - INFO - q from state: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: None 
2025-07-14 05:51:28,782 - main - INFO - === FINAL STATE ===
{'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='b3e28d90-a7b6-431c-b825-d3ed70046b60'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='9a99f4e3-fb74-4875-baea-1d2675c6a13f'),
              AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='0226bfba-c9b7-45a8-a120-83632e8d4de0'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='f8ccfc01-be0d-4564-9ac3-2f6554a0a28a')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint=None)}
2025-07-14 05:52:00,821 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:52:00,822 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='I am interested for the ICICI bank account 9469')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint=None)
2025-07-14 05:52:00,822 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'I am interested for the ICICI bank account 9469'}], 'validated_query': {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}}
2025-07-14 05:52:00,825 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e5962c0> default_metadata=() model_kwargs={}
2025-07-14 05:52:00,860 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:52:00,860 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:52:00,861 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:52:03,020 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:52:03,021 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:52:03,022 - graph - INFO - Merged final_query: Intent: None, Bank: ICICI, Account No: XXXXXXXX9469, Month: None, Year: None, Date Range: None Query Hint: None 
2025-07-14 05:52:03,022 - graph - WARNING - Missing required fields: bank or month or account_no
2025-07-14 05:52:03,022 - graph - INFO - Start routing logic
2025-07-14 05:52:03,022 - graph - INFO - Validated Query Check: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': None} ‚Äî Missing: ['month']
2025-07-14 05:52:03,023 - graph - INFO - üîÅ Clarify Node: Asking user to fill missing fields.
2025-07-14 05:52:03,023 - graph - INFO - Current state at start of Clarify Node 
{'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='5ab0f5b5-ce0f-4a94-9c90-b022c0e2b7ea'), AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='f137ed60-11ff-4944-9a0d-9c30541a1d73'), HumanMessage(content='I am interested for the ICICI bank account 9469', additional_kwargs={}, response_metadata={}, id='6214f1df-d46e-477d-8105-2ccbc4d9504e'), AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c3ecb950-9551-48b8-8ded-0631a92e5e07'), AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='92577486-6bfc-439f-b254-5fd6c86a34a6')], 'plan': "<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", 'validated_query': QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month=None, year=None, date_range=None, query_hint=None), 'confirmed': False}

2025-07-14 05:52:03,023 - graph - INFO - q from state: Intent: None, Bank: ICICI, Account No: XXXXXXXX9469, Month: None, Year: None, Date Range: None Query Hint: None 
2025-07-14 05:52:03,025 - main - INFO - === FINAL STATE ===
{'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='5ab0f5b5-ce0f-4a94-9c90-b022c0e2b7ea'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='f137ed60-11ff-4944-9a0d-9c30541a1d73'),
              HumanMessage(content='I am interested for the ICICI bank account 9469', additional_kwargs={}, response_metadata={}, id='6214f1df-d46e-477d-8105-2ccbc4d9504e'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='c3ecb950-9551-48b8-8ded-0631a92e5e07'),
              AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='92577486-6bfc-439f-b254-5fd6c86a34a6'),
              AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='e5a0cd32-01cd-4a0a-9a98-866b5a6058f0')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month=None, year=None, date_range=None, query_hint=None)}
2025-07-14 05:53:05,011 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:53:05,013 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='I am interested for the ICICI bank account 9469'), Message(role='ai', content=' To proceed, could you specify your month?'), Message(role='user', content='analyse the statements for the month of June')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month=None, year=None, date_range=None, query_hint=None)
2025-07-14 05:53:05,014 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'I am interested for the ICICI bank account 9469'}, {'role': 'ai', 'content': ' To proceed, could you specify your month?'}, {'role': 'user', 'content': 'analyse the statements for the month of June'}], 'validated_query': {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': None}}
2025-07-14 05:53:05,018 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e353820> default_metadata=() model_kwargs={}
2025-07-14 05:53:05,039 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:53:05,039 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:53:05,040 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:53:07,325 - graph - INFO - Existing vq : {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:53:07,325 - graph - INFO - vq after - new parsed message from user: {'intent': 'analyse statements', 'bank': None, 'account_no': None, 'month': 'June', 'year': None, 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None}
2025-07-14 05:53:07,325 - graph - INFO - Merged final_query: Intent: analyse statements, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: None 
2025-07-14 05:53:07,326 - graph - INFO - Start routing logic
2025-07-14 05:53:07,326 - graph - INFO - Validated Query Check: {'intent': 'analyse statements', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None} ‚Äî Missing: []
2025-07-14 05:53:07,326 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:53:07,326 - graph - INFO - Confirm node start...
2025-07-14 05:53:07,327 - graph - INFO - user's last message: content='analyse the statements for the month of June' additional_kwargs={} response_metadata={} id='2fb56690-3dc5-46c8-ae62-6184f515663d'
2025-07-14 05:53:07,327 - graph - INFO - Start routing logic
2025-07-14 05:53:07,328 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='b7efd6a3-5e9f-4934-ad0d-44cc14305e84'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='2a2f5b87-485d-455d-bd13-197b0426f8cd'),
              HumanMessage(content='I am interested for the ICICI bank account 9469', additional_kwargs={}, response_metadata={}, id='ca2f11b8-6a4c-424e-8ac8-c8c29121259a'),
              AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='da6a36a5-0268-4cbc-a774-f87852ee6d43'),
              HumanMessage(content='analyse the statements for the month of June', additional_kwargs={}, response_metadata={}, id='2fb56690-3dc5-46c8-ae62-6184f515663d'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='3f358c55-c126-4485-b509-696f446a18a0'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='453c6cd5-f0fd-4718-aa77-08c5caf595eb')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='analyse statements', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint=None)}
2025-07-14 05:53:35,737 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:53:35,737 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='I am interested for the ICICI bank account 9469'), Message(role='ai', content=' To proceed, could you specify your month?'), Message(role='user', content='analyse the statements for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='analyse statements', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint=None)
2025-07-14 05:53:35,738 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'I am interested for the ICICI bank account 9469'}, {'role': 'ai', 'content': ' To proceed, could you specify your month?'}, {'role': 'user', 'content': 'analyse the statements for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'analyse statements', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None}}
2025-07-14 05:53:35,742 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11f510ef0> default_metadata=() model_kwargs={}
2025-07-14 05:53:35,776 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:53:35,776 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'analyse statements', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None}
2025-07-14 05:53:35,776 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:53:38,047 - graph - INFO - Existing vq : {'intent': 'analyse statements', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None}
2025-07-14 05:53:38,049 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:53:38,050 - graph - INFO - Merged final_query: Intent: analyse statements, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: None 
2025-07-14 05:53:38,051 - graph - INFO - Start routing logic
2025-07-14 05:53:38,051 - graph - INFO - Validated Query Check: {'intent': 'analyse statements', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None} ‚Äî Missing: []
2025-07-14 05:53:38,051 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:53:38,052 - graph - INFO - Confirm node start...
2025-07-14 05:53:38,052 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='ee18b617-c6b1-4daa-ae3c-637dca80e8c1'
2025-07-14 05:53:38,053 - graph - INFO - Start routing logic
2025-07-14 05:53:38,053 - graph - INFO - Validated Query Check: {'intent': 'analyse statements', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None} ‚Äî Missing: []
2025-07-14 05:53:38,053 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 05:53:38,054 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:53:38,055 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='d8aee25b-c9ea-40db-832e-1a5f2c7d7f2f'),
 AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='dd6df9c4-4372-420f-8718-9588796e82bd'),
 HumanMessage(content='I am interested for the ICICI bank account 9469', additional_kwargs={}, response_metadata={}, id='8086762d-c39d-42c3-91f4-7c1417641bb8'),
 AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='0e565c95-e2ef-4294-8fba-034c672c8961'),
 HumanMessage(content='analyse the statements for the month of June', additional_kwargs={}, response_metadata={}, id='da2ec700-6db4-43f0-aee9-24573b19b9bc'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='2aa9d10e-66bd-454b-810b-1dc9dceb162b'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ee18b617-c6b1-4daa-ae3c-637dca80e8c1'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='4f59568f-f7c7-485c-81a1-1d850e027caf'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1661a69f-4c1f-48d3-acc3-8c4373418271'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='50e52376-0a53-4594-943f-ee5ccccce2b7'),
 SystemMessage(content='User intends to ask: analyse statements for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:53:39,377 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="\n\nFirst, I'll check if the transactions for ICICI account XXXXXXXX9469 for June 2025 are already in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--af115e4d-eb46-44dc-aa38-127d1dc43a07-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': 'd60920cc-3db6-4474-be92-6f84eccead02', 'type': 'tool_call'}], usage_metadata={'input_tokens': 836, 'output_tokens': 94, 'total_tokens': 930, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:53:39,380 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 05:53:39,406 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:53:39,407 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='d8aee25b-c9ea-40db-832e-1a5f2c7d7f2f'),
 AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='dd6df9c4-4372-420f-8718-9588796e82bd'),
 HumanMessage(content='I am interested for the ICICI bank account 9469', additional_kwargs={}, response_metadata={}, id='8086762d-c39d-42c3-91f4-7c1417641bb8'),
 AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='0e565c95-e2ef-4294-8fba-034c672c8961'),
 HumanMessage(content='analyse the statements for the month of June', additional_kwargs={}, response_metadata={}, id='da2ec700-6db4-43f0-aee9-24573b19b9bc'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='2aa9d10e-66bd-454b-810b-1dc9dceb162b'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ee18b617-c6b1-4daa-ae3c-637dca80e8c1'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='4f59568f-f7c7-485c-81a1-1d850e027caf'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1661a69f-4c1f-48d3-acc3-8c4373418271'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='50e52376-0a53-4594-943f-ee5ccccce2b7'),
 AIMessage(content="\n\n\nFirst, I'll check if the transactions for ICICI account XXXXXXXX9469 for June 2025 are already in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--af115e4d-eb46-44dc-aa38-127d1dc43a07-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': 'd60920cc-3db6-4474-be92-6f84eccead02', 'type': 'tool_call'}], usage_metadata={'input_tokens': 836, 'output_tokens': 94, 'total_tokens': 930, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='f03620ee-f3d4-447c-92ef-3cc38e63cda3', tool_call_id='d60920cc-3db6-4474-be92-6f84eccead02'),
 SystemMessage(content='User intends to ask: analyse statements for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:53:40,536 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='I did not find the data in the database. I will now fetch the bank statements from Gmail. After that I will extract the transactions and store them in the database.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "ICICI bank statement account: XXXXXXXX9469 June 2025"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--17985ef1-7005-4518-b22f-0bdc668aebe8-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'ICICI bank statement account: XXXXXXXX9469 June 2025'}, 'id': '22fdb976-f9a2-48e7-85d4-50757c77ebe4', 'type': 'tool_call'}], usage_metadata={'input_tokens': 908, 'output_tokens': 60, 'total_tokens': 968, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:53:40,538 - utils - INFO - Entering search_gmail_with_pdfs...
2025-07-14 05:53:40,542 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-07-14 05:53:40,543 - utils - INFO - Search Query : from:(estatement@icicibank.com) label:inbox ICICI bank statement account: XXXXXXXX9469 June 2025 
2025-07-14 05:53:41,289 - utils - INFO - ‚úÖ Found 0 message(s) for query
2025-07-14 05:53:41,290 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:53:41,291 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='d8aee25b-c9ea-40db-832e-1a5f2c7d7f2f'),
 AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='dd6df9c4-4372-420f-8718-9588796e82bd'),
 HumanMessage(content='I am interested for the ICICI bank account 9469', additional_kwargs={}, response_metadata={}, id='8086762d-c39d-42c3-91f4-7c1417641bb8'),
 AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='0e565c95-e2ef-4294-8fba-034c672c8961'),
 HumanMessage(content='analyse the statements for the month of June', additional_kwargs={}, response_metadata={}, id='da2ec700-6db4-43f0-aee9-24573b19b9bc'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='2aa9d10e-66bd-454b-810b-1dc9dceb162b'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ee18b617-c6b1-4daa-ae3c-637dca80e8c1'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='4f59568f-f7c7-485c-81a1-1d850e027caf'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1661a69f-4c1f-48d3-acc3-8c4373418271'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='50e52376-0a53-4594-943f-ee5ccccce2b7'),
 AIMessage(content="\n\n\nFirst, I'll check if the transactions for ICICI account XXXXXXXX9469 for June 2025 are already in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--af115e4d-eb46-44dc-aa38-127d1dc43a07-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': 'd60920cc-3db6-4474-be92-6f84eccead02', 'type': 'tool_call'}], usage_metadata={'input_tokens': 836, 'output_tokens': 94, 'total_tokens': 930, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='f03620ee-f3d4-447c-92ef-3cc38e63cda3', tool_call_id='d60920cc-3db6-4474-be92-6f84eccead02'),
 AIMessage(content='\nI did not find the data in the database. I will now fetch the bank statements from Gmail. After that I will extract the transactions and store them in the database.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "ICICI bank statement account: XXXXXXXX9469 June 2025"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--17985ef1-7005-4518-b22f-0bdc668aebe8-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'ICICI bank statement account: XXXXXXXX9469 June 2025'}, 'id': '22fdb976-f9a2-48e7-85d4-50757c77ebe4', 'type': 'tool_call'}], usage_metadata={'input_tokens': 908, 'output_tokens': 60, 'total_tokens': 968, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No PDFs found', name='fetch_gmail_pdfs', id='36c51116-4c7c-4b29-90ab-f00cff04e94b', tool_call_id='22fdb976-f9a2-48e7-85d4-50757c77ebe4'),
 SystemMessage(content='User intends to ask: analyse statements for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:53:42,422 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='I was unable to find the statements in the database or in your Gmail. Can you please check if you have the statement in your Gmail? I can look for it if you can provide a more precise query, including sender and subject if possible.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--3f570fb4-d5d4-4885-ada3-d4ddbed93357-0', usage_metadata={'input_tokens': 943, 'output_tokens': 50, 'total_tokens': 993, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:53:42,426 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='d8aee25b-c9ea-40db-832e-1a5f2c7d7f2f'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='dd6df9c4-4372-420f-8718-9588796e82bd'),
              HumanMessage(content='I am interested for the ICICI bank account 9469', additional_kwargs={}, response_metadata={}, id='8086762d-c39d-42c3-91f4-7c1417641bb8'),
              AIMessage(content=' To proceed, could you specify your month?', additional_kwargs={}, response_metadata={}, id='0e565c95-e2ef-4294-8fba-034c672c8961'),
              HumanMessage(content='analyse the statements for the month of June', additional_kwargs={}, response_metadata={}, id='da2ec700-6db4-43f0-aee9-24573b19b9bc'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='2aa9d10e-66bd-454b-810b-1dc9dceb162b'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='ee18b617-c6b1-4daa-ae3c-637dca80e8c1'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='4f59568f-f7c7-485c-81a1-1d850e027caf'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: analyse statements\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: None\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1661a69f-4c1f-48d3-acc3-8c4373418271'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='50e52376-0a53-4594-943f-ee5ccccce2b7'),
              AIMessage(content="\n\n\nFirst, I'll check if the transactions for ICICI account XXXXXXXX9469 for June 2025 are already in the database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--af115e4d-eb46-44dc-aa38-127d1dc43a07-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': 'd60920cc-3db6-4474-be92-6f84eccead02', 'type': 'tool_call'}], usage_metadata={'input_tokens': 836, 'output_tokens': 94, 'total_tokens': 930, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='No data found.', name='query_duckdb_tool', id='f03620ee-f3d4-447c-92ef-3cc38e63cda3', tool_call_id='d60920cc-3db6-4474-be92-6f84eccead02'),
              AIMessage(content='\nI did not find the data in the database. I will now fetch the bank statements from Gmail. After that I will extract the transactions and store them in the database.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "ICICI bank statement account: XXXXXXXX9469 June 2025"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--17985ef1-7005-4518-b22f-0bdc668aebe8-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'ICICI bank statement account: XXXXXXXX9469 June 2025'}, 'id': '22fdb976-f9a2-48e7-85d4-50757c77ebe4', 'type': 'tool_call'}], usage_metadata={'input_tokens': 908, 'output_tokens': 60, 'total_tokens': 968, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='No PDFs found', name='fetch_gmail_pdfs', id='36c51116-4c7c-4b29-90ab-f00cff04e94b', tool_call_id='22fdb976-f9a2-48e7-85d4-50757c77ebe4'),
              AIMessage(content='\nI was unable to find the statements in the database or in your Gmail. Can you please check if you have the statement in your Gmail? I can look for it if you can provide a more precise query, including sender and subject if possible.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--3f570fb4-d5d4-4885-ada3-d4ddbed93357-0', usage_metadata={'input_tokens': 943, 'output_tokens': 50, 'total_tokens': 993, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='analyse statements', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint=None)}
2025-07-14 05:57:42,941 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:57:42,942 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 05:57:42,943 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}], 'validated_query': None}
2025-07-14 05:57:42,955 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11f342470> default_metadata=() model_kwargs={}
2025-07-14 05:57:42,994 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:57:42,995 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {}
2025-07-14 05:57:42,995 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:57:45,516 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:57:45,516 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': None, 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:57:45,516 - graph - INFO - Merged final_query: Intent: None, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:57:45,517 - graph - INFO - Start routing logic
2025-07-14 05:57:45,517 - graph - INFO - Validated Query Check: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:57:45,517 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:57:45,519 - graph - INFO - Confirm node start...
2025-07-14 05:57:45,519 - graph - INFO - user's last message: content='analyse the ICICI bank account 9469 for the month of June' additional_kwargs={} response_metadata={} id='3f1f650c-48fe-41b6-bc1d-f7b355136dc0'
2025-07-14 05:57:45,519 - graph - INFO - Start routing logic
2025-07-14 05:57:45,521 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='3f1f650c-48fe-41b6-bc1d-f7b355136dc0'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='9cd037dd-4441-43a0-bd29-f739929fc39d'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='7b212e25-e0d7-4e2c-a720-0e7be4a73b98')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 05:57:51,835 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:57:51,837 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 05:57:51,837 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 05:57:51,840 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e37f130> default_metadata=() model_kwargs={}
2025-07-14 05:57:51,874 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:57:51,874 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:57:51,875 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:57:53,956 - graph - INFO - Existing vq : {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:57:53,956 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:57:53,957 - graph - INFO - Merged final_query: Intent: None, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:57:53,957 - graph - INFO - Start routing logic
2025-07-14 05:57:53,957 - graph - INFO - Validated Query Check: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:57:53,957 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:57:53,958 - graph - INFO - Confirm node start...
2025-07-14 05:57:53,958 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'
2025-07-14 05:57:53,959 - graph - INFO - Start routing logic
2025-07-14 05:57:53,959 - graph - INFO - Validated Query Check: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:57:53,959 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 05:57:53,960 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:57:53,961 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='f81cab00-3ef5-42ed-9b20-a68b64e47fa0'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4c0b2ff3-0d5e-4480-87a9-6d896b5b57ac'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ee896e3c-4be4-457c-a2bb-b4ffaea37ee6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='473b04c4-9d3a-4c98-8fb3-910f451d9775'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c0572d26-9089-421a-8bbf-c8a78fb50163'),
 SystemMessage(content='User intends to ask: None for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:57:55,390 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="\n\n**Step 1: Check DuckDB for existing data**\n\nI'll start by checking if we already have the transaction data for ICICI account XXXXXXXX9469 for June 2025 in our database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1186b443-a4e0-4ef3-a634-788204d3acc8-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': '2eabff38-3fb3-4075-8bf4-86ba3c018586', 'type': 'tool_call'}], usage_metadata={'input_tokens': 874, 'output_tokens': 110, 'total_tokens': 984, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:57:55,394 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 05:57:55,423 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:57:55,424 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='f81cab00-3ef5-42ed-9b20-a68b64e47fa0'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4c0b2ff3-0d5e-4480-87a9-6d896b5b57ac'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ee896e3c-4be4-457c-a2bb-b4ffaea37ee6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='473b04c4-9d3a-4c98-8fb3-910f451d9775'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c0572d26-9089-421a-8bbf-c8a78fb50163'),
 AIMessage(content="\n\n\n**Step 1: Check DuckDB for existing data**\n\nI'll start by checking if we already have the transaction data for ICICI account XXXXXXXX9469 for June 2025 in our database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1186b443-a4e0-4ef3-a634-788204d3acc8-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': '2eabff38-3fb3-4075-8bf4-86ba3c018586', 'type': 'tool_call'}], usage_metadata={'input_tokens': 874, 'output_tokens': 110, 'total_tokens': 984, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='4dabe10e-b1f2-46f9-8a36-72f6be25cb73', tool_call_id='2eabff38-3fb3-4075-8bf4-86ba3c018586'),
 SystemMessage(content='User intends to ask: None for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:57:56,498 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='ok. I will fetch bank statements from Gmail, decrypt and extract transactions.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2a3f2591-3c39-4ef4-b2b1-22ef5a4a7781-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': 'c84b5c44-bd58-4863-b26a-47e8f304e76e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 946, 'output_tokens': 60, 'total_tokens': 1006, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:57:56,501 - utils - INFO - Entering search_gmail_with_pdfs...
2025-07-14 05:57:56,507 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-07-14 05:57:56,509 - utils - INFO - Search Query : from:(estatement@icicibank.com) label:inbox subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:57:57,296 - utils - INFO - ‚úÖ Found 1 message(s) for query
2025-07-14 05:57:57,737 - utils - INFO - Enetering print_email_summary()
2025-07-14 05:57:57,737 - utils - INFO - Subject: ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469
2025-07-14 05:57:57,737 - utils - INFO - From: Estatement <estatement@icicibank.com>
2025-07-14 05:57:57,737 - utils - INFO - No plain text body found
2025-07-14 05:57:57,738 - utils - INFO - Entering save_pdf_from_message() ...
2025-07-14 05:57:58,326 - utils - INFO - PDFs found : ['Downloaded: downloads/Statement_2025MTH06_787512432.pdf']
2025-07-14 05:57:58,326 - utils - INFO - Exitting save_pdf_from_message() ...
2025-07-14 05:57:58,328 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:57:58,329 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='f81cab00-3ef5-42ed-9b20-a68b64e47fa0'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4c0b2ff3-0d5e-4480-87a9-6d896b5b57ac'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ee896e3c-4be4-457c-a2bb-b4ffaea37ee6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='473b04c4-9d3a-4c98-8fb3-910f451d9775'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c0572d26-9089-421a-8bbf-c8a78fb50163'),
 AIMessage(content="\n\n\n**Step 1: Check DuckDB for existing data**\n\nI'll start by checking if we already have the transaction data for ICICI account XXXXXXXX9469 for June 2025 in our database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1186b443-a4e0-4ef3-a634-788204d3acc8-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': '2eabff38-3fb3-4075-8bf4-86ba3c018586', 'type': 'tool_call'}], usage_metadata={'input_tokens': 874, 'output_tokens': 110, 'total_tokens': 984, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='4dabe10e-b1f2-46f9-8a36-72f6be25cb73', tool_call_id='2eabff38-3fb3-4075-8bf4-86ba3c018586'),
 AIMessage(content='\nok. I will fetch bank statements from Gmail, decrypt and extract transactions.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2a3f2591-3c39-4ef4-b2b1-22ef5a4a7781-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': 'c84b5c44-bd58-4863-b26a-47e8f304e76e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 946, 'output_tokens': 60, 'total_tokens': 1006, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='90afb689-50d3-4622-9761-8e8c6c163671', tool_call_id='c84b5c44-bd58-4863-b26a-47e8f304e76e'),
 SystemMessage(content='User intends to ask: None for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:57:59,281 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2f96c312-0edb-4ff8-adcd-9960d0e4a4fa-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '657a1ccd-2705-4807-ad68-033c81c7eb7e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1023, 'output_tokens': 33, 'total_tokens': 1056, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:57:59,286 - utils - INFO - Entering decrypt_with_pikepdf() ...
2025-07-14 05:57:59,303 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:57:59,304 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='f81cab00-3ef5-42ed-9b20-a68b64e47fa0'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4c0b2ff3-0d5e-4480-87a9-6d896b5b57ac'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ee896e3c-4be4-457c-a2bb-b4ffaea37ee6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='473b04c4-9d3a-4c98-8fb3-910f451d9775'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c0572d26-9089-421a-8bbf-c8a78fb50163'),
 AIMessage(content="\n\n\n**Step 1: Check DuckDB for existing data**\n\nI'll start by checking if we already have the transaction data for ICICI account XXXXXXXX9469 for June 2025 in our database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1186b443-a4e0-4ef3-a634-788204d3acc8-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': '2eabff38-3fb3-4075-8bf4-86ba3c018586', 'type': 'tool_call'}], usage_metadata={'input_tokens': 874, 'output_tokens': 110, 'total_tokens': 984, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='4dabe10e-b1f2-46f9-8a36-72f6be25cb73', tool_call_id='2eabff38-3fb3-4075-8bf4-86ba3c018586'),
 AIMessage(content='\nok. I will fetch bank statements from Gmail, decrypt and extract transactions.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2a3f2591-3c39-4ef4-b2b1-22ef5a4a7781-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': 'c84b5c44-bd58-4863-b26a-47e8f304e76e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 946, 'output_tokens': 60, 'total_tokens': 1006, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='90afb689-50d3-4622-9761-8e8c6c163671', tool_call_id='c84b5c44-bd58-4863-b26a-47e8f304e76e'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2f96c312-0edb-4ff8-adcd-9960d0e4a4fa-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '657a1ccd-2705-4807-ad68-033c81c7eb7e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1023, 'output_tokens': 33, 'total_tokens': 1056, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='eeeec769-b605-40ff-9b7d-cdbac3b583c0', tool_call_id='657a1ccd-2705-4807-ad68-033c81c7eb7e'),
 SystemMessage(content='User intends to ask: None for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:58:00,614 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2d541542-39ac-434d-8f68-848693c4f531-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': '7c5e9b27-862e-4473-b615-8cba8604e6ca', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1088, 'output_tokens': 47, 'total_tokens': 1135, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:58:00,618 - utils - INFO - Entering parse_icici__statement() ...
2025-07-14 05:58:00,623 - utils - INFO - 
üìÑ Processing page 1
2025-07-14 05:58:00,713 - utils - INFO - Extracted 40 lines from page 1
2025-07-14 05:58:00,713 - utils - INFO - 
üìÑ Processing page 2
2025-07-14 05:58:00,774 - utils - INFO - Extracted 178 lines from page 2
2025-07-14 05:58:00,774 - duckdb_tools - INFO - Entering store_transactions_to_duckdb() with 5 transactions and finance.db database 
2025-07-14 05:58:00,790 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:58:00,791 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='f81cab00-3ef5-42ed-9b20-a68b64e47fa0'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4c0b2ff3-0d5e-4480-87a9-6d896b5b57ac'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ee896e3c-4be4-457c-a2bb-b4ffaea37ee6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='473b04c4-9d3a-4c98-8fb3-910f451d9775'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c0572d26-9089-421a-8bbf-c8a78fb50163'),
 AIMessage(content="\n\n\n**Step 1: Check DuckDB for existing data**\n\nI'll start by checking if we already have the transaction data for ICICI account XXXXXXXX9469 for June 2025 in our database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1186b443-a4e0-4ef3-a634-788204d3acc8-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': '2eabff38-3fb3-4075-8bf4-86ba3c018586', 'type': 'tool_call'}], usage_metadata={'input_tokens': 874, 'output_tokens': 110, 'total_tokens': 984, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='4dabe10e-b1f2-46f9-8a36-72f6be25cb73', tool_call_id='2eabff38-3fb3-4075-8bf4-86ba3c018586'),
 AIMessage(content='\nok. I will fetch bank statements from Gmail, decrypt and extract transactions.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2a3f2591-3c39-4ef4-b2b1-22ef5a4a7781-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': 'c84b5c44-bd58-4863-b26a-47e8f304e76e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 946, 'output_tokens': 60, 'total_tokens': 1006, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='90afb689-50d3-4622-9761-8e8c6c163671', tool_call_id='c84b5c44-bd58-4863-b26a-47e8f304e76e'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2f96c312-0edb-4ff8-adcd-9960d0e4a4fa-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '657a1ccd-2705-4807-ad68-033c81c7eb7e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1023, 'output_tokens': 33, 'total_tokens': 1056, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='eeeec769-b605-40ff-9b7d-cdbac3b583c0', tool_call_id='657a1ccd-2705-4807-ad68-033c81c7eb7e'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2d541542-39ac-434d-8f68-848693c4f531-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': '7c5e9b27-862e-4473-b615-8cba8604e6ca', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1088, 'output_tokens': 47, 'total_tokens': 1135, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Inserted 5 new transactions out of 5 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='46e4ed89-b2c8-459c-8e8f-e994ea97a078', tool_call_id='7c5e9b27-862e-4473-b615-8cba8604e6ca'),
 SystemMessage(content='User intends to ask: None for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:58:01,884 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--5fbd6217-4d5b-4974-8fe2-e3d8d76418d3-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': 'efd5decf-0f96-4efe-b5a0-a9efb748dc20', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1164, 'output_tokens': 61, 'total_tokens': 1225, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:58:01,887 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 05:58:01,911 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:58:01,912 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='f81cab00-3ef5-42ed-9b20-a68b64e47fa0'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4c0b2ff3-0d5e-4480-87a9-6d896b5b57ac'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ee896e3c-4be4-457c-a2bb-b4ffaea37ee6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='473b04c4-9d3a-4c98-8fb3-910f451d9775'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c0572d26-9089-421a-8bbf-c8a78fb50163'),
 AIMessage(content="\n\n\n**Step 1: Check DuckDB for existing data**\n\nI'll start by checking if we already have the transaction data for ICICI account XXXXXXXX9469 for June 2025 in our database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1186b443-a4e0-4ef3-a634-788204d3acc8-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': '2eabff38-3fb3-4075-8bf4-86ba3c018586', 'type': 'tool_call'}], usage_metadata={'input_tokens': 874, 'output_tokens': 110, 'total_tokens': 984, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='No data found.', name='query_duckdb_tool', id='4dabe10e-b1f2-46f9-8a36-72f6be25cb73', tool_call_id='2eabff38-3fb3-4075-8bf4-86ba3c018586'),
 AIMessage(content='\nok. I will fetch bank statements from Gmail, decrypt and extract transactions.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2a3f2591-3c39-4ef4-b2b1-22ef5a4a7781-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': 'c84b5c44-bd58-4863-b26a-47e8f304e76e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 946, 'output_tokens': 60, 'total_tokens': 1006, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='90afb689-50d3-4622-9761-8e8c6c163671', tool_call_id='c84b5c44-bd58-4863-b26a-47e8f304e76e'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2f96c312-0edb-4ff8-adcd-9960d0e4a4fa-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '657a1ccd-2705-4807-ad68-033c81c7eb7e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1023, 'output_tokens': 33, 'total_tokens': 1056, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='eeeec769-b605-40ff-9b7d-cdbac3b583c0', tool_call_id='657a1ccd-2705-4807-ad68-033c81c7eb7e'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2d541542-39ac-434d-8f68-848693c4f531-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': '7c5e9b27-862e-4473-b615-8cba8604e6ca', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1088, 'output_tokens': 47, 'total_tokens': 1135, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Inserted 5 new transactions out of 5 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='46e4ed89-b2c8-459c-8e8f-e994ea97a078', tool_call_id='7c5e9b27-862e-4473-b615-8cba8604e6ca'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--5fbd6217-4d5b-4974-8fe2-e3d8d76418d3-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': 'efd5decf-0f96-4efe-b5a0-a9efb748dc20', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1164, 'output_tokens': 61, 'total_tokens': 1225, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='| date                | description                                                                                       |   amount |   balance | mode            | type    | receiver        | bank   | account_no   |\n|:--------------------|:--------------------------------------------------------------------------------------------------|---------:|----------:|:----------------|:--------|:----------------|:-------|:-------------|\n| 2025-06-01 00:00:00 | Balance Forward                                                                                   |        0 |    276.25 | B/F             | BALANCE |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-13 00:00:00 | MMT/IMPS/516407166609/SATYA SUND/SBIN0018701                                                      |        3 |    273.25 | MOBILE BANKING  | DEBIT   |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-20 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/IDFOP0482ylnAhGLyKNOBFbC0FRjUUe okzR |     2000 |   2273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-29 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/IDFOP2382zBCm7MgqfHTVwfEIBJ7QKI NW8k |     3000 |   5273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-30 00:00:00 | NW8k 000201599469:Int.Pd:29-03-2025 to 29-06-2025 Total: 5,007.00 3.00 5,280.25                   |        7 |   5280.25 | Interest Credit | CREDIT  | ICICI           | ICICI  | XXXXXXXX9469 |', name='query_duckdb_tool', id='be52ddf3-54f6-400c-96cc-6226a61af0d8', tool_call_id='efd5decf-0f96-4efe-b5a0-a9efb748dc20'),
 SystemMessage(content='User intends to ask: None for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:58:04,402 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="Here's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--9fa7d9e9-ffea-473c-9d38-932545b26122-0', usage_metadata={'input_tokens': 1833, 'output_tokens': 376, 'total_tokens': 2209, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:58:04,407 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='f81cab00-3ef5-42ed-9b20-a68b64e47fa0'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4c0b2ff3-0d5e-4480-87a9-6d896b5b57ac'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b98c7b4f-7ac4-4f79-ba97-f2954d2efe7d'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ee896e3c-4be4-457c-a2bb-b4ffaea37ee6'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='473b04c4-9d3a-4c98-8fb3-910f451d9775'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c0572d26-9089-421a-8bbf-c8a78fb50163'),
              AIMessage(content="\n\n\n**Step 1: Check DuckDB for existing data**\n\nI'll start by checking if we already have the transaction data for ICICI account XXXXXXXX9469 for June 2025 in our database.", additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1186b443-a4e0-4ef3-a634-788204d3acc8-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': '2eabff38-3fb3-4075-8bf4-86ba3c018586', 'type': 'tool_call'}], usage_metadata={'input_tokens': 874, 'output_tokens': 110, 'total_tokens': 984, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='No data found.', name='query_duckdb_tool', id='4dabe10e-b1f2-46f9-8a36-72f6be25cb73', tool_call_id='2eabff38-3fb3-4075-8bf4-86ba3c018586'),
              AIMessage(content='\nok. I will fetch bank statements from Gmail, decrypt and extract transactions.', additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2a3f2591-3c39-4ef4-b2b1-22ef5a4a7781-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}, 'id': 'c84b5c44-bd58-4863-b26a-47e8f304e76e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 946, 'output_tokens': 60, 'total_tokens': 1006, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_787512432.pdf', name='fetch_gmail_pdfs', id='90afb689-50d3-4622-9761-8e8c6c163671', tool_call_id='c84b5c44-bd58-4863-b26a-47e8f304e76e'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2f96c312-0edb-4ff8-adcd-9960d0e4a4fa-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432.pdf', 'bank': 'ICICI'}, 'id': '657a1ccd-2705-4807-ad68-033c81c7eb7e', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1023, 'output_tokens': 33, 'total_tokens': 1056, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='downloads/Statement_2025MTH06_787512432_decrypted.pdf', name='decrypt_pdf_tool', id='eeeec769-b605-40ff-9b7d-cdbac3b583c0', tool_call_id='657a1ccd-2705-4807-ad68-033c81c7eb7e'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_787512432_decrypted.pdf", "account_no": "XXXXXXXX9469", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--2d541542-39ac-434d-8f68-848693c4f531-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_787512432_decrypted.pdf', 'account_no': 'XXXXXXXX9469', 'bank': 'ICICI'}, 'id': '7c5e9b27-862e-4473-b615-8cba8604e6ca', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1088, 'output_tokens': 47, 'total_tokens': 1135, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='Inserted 5 new transactions out of 5 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='46e4ed89-b2c8-459c-8e8f-e994ea97a078', tool_call_id='7c5e9b27-862e-4473-b615-8cba8604e6ca'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT * FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date >= \'2025-06-01\' AND date <= \'2025-06-30\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--5fbd6217-4d5b-4974-8fe2-e3d8d76418d3-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT * FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date >= '2025-06-01' AND date <= '2025-06-30'"}, 'id': 'efd5decf-0f96-4efe-b5a0-a9efb748dc20', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1164, 'output_tokens': 61, 'total_tokens': 1225, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='| date                | description                                                                                       |   amount |   balance | mode            | type    | receiver        | bank   | account_no   |\n|:--------------------|:--------------------------------------------------------------------------------------------------|---------:|----------:|:----------------|:--------|:----------------|:-------|:-------------|\n| 2025-06-01 00:00:00 | Balance Forward                                                                                   |        0 |    276.25 | B/F             | BALANCE |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-13 00:00:00 | MMT/IMPS/516407166609/SATYA SUND/SBIN0018701                                                      |        3 |    273.25 | MOBILE BANKING  | DEBIT   |                 | ICICI  | XXXXXXXX9469 |\n| 2025-06-20 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/IDFOP0482ylnAhGLyKNOBFbC0FRjUUe okzR |     2000 |   2273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-29 00:00:00 | UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/IDFOP2382zBCm7MgqfHTVwfEIBJ7QKI NW8k |     3000 |   5273.25 | UPI             | CREDIT  | 6370246997@idfc | ICICI  | XXXXXXXX9469 |\n| 2025-06-30 00:00:00 | NW8k 000201599469:Int.Pd:29-03-2025 to 29-06-2025 Total: 5,007.00 3.00 5,280.25                   |        7 |   5280.25 | Interest Credit | CREDIT  | ICICI           | ICICI  | XXXXXXXX9469 |', name='query_duckdb_tool', id='be52ddf3-54f6-400c-96cc-6226a61af0d8', tool_call_id='efd5decf-0f96-4efe-b5a0-a9efb748dc20'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--9fa7d9e9-ffea-473c-9d38-932545b26122-0', usage_metadata={'input_tokens': 1833, 'output_tokens': 376, 'total_tokens': 2209, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 05:58:56,017 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:58:56,018 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 05:58:56,019 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}], 'validated_query': {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 05:58:56,026 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e385850> default_metadata=() model_kwargs={}
2025-07-14 05:58:56,059 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:58:56,060 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:58:56,060 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:58:58,155 - graph - INFO - Existing vq : {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:58:58,156 - graph - INFO - vq after - new parsed message from user: {'intent': 'get highest transactions', 'bank': None, 'account_no': None, 'month': 'June', 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:58:58,156 - graph - INFO - Merged final_query: Intent: get highest transactions, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:58:58,156 - graph - INFO - Start routing logic
2025-07-14 05:58:58,156 - graph - INFO - Validated Query Check: {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:58:58,157 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:58:58,157 - graph - INFO - Confirm node start...
2025-07-14 05:58:58,157 - graph - INFO - user's last message: content='tell me the highest transactions made in a single day in the month of June?' additional_kwargs={} response_metadata={} id='46f5ed43-c883-4d03-8626-810389b7f70a'
2025-07-14 05:58:58,158 - graph - INFO - Start routing logic
2025-07-14 05:58:58,159 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='be7aab2e-f2f8-40cd-8357-6b193e613727'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='14d1fc05-3f11-4a3b-9d84-7c1a4326b2c7'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b0a77d05-6998-4657-b11b-23c6d99c5556'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='3252e5b9-971c-4d20-a7f5-f41e4c1cfed8'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='46f5ed43-c883-4d03-8626-810389b7f70a'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='4fb10419-be30-4f4e-932d-02cd62372deb'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9cfe5edc-fb8e-48f9-aa89-3886feb6c51c')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get highest transactions', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 05:59:06,515 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:59:06,517 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get highest transactions', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 05:59:06,517 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 05:59:06,521 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11f347850> default_metadata=() model_kwargs={}
2025-07-14 05:59:06,555 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:59:06,555 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:59:06,555 - graph - INFO - 2.Validation Node entered...
2025-07-14 05:59:08,533 - graph - INFO - Existing vq : {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:59:08,533 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 05:59:08,533 - graph - INFO - Merged final_query: Intent: get highest transactions, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 05:59:08,534 - graph - INFO - Start routing logic
2025-07-14 05:59:08,534 - graph - INFO - Validated Query Check: {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:59:08,534 - graph - INFO - Awaiting user confirmation.
2025-07-14 05:59:08,535 - graph - INFO - Confirm node start...
2025-07-14 05:59:08,535 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='f2adb07c-d9e7-40a3-80e2-d7693eec2398'
2025-07-14 05:59:08,536 - graph - INFO - Start routing logic
2025-07-14 05:59:08,536 - graph - INFO - Validated Query Check: {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 05:59:08,536 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 05:59:08,537 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:59:08,539 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='4b7c06fb-cac5-4aaa-bdff-304162490cad'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='8067261c-6a4f-43f8-801f-955b61f4c9c8'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='a8a1d0ad-6fc2-43e8-9515-42f53cf51c19'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='12508ac0-a105-49c7-bbb0-63b807cb922e'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='e1f1a674-7a2e-4f8e-9b87-3da0f5886fa7'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d3bc77b0-6a8b-4d74-a01b-ac2b5943311d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='f2adb07c-d9e7-40a3-80e2-d7693eec2398'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ae07e170-83bb-4843-ac8f-512978768e9d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='be113000-088d-4e0f-a431-e6b786232b51'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='650b79c4-b3a1-4688-adff-c735ecdc160f'),
 SystemMessage(content='User intends to ask: get highest transactions for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:59:09,837 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT date, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' GROUP BY date ORDER BY total_amount DESC LIMIT 1"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1439f6d1-624e-41cc-9c89-18be41a7354d-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT date, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30' GROUP BY date ORDER BY total_amount DESC LIMIT 1"}, 'id': '7aedc543-d1fd-409f-963d-72a7027c5605', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1394, 'output_tokens': 81, 'total_tokens': 1475, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:59:09,839 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 05:59:09,870 - graph - INFO - ****** Entering chatbot ...

2025-07-14 05:59:09,871 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='4b7c06fb-cac5-4aaa-bdff-304162490cad'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='8067261c-6a4f-43f8-801f-955b61f4c9c8'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='a8a1d0ad-6fc2-43e8-9515-42f53cf51c19'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='12508ac0-a105-49c7-bbb0-63b807cb922e'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='e1f1a674-7a2e-4f8e-9b87-3da0f5886fa7'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d3bc77b0-6a8b-4d74-a01b-ac2b5943311d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='f2adb07c-d9e7-40a3-80e2-d7693eec2398'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ae07e170-83bb-4843-ac8f-512978768e9d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='be113000-088d-4e0f-a431-e6b786232b51'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='650b79c4-b3a1-4688-adff-c735ecdc160f'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT date, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' GROUP BY date ORDER BY total_amount DESC LIMIT 1"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1439f6d1-624e-41cc-9c89-18be41a7354d-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT date, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30' GROUP BY date ORDER BY total_amount DESC LIMIT 1"}, 'id': '7aedc543-d1fd-409f-963d-72a7027c5605', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1394, 'output_tokens': 81, 'total_tokens': 1475, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='| date                |   total_amount |\n|:--------------------|---------------:|\n| 2025-06-29 00:00:00 |           3000 |', name='query_duckdb_tool', id='ae2fcebb-ad3c-43bd-917e-5682c3c1f949', tool_call_id='7aedc543-d1fd-409f-963d-72a7027c5605'),
 SystemMessage(content='User intends to ask: get highest transactions for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 05:59:10,789 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='The highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6e8757fd-267e-4307-b173-dcc2be7db433-0', usage_metadata={'input_tokens': 1525, 'output_tokens': 52, 'total_tokens': 1577, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 05:59:10,793 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='4b7c06fb-cac5-4aaa-bdff-304162490cad'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='8067261c-6a4f-43f8-801f-955b61f4c9c8'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='a8a1d0ad-6fc2-43e8-9515-42f53cf51c19'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='12508ac0-a105-49c7-bbb0-63b807cb922e'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='e1f1a674-7a2e-4f8e-9b87-3da0f5886fa7'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d3bc77b0-6a8b-4d74-a01b-ac2b5943311d'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='f2adb07c-d9e7-40a3-80e2-d7693eec2398'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ae07e170-83bb-4843-ac8f-512978768e9d'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='be113000-088d-4e0f-a431-e6b786232b51'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='650b79c4-b3a1-4688-adff-c735ecdc160f'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT date, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' GROUP BY date ORDER BY total_amount DESC LIMIT 1"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--1439f6d1-624e-41cc-9c89-18be41a7354d-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT date, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND date BETWEEN '2025-06-01' AND '2025-06-30' GROUP BY date ORDER BY total_amount DESC LIMIT 1"}, 'id': '7aedc543-d1fd-409f-963d-72a7027c5605', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1394, 'output_tokens': 81, 'total_tokens': 1475, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='| date                |   total_amount |\n|:--------------------|---------------:|\n| 2025-06-29 00:00:00 |           3000 |', name='query_duckdb_tool', id='ae2fcebb-ad3c-43bd-917e-5682c3c1f949', tool_call_id='7aedc543-d1fd-409f-963d-72a7027c5605'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6e8757fd-267e-4307-b173-dcc2be7db433-0', usage_metadata={'input_tokens': 1525, 'output_tokens': 52, 'total_tokens': 1577, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get highest transactions', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 05:59:58,901 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 05:59:58,902 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get highest transactions', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 05:59:58,902 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}], 'validated_query': {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 05:59:58,906 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e56cd70> default_metadata=() model_kwargs={}
2025-07-14 05:59:58,941 - graph - INFO - 1.Planning Node entered...
2025-07-14 05:59:58,941 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 05:59:58,941 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:00:01,029 - graph - INFO - Existing vq : {'intent': 'get highest transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:00:01,030 - graph - INFO - vq after - new parsed message from user: {'intent': 'who is the receiver of this amount?', 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:00:01,030 - graph - INFO - Merged final_query: Intent: who is the receiver of this amount?, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 06:00:01,030 - graph - INFO - Start routing logic
2025-07-14 06:00:01,031 - graph - INFO - Validated Query Check: {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 06:00:01,031 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:00:01,032 - graph - INFO - Confirm node start...
2025-07-14 06:00:01,032 - graph - INFO - user's last message: content='who is the receiver of this amount?' additional_kwargs={} response_metadata={} id='a4618500-5441-4b8b-aa43-0bf9050c020b'
2025-07-14 06:00:01,032 - graph - INFO - Start routing logic
2025-07-14 06:00:01,035 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='7deb2db7-5969-4ca2-805b-9d021336c0f8'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='93f7b838-2c0f-4be7-a497-88ddaf3106ca'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='4580d73c-34bd-4191-bfce-2a11d76b8eb5'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='e7ffe410-2dae-404a-a018-b88a89292ad4'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='e869845a-7c4f-4d45-8342-cb9cb68c598b'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='5d152d25-1689-49f5-91b8-2ad6b4f017af'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='0c962735-1d04-4588-b196-2ca9642a2c07'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='5c949fcb-628e-403a-ba2e-07460a895813'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='a4618500-5441-4b8b-aa43-0bf9050c020b'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='fa1d919f-0a30-460d-bc83-8ee377fa9601'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='fd26830e-cd3e-4924-9c08-2cf6ab465ce5')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='who is the receiver of this amount?', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 06:00:07,692 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:00:07,694 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='who is the receiver of this amount?', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 06:00:07,694 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 06:00:07,697 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e56caa0> default_metadata=() model_kwargs={}
2025-07-14 06:00:07,732 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:00:07,732 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:00:07,733 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:00:09,842 - graph - INFO - Existing vq : {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:00:09,842 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:00:09,842 - graph - INFO - Merged final_query: Intent: who is the receiver of this amount?, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 06:00:09,843 - graph - INFO - Start routing logic
2025-07-14 06:00:09,843 - graph - INFO - Validated Query Check: {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 06:00:09,843 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:00:09,844 - graph - INFO - Confirm node start...
2025-07-14 06:00:09,844 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='07dc0c28-8d36-48b7-b418-1763bbdf7568'
2025-07-14 06:00:09,845 - graph - INFO - Start routing logic
2025-07-14 06:00:09,845 - graph - INFO - Validated Query Check: {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 06:00:09,845 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 06:00:09,846 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:00:09,848 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='1d6de00d-6fc5-438e-9bad-fa707a20bc42'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='167c54a4-87a5-49ad-bdd1-7c640c13010e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7bbcee23-a664-4c7e-99cf-3cc5dca6eba1'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='0e156bd5-07ca-4788-94cc-6a4f2bea2506'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='de62fe0e-bb76-43c7-8a06-d93796efb9de'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9834d4a1-8fb8-449c-9703-ffa6e8853dde'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5a155791-8a68-4d7f-a274-dc0dcdf7a395'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='b221bcfd-7f70-46f1-ab17-a1b467befe40'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='9c6788ff-3278-4e5d-8284-86e1f43257d4'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='a90a751f-4b3b-4bc1-ba29-32b4db01c7e4'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='07dc0c28-8d36-48b7-b418-1763bbdf7568'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='faf80991-e8bf-4bbe-bb34-7a21d40c5dbf'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='719182a4-6c2a-4cb7-9a29-c93f5949b735'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='55677818-7e4d-4914-8393-5db4f0eec073'),
 SystemMessage(content='User intends to ask: who is the receiver of this amount? for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:00:10,971 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT receiver FROM TRANSACTIONS WHERE date = \'2025-06-29\' AND bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND amount = 3000"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--0d722b19-201b-4d34-b56f-c0bcd1f03407-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT receiver FROM TRANSACTIONS WHERE date = '2025-06-29' AND bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND amount = 3000"}, 'id': '5d9783a9-1728-4434-84cd-f08b1c022a67', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1592, 'output_tokens': 55, 'total_tokens': 1647, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:00:10,974 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:00:10,999 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:00:11,000 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='1d6de00d-6fc5-438e-9bad-fa707a20bc42'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='167c54a4-87a5-49ad-bdd1-7c640c13010e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7bbcee23-a664-4c7e-99cf-3cc5dca6eba1'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='0e156bd5-07ca-4788-94cc-6a4f2bea2506'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='de62fe0e-bb76-43c7-8a06-d93796efb9de'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9834d4a1-8fb8-449c-9703-ffa6e8853dde'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5a155791-8a68-4d7f-a274-dc0dcdf7a395'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='b221bcfd-7f70-46f1-ab17-a1b467befe40'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='9c6788ff-3278-4e5d-8284-86e1f43257d4'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='a90a751f-4b3b-4bc1-ba29-32b4db01c7e4'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='07dc0c28-8d36-48b7-b418-1763bbdf7568'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='faf80991-e8bf-4bbe-bb34-7a21d40c5dbf'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='719182a4-6c2a-4cb7-9a29-c93f5949b735'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='55677818-7e4d-4914-8393-5db4f0eec073'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT receiver FROM TRANSACTIONS WHERE date = \'2025-06-29\' AND bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND amount = 3000"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--0d722b19-201b-4d34-b56f-c0bcd1f03407-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT receiver FROM TRANSACTIONS WHERE date = '2025-06-29' AND bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND amount = 3000"}, 'id': '5d9783a9-1728-4434-84cd-f08b1c022a67', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1592, 'output_tokens': 55, 'total_tokens': 1647, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='| receiver        |\n|:----------------|\n| 6370246997@idfc |', name='query_duckdb_tool', id='75065b33-951a-4f1f-8451-4d426ebe2eb6', tool_call_id='5d9783a9-1728-4434-84cd-f08b1c022a67'),
 SystemMessage(content='User intends to ask: who is the receiver of this amount? for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:00:11,981 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='The receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--044a33a2-778a-4906-a166-3d3119a8f044-0', usage_metadata={'input_tokens': 1678, 'output_tokens': 51, 'total_tokens': 1729, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:00:11,985 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='1d6de00d-6fc5-438e-9bad-fa707a20bc42'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='167c54a4-87a5-49ad-bdd1-7c640c13010e'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7bbcee23-a664-4c7e-99cf-3cc5dca6eba1'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='0e156bd5-07ca-4788-94cc-6a4f2bea2506'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='de62fe0e-bb76-43c7-8a06-d93796efb9de'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9834d4a1-8fb8-449c-9703-ffa6e8853dde'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5a155791-8a68-4d7f-a274-dc0dcdf7a395'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='b221bcfd-7f70-46f1-ab17-a1b467befe40'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='9c6788ff-3278-4e5d-8284-86e1f43257d4'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='a90a751f-4b3b-4bc1-ba29-32b4db01c7e4'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='07dc0c28-8d36-48b7-b418-1763bbdf7568'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='faf80991-e8bf-4bbe-bb34-7a21d40c5dbf'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='719182a4-6c2a-4cb7-9a29-c93f5949b735'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='55677818-7e4d-4914-8393-5db4f0eec073'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT receiver FROM TRANSACTIONS WHERE date = \'2025-06-29\' AND bank = \'ICICI\' AND account_no = \'XXXXXXXX9469\' AND amount = 3000"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--0d722b19-201b-4d34-b56f-c0bcd1f03407-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT receiver FROM TRANSACTIONS WHERE date = '2025-06-29' AND bank = 'ICICI' AND account_no = 'XXXXXXXX9469' AND amount = 3000"}, 'id': '5d9783a9-1728-4434-84cd-f08b1c022a67', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1592, 'output_tokens': 55, 'total_tokens': 1647, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='| receiver        |\n|:----------------|\n| 6370246997@idfc |', name='query_duckdb_tool', id='75065b33-951a-4f1f-8451-4d426ebe2eb6', tool_call_id='5d9783a9-1728-4434-84cd-f08b1c022a67'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--044a33a2-778a-4906-a166-3d3119a8f044-0', usage_metadata={'input_tokens': 1678, 'output_tokens': 51, 'total_tokens': 1729, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='who is the receiver of this amount?', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 06:00:48,945 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:00:48,947 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='who is the receiver of this amount?', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 06:00:48,947 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}], 'validated_query': {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 06:00:48,952 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12a07ab30> default_metadata=() model_kwargs={}
2025-07-14 06:00:48,987 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:00:48,987 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:00:48,988 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:00:50,954 - graph - INFO - Existing vq : {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:00:50,955 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': 'XXXXXXXX6193', 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:00:50,955 - graph - INFO - Merged final_query: Intent: who is the receiver of this amount?, Bank: ICICI, Account No: XXXXXXXX6193, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 06:00:50,955 - graph - INFO - Start routing logic
2025-07-14 06:00:50,956 - graph - INFO - Validated Query Check: {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 06:00:50,956 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:00:50,957 - graph - INFO - Confirm node start...
2025-07-14 06:00:50,957 - graph - INFO - user's last message: content='i want change account number to 6193' additional_kwargs={} response_metadata={} id='d1fb6394-ffe9-41c7-aaa7-d5c8e343c58e'
2025-07-14 06:00:50,957 - graph - INFO - Start routing logic
2025-07-14 06:00:50,960 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='a77331d8-313e-4034-ba37-b4614c3c6478'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='657d3a3b-009b-4e9d-a29e-125826cec719'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='27b6cd71-deb3-4156-864d-c35357fdedbe'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='46cdc9e0-3fdb-4810-ae7a-9a5b4bbfda4f'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='2cd2b9c7-71b7-4c0e-a4d2-3c8c77b16186'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='aff0ae1d-711c-4296-aed0-97396c1d2437'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d92f1131-2735-420b-b4cb-62b1efedd7b1'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='099be243-5960-462f-a56a-c811afa863a9'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='f856b22a-ccfb-433e-8948-0e4686005b01'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f7d6a4a4-c3c0-44c9-bfc8-826e164956a8'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e57da6cd-aaed-4da3-9788-e9986bc8fef9'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='9462fd00-bf54-4212-b412-4dd5e10cd7e0'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='d1fb6394-ffe9-41c7-aaa7-d5c8e343c58e'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='ad0e2b76-f909-4c6d-a287-8a6f2c0f78a4'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4afd42c1-950a-4fa1-b5d1-cececb7c07ee')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='who is the receiver of this amount?', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 06:01:33,286 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:01:33,287 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='who is the receiver of this amount?', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 06:01:33,288 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}], 'validated_query': {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 06:01:33,291 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12fb52f90> default_metadata=() model_kwargs={}
2025-07-14 06:01:33,326 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:01:33,326 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:01:33,326 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:01:35,551 - graph - INFO - Existing vq : {'intent': 'who is the receiver of this amount?', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:01:35,551 - graph - INFO - vq after - new parsed message from user: {'intent': 'find the total expense', 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:01:35,552 - graph - INFO - Merged final_query: Intent: find the total expense, Bank: ICICI, Account No: XXXXXXXX6193, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 06:01:35,552 - graph - INFO - Start routing logic
2025-07-14 06:01:35,552 - graph - INFO - Validated Query Check: {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 06:01:35,552 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:01:35,553 - graph - INFO - Confirm node start...
2025-07-14 06:01:35,553 - graph - INFO - user's last message: content='modify the intent to find the total expense' additional_kwargs={} response_metadata={} id='646da4d0-a903-4e04-9ae6-0e94fce71488'
2025-07-14 06:01:35,554 - graph - INFO - Start routing logic
2025-07-14 06:01:35,557 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='7ead11d6-a7f4-4ae6-89ef-a3dbec26ff60'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='5c50a35c-b362-4866-b49f-3703d13aa9c7'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='20796ed6-3d56-4a8d-b345-b92035db8fca'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='f1e45ffe-46e5-405f-bb91-042d2b298f90'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='19660375-a387-4a66-8ff3-9cc713aee9a2'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='a7d5afc3-dcee-4b12-919d-5a1dadf69e92'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='998ca5e6-c842-4532-859f-950ee9f3f067'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='ddc80c24-a823-4155-ad97-6addd58f93c7'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='bb969433-9873-4dee-aa44-3f374cf50f24'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b096a173-6918-4128-8d73-6cc52a6ad986'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='cfb56611-9f1c-4538-b26e-6a1af3d19955'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='c0407371-4de0-44b8-ad57-8bb25e8ad8b1'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='36b99f5f-5b6c-4e33-ac30-da1a4018bb69'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='405bbb83-4bb3-467f-9d4e-bccda33ba6be'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='646da4d0-a903-4e04-9ae6-0e94fce71488'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='88be20ad-e80f-49a3-9e4c-791501099558'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1a8941b2-bdd9-4de6-a596-727685bdf2bc')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='find the total expense', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 06:02:22,080 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:02:22,081 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='find the total expense', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 06:02:22,082 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}], 'validated_query': {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 06:02:22,086 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e586410> default_metadata=() model_kwargs={}
2025-07-14 06:02:22,120 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:02:22,121 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:02:22,121 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:02:24,394 - graph - INFO - Existing vq : {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 06:02:24,395 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}
2025-07-14 06:02:24,395 - graph - INFO - Merged final_query: Intent: find the total expense, Bank: ICICI, Account No: XXXXXXXX6193, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193 
2025-07-14 06:02:24,395 - graph - INFO - Start routing logic
2025-07-14 06:02:24,396 - graph - INFO - Validated Query Check: {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'} ‚Äî Missing: []
2025-07-14 06:02:24,396 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:02:24,397 - graph - INFO - Confirm node start...
2025-07-14 06:02:24,397 - graph - INFO - user's last message: content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193' additional_kwargs={} response_metadata={} id='369d6d83-9704-4c65-9c33-88dbd8f4452b'
2025-07-14 06:02:24,398 - graph - INFO - Start routing logic
2025-07-14 06:02:24,402 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='2a6b90f0-8117-49b2-8658-c74fcbf66c42'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='3270935b-7cc9-44a5-98c9-458c0f4b1342'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b8b97ad7-a587-4697-bb93-0fc18307e7ad'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='b3e0a933-9e19-43f2-a21a-401bd162143d'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='9de0c99c-347b-4410-8530-d776286dc9b1'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='37997269-eb86-4fea-a163-9a7a744c0167'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='c4dc774c-35bf-4905-a634-8aab9d9069d1'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='96b216b6-6604-45b0-9278-82ee370381d2'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='8b6ca39e-208d-4c28-8994-e205a9345334'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e8a22290-53fb-4ae1-baf2-9f9c1cfac1c1'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e1460d73-9e78-4fb4-ab9f-fb6a118a40c2'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='08d3e71f-22fd-4678-8d8f-7ef61d2de9ff'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='3c13de46-27b3-4456-b8ef-68b5c3d5c009'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='51a3b403-375f-4c78-91f7-4fa9ac275b43'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='6255d292-e4ee-438a-87b5-f6df7837fb47'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dfc3a854-4bfd-4c91-9a09-2d8f4cdce995'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='369d6d83-9704-4c65-9c33-88dbd8f4452b'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='cd6a2585-4d08-4dd8-99dd-972c04ad7407'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='031dca81-59c2-487f-b56a-c218bc7d6f92')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='find the total expense', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193')}
2025-07-14 06:03:05,150 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:03:05,152 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='find the total expense', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193')
2025-07-14 06:03:05,153 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}}
2025-07-14 06:03:05,158 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e581610> default_metadata=() model_kwargs={}
2025-07-14 06:03:05,194 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:03:05,194 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}
2025-07-14 06:03:05,195 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:03:07,302 - graph - INFO - Existing vq : {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}
2025-07-14 06:03:07,302 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:03:07,302 - graph - INFO - Merged final_query: Intent: find the total expense, Bank: ICICI, Account No: XXXXXXXX6193, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193 
2025-07-14 06:03:07,303 - graph - INFO - Start routing logic
2025-07-14 06:03:07,304 - graph - INFO - Validated Query Check: {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'} ‚Äî Missing: []
2025-07-14 06:03:07,304 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:03:07,305 - graph - INFO - Confirm node start...
2025-07-14 06:03:07,305 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'
2025-07-14 06:03:07,305 - graph - INFO - Start routing logic
2025-07-14 06:03:07,305 - graph - INFO - Validated Query Check: {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'} ‚Äî Missing: []
2025-07-14 06:03:07,305 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 06:03:07,306 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:03:07,309 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='70d9ad1e-8782-4a2d-8e7c-3734140cf5df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e33a41e0-7900-43d4-98a5-f607e9f70e47'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='99bc3278-afbb-4332-993c-c62e5fd924a8'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='33fd12f9-9579-4120-a29f-b43be1a3dc94'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='188fc958-72aa-45e8-a7a6-32b1a70aebab'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83085e07-8059-46b9-a2b0-eaef3f0f4a9d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='819d8589-3960-4bbe-9939-34ac039d18b3'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e519d07-20ee-490a-be59-a310f218e517'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='3585e45a-d0c1-41ab-bdfb-d22d47a99086'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='462998ce-ebf2-4924-a781-826d0b911aa3'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b630e5c8-36a1-4fab-8507-a5ea9929f382'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ef17f73c-4f2d-4471-b486-82df53b96fa0'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='602c1a18-1ad0-4656-9070-e658fe030f68'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c0da22ed-da3c-40ae-999c-1e6aaa68073b'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='b4d240d6-edc5-4fb2-93ee-0de9b5c22b18'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='20dcd4a7-b352-446f-b8e7-47970e5ca372'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='45776622-fb3f-4d96-bb87-13fe4e00feea'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f3a494a6-254c-4a9f-b01e-b28e1336608e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='8d0823e6-a92b-43d3-af1f-80847bacd588'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dbc688f7-09d5-400f-9baa-e27d52aa9616'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='f3e52556-a71e-424f-a920-28df5d04e040'),
 SystemMessage(content='User intends to ask: find the total expense for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:03:08,838 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='\n\nI will start by querying the database to see if the transaction data for ICICI account XXXXXXXX6193 for June 2025 is already available.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--a6fa6d2f-053c-4945-8206-d340c75a014e-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '588de3f0-ea93-48c6-8033-30ca1301e0c9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2069, 'output_tokens': 105, 'total_tokens': 2174, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:03:08,843 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:03:08,871 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:03:08,872 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='70d9ad1e-8782-4a2d-8e7c-3734140cf5df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e33a41e0-7900-43d4-98a5-f607e9f70e47'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='99bc3278-afbb-4332-993c-c62e5fd924a8'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='33fd12f9-9579-4120-a29f-b43be1a3dc94'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='188fc958-72aa-45e8-a7a6-32b1a70aebab'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83085e07-8059-46b9-a2b0-eaef3f0f4a9d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='819d8589-3960-4bbe-9939-34ac039d18b3'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e519d07-20ee-490a-be59-a310f218e517'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='3585e45a-d0c1-41ab-bdfb-d22d47a99086'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='462998ce-ebf2-4924-a781-826d0b911aa3'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b630e5c8-36a1-4fab-8507-a5ea9929f382'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ef17f73c-4f2d-4471-b486-82df53b96fa0'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='602c1a18-1ad0-4656-9070-e658fe030f68'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c0da22ed-da3c-40ae-999c-1e6aaa68073b'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='b4d240d6-edc5-4fb2-93ee-0de9b5c22b18'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='20dcd4a7-b352-446f-b8e7-47970e5ca372'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='45776622-fb3f-4d96-bb87-13fe4e00feea'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f3a494a6-254c-4a9f-b01e-b28e1336608e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='8d0823e6-a92b-43d3-af1f-80847bacd588'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dbc688f7-09d5-400f-9baa-e27d52aa9616'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='f3e52556-a71e-424f-a920-28df5d04e040'),
 AIMessage(content='\n\n\nI will start by querying the database to see if the transaction data for ICICI account XXXXXXXX6193 for June 2025 is already available.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--a6fa6d2f-053c-4945-8206-d340c75a014e-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '588de3f0-ea93-48c6-8033-30ca1301e0c9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2069, 'output_tokens': 105, 'total_tokens': 2174, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|           nan |', name='query_duckdb_tool', id='921ae9d0-5707-4ae4-ae9b-9be4719c4f40', tool_call_id='588de3f0-ea93-48c6-8033-30ca1301e0c9'),
 SystemMessage(content='User intends to ask: find the total expense for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:03:10,349 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="I checked the database, but it seems I don't have the transaction data for ICICI account XXXXXXXX6193 for June 2025. I will now fetch the bank statement from Gmail, decrypt it, and extract the transactions.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7d51e7ea-38a4-406b-b657-73d2ad30a3ea-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, 'id': '67b2c352-cefa-4841-b003-29c528127905', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2161, 'output_tokens': 97, 'total_tokens': 2258, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:03:10,352 - utils - INFO - Entering search_gmail_with_pdfs...
2025-07-14 06:03:10,358 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-07-14 06:03:10,362 - utils - INFO - Search Query : from:(estatement@icicibank.com) label:inbox subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193 
2025-07-14 06:03:11,109 - utils - INFO - ‚úÖ Found 1 message(s) for query
2025-07-14 06:03:11,568 - utils - INFO - Enetering print_email_summary()
2025-07-14 06:03:11,568 - utils - INFO - Subject: ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193
2025-07-14 06:03:11,568 - utils - INFO - From: Estatement <estatement@icicibank.com>
2025-07-14 06:03:11,569 - utils - INFO - No plain text body found
2025-07-14 06:03:11,569 - utils - INFO - Entering save_pdf_from_message() ...
2025-07-14 06:03:12,906 - utils - INFO - PDFs found : ['Downloaded: downloads/Statement_2025MTH06_007505631.pdf']
2025-07-14 06:03:12,907 - utils - INFO - Exitting save_pdf_from_message() ...
2025-07-14 06:03:12,908 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:03:12,912 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='70d9ad1e-8782-4a2d-8e7c-3734140cf5df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e33a41e0-7900-43d4-98a5-f607e9f70e47'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='99bc3278-afbb-4332-993c-c62e5fd924a8'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='33fd12f9-9579-4120-a29f-b43be1a3dc94'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='188fc958-72aa-45e8-a7a6-32b1a70aebab'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83085e07-8059-46b9-a2b0-eaef3f0f4a9d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='819d8589-3960-4bbe-9939-34ac039d18b3'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e519d07-20ee-490a-be59-a310f218e517'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='3585e45a-d0c1-41ab-bdfb-d22d47a99086'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='462998ce-ebf2-4924-a781-826d0b911aa3'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b630e5c8-36a1-4fab-8507-a5ea9929f382'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ef17f73c-4f2d-4471-b486-82df53b96fa0'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='602c1a18-1ad0-4656-9070-e658fe030f68'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c0da22ed-da3c-40ae-999c-1e6aaa68073b'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='b4d240d6-edc5-4fb2-93ee-0de9b5c22b18'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='20dcd4a7-b352-446f-b8e7-47970e5ca372'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='45776622-fb3f-4d96-bb87-13fe4e00feea'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f3a494a6-254c-4a9f-b01e-b28e1336608e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='8d0823e6-a92b-43d3-af1f-80847bacd588'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dbc688f7-09d5-400f-9baa-e27d52aa9616'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='f3e52556-a71e-424f-a920-28df5d04e040'),
 AIMessage(content='\n\n\nI will start by querying the database to see if the transaction data for ICICI account XXXXXXXX6193 for June 2025 is already available.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--a6fa6d2f-053c-4945-8206-d340c75a014e-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '588de3f0-ea93-48c6-8033-30ca1301e0c9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2069, 'output_tokens': 105, 'total_tokens': 2174, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|           nan |', name='query_duckdb_tool', id='921ae9d0-5707-4ae4-ae9b-9be4719c4f40', tool_call_id='588de3f0-ea93-48c6-8033-30ca1301e0c9'),
 AIMessage(content="\nI checked the database, but it seems I don't have the transaction data for ICICI account XXXXXXXX6193 for June 2025. I will now fetch the bank statement from Gmail, decrypt it, and extract the transactions.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7d51e7ea-38a4-406b-b657-73d2ad30a3ea-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, 'id': '67b2c352-cefa-4841-b003-29c528127905', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2161, 'output_tokens': 97, 'total_tokens': 2258, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_007505631.pdf', name='fetch_gmail_pdfs', id='b12b14f2-54c9-4122-bbad-0b019d0e15e4', tool_call_id='67b2c352-cefa-4841-b003-29c528127905'),
 SystemMessage(content='User intends to ask: find the total expense for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:03:13,926 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--d1998e7f-2eab-425d-a4df-9401268a9066-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631.pdf', 'bank': 'ICICI'}, 'id': '8a3604ca-76e1-4b34-81f5-6018cdd47690', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2238, 'output_tokens': 33, 'total_tokens': 2271, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:03:13,932 - utils - INFO - Entering decrypt_with_pikepdf() ...
2025-07-14 06:03:13,950 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:03:13,952 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='70d9ad1e-8782-4a2d-8e7c-3734140cf5df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e33a41e0-7900-43d4-98a5-f607e9f70e47'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='99bc3278-afbb-4332-993c-c62e5fd924a8'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='33fd12f9-9579-4120-a29f-b43be1a3dc94'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='188fc958-72aa-45e8-a7a6-32b1a70aebab'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83085e07-8059-46b9-a2b0-eaef3f0f4a9d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='819d8589-3960-4bbe-9939-34ac039d18b3'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e519d07-20ee-490a-be59-a310f218e517'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='3585e45a-d0c1-41ab-bdfb-d22d47a99086'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='462998ce-ebf2-4924-a781-826d0b911aa3'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b630e5c8-36a1-4fab-8507-a5ea9929f382'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ef17f73c-4f2d-4471-b486-82df53b96fa0'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='602c1a18-1ad0-4656-9070-e658fe030f68'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c0da22ed-da3c-40ae-999c-1e6aaa68073b'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='b4d240d6-edc5-4fb2-93ee-0de9b5c22b18'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='20dcd4a7-b352-446f-b8e7-47970e5ca372'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='45776622-fb3f-4d96-bb87-13fe4e00feea'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f3a494a6-254c-4a9f-b01e-b28e1336608e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='8d0823e6-a92b-43d3-af1f-80847bacd588'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dbc688f7-09d5-400f-9baa-e27d52aa9616'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='f3e52556-a71e-424f-a920-28df5d04e040'),
 AIMessage(content='\n\n\nI will start by querying the database to see if the transaction data for ICICI account XXXXXXXX6193 for June 2025 is already available.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--a6fa6d2f-053c-4945-8206-d340c75a014e-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '588de3f0-ea93-48c6-8033-30ca1301e0c9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2069, 'output_tokens': 105, 'total_tokens': 2174, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|           nan |', name='query_duckdb_tool', id='921ae9d0-5707-4ae4-ae9b-9be4719c4f40', tool_call_id='588de3f0-ea93-48c6-8033-30ca1301e0c9'),
 AIMessage(content="\nI checked the database, but it seems I don't have the transaction data for ICICI account XXXXXXXX6193 for June 2025. I will now fetch the bank statement from Gmail, decrypt it, and extract the transactions.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7d51e7ea-38a4-406b-b657-73d2ad30a3ea-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, 'id': '67b2c352-cefa-4841-b003-29c528127905', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2161, 'output_tokens': 97, 'total_tokens': 2258, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_007505631.pdf', name='fetch_gmail_pdfs', id='b12b14f2-54c9-4122-bbad-0b019d0e15e4', tool_call_id='67b2c352-cefa-4841-b003-29c528127905'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--d1998e7f-2eab-425d-a4df-9401268a9066-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631.pdf', 'bank': 'ICICI'}, 'id': '8a3604ca-76e1-4b34-81f5-6018cdd47690', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2238, 'output_tokens': 33, 'total_tokens': 2271, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_007505631_decrypted.pdf', name='decrypt_pdf_tool', id='5aded70b-8fc6-4e16-a9cd-3e4142263620', tool_call_id='8a3604ca-76e1-4b34-81f5-6018cdd47690'),
 SystemMessage(content='User intends to ask: find the total expense for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:03:15,098 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631_decrypted.pdf", "account_no": "XXXXXXXX6193", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7480cbe1-e7e3-408a-89df-c990e0045b79-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631_decrypted.pdf', 'account_no': 'XXXXXXXX6193', 'bank': 'ICICI'}, 'id': '007b8a48-03a1-4bfe-a759-41ec31013071', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2303, 'output_tokens': 47, 'total_tokens': 2350, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:03:15,100 - utils - INFO - Entering parse_icici__statement() ...
2025-07-14 06:03:15,102 - utils - INFO - 
üìÑ Processing page 1
2025-07-14 06:03:15,209 - utils - INFO - Extracted 77 lines from page 1
2025-07-14 06:03:15,209 - utils - INFO - 
üìÑ Processing page 2
2025-07-14 06:03:15,409 - utils - INFO - Extracted 211 lines from page 2
2025-07-14 06:03:15,410 - duckdb_tools - INFO - Entering store_transactions_to_duckdb() with 27 transactions and finance.db database 
2025-07-14 06:03:15,435 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:03:15,437 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='70d9ad1e-8782-4a2d-8e7c-3734140cf5df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e33a41e0-7900-43d4-98a5-f607e9f70e47'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='99bc3278-afbb-4332-993c-c62e5fd924a8'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='33fd12f9-9579-4120-a29f-b43be1a3dc94'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='188fc958-72aa-45e8-a7a6-32b1a70aebab'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83085e07-8059-46b9-a2b0-eaef3f0f4a9d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='819d8589-3960-4bbe-9939-34ac039d18b3'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e519d07-20ee-490a-be59-a310f218e517'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='3585e45a-d0c1-41ab-bdfb-d22d47a99086'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='462998ce-ebf2-4924-a781-826d0b911aa3'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b630e5c8-36a1-4fab-8507-a5ea9929f382'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ef17f73c-4f2d-4471-b486-82df53b96fa0'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='602c1a18-1ad0-4656-9070-e658fe030f68'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c0da22ed-da3c-40ae-999c-1e6aaa68073b'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='b4d240d6-edc5-4fb2-93ee-0de9b5c22b18'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='20dcd4a7-b352-446f-b8e7-47970e5ca372'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='45776622-fb3f-4d96-bb87-13fe4e00feea'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f3a494a6-254c-4a9f-b01e-b28e1336608e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='8d0823e6-a92b-43d3-af1f-80847bacd588'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dbc688f7-09d5-400f-9baa-e27d52aa9616'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='f3e52556-a71e-424f-a920-28df5d04e040'),
 AIMessage(content='\n\n\nI will start by querying the database to see if the transaction data for ICICI account XXXXXXXX6193 for June 2025 is already available.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--a6fa6d2f-053c-4945-8206-d340c75a014e-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '588de3f0-ea93-48c6-8033-30ca1301e0c9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2069, 'output_tokens': 105, 'total_tokens': 2174, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|           nan |', name='query_duckdb_tool', id='921ae9d0-5707-4ae4-ae9b-9be4719c4f40', tool_call_id='588de3f0-ea93-48c6-8033-30ca1301e0c9'),
 AIMessage(content="\nI checked the database, but it seems I don't have the transaction data for ICICI account XXXXXXXX6193 for June 2025. I will now fetch the bank statement from Gmail, decrypt it, and extract the transactions.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7d51e7ea-38a4-406b-b657-73d2ad30a3ea-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, 'id': '67b2c352-cefa-4841-b003-29c528127905', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2161, 'output_tokens': 97, 'total_tokens': 2258, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_007505631.pdf', name='fetch_gmail_pdfs', id='b12b14f2-54c9-4122-bbad-0b019d0e15e4', tool_call_id='67b2c352-cefa-4841-b003-29c528127905'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--d1998e7f-2eab-425d-a4df-9401268a9066-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631.pdf', 'bank': 'ICICI'}, 'id': '8a3604ca-76e1-4b34-81f5-6018cdd47690', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2238, 'output_tokens': 33, 'total_tokens': 2271, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_007505631_decrypted.pdf', name='decrypt_pdf_tool', id='5aded70b-8fc6-4e16-a9cd-3e4142263620', tool_call_id='8a3604ca-76e1-4b34-81f5-6018cdd47690'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631_decrypted.pdf", "account_no": "XXXXXXXX6193", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7480cbe1-e7e3-408a-89df-c990e0045b79-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631_decrypted.pdf', 'account_no': 'XXXXXXXX6193', 'bank': 'ICICI'}, 'id': '007b8a48-03a1-4bfe-a759-41ec31013071', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2303, 'output_tokens': 47, 'total_tokens': 2350, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Inserted 26 new transactions out of 27 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='17bbffdd-c840-40b3-bb87-220f230270c1', tool_call_id='007b8a48-03a1-4bfe-a759-41ec31013071'),
 SystemMessage(content='User intends to ask: find the total expense for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:03:16,558 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--38884b49-0aa6-4e47-a1c8-1606f25eb708-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '04f96ae3-0144-4501-8e48-2fdd2fec4db2', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2381, 'output_tokens': 69, 'total_tokens': 2450, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:03:16,561 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:03:16,575 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:03:16,576 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='70d9ad1e-8782-4a2d-8e7c-3734140cf5df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e33a41e0-7900-43d4-98a5-f607e9f70e47'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='99bc3278-afbb-4332-993c-c62e5fd924a8'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='33fd12f9-9579-4120-a29f-b43be1a3dc94'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='188fc958-72aa-45e8-a7a6-32b1a70aebab'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83085e07-8059-46b9-a2b0-eaef3f0f4a9d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='819d8589-3960-4bbe-9939-34ac039d18b3'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e519d07-20ee-490a-be59-a310f218e517'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='3585e45a-d0c1-41ab-bdfb-d22d47a99086'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='462998ce-ebf2-4924-a781-826d0b911aa3'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b630e5c8-36a1-4fab-8507-a5ea9929f382'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ef17f73c-4f2d-4471-b486-82df53b96fa0'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='602c1a18-1ad0-4656-9070-e658fe030f68'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c0da22ed-da3c-40ae-999c-1e6aaa68073b'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='b4d240d6-edc5-4fb2-93ee-0de9b5c22b18'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='20dcd4a7-b352-446f-b8e7-47970e5ca372'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='45776622-fb3f-4d96-bb87-13fe4e00feea'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f3a494a6-254c-4a9f-b01e-b28e1336608e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='8d0823e6-a92b-43d3-af1f-80847bacd588'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dbc688f7-09d5-400f-9baa-e27d52aa9616'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='f3e52556-a71e-424f-a920-28df5d04e040'),
 AIMessage(content='\n\n\nI will start by querying the database to see if the transaction data for ICICI account XXXXXXXX6193 for June 2025 is already available.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--a6fa6d2f-053c-4945-8206-d340c75a014e-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '588de3f0-ea93-48c6-8033-30ca1301e0c9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2069, 'output_tokens': 105, 'total_tokens': 2174, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|           nan |', name='query_duckdb_tool', id='921ae9d0-5707-4ae4-ae9b-9be4719c4f40', tool_call_id='588de3f0-ea93-48c6-8033-30ca1301e0c9'),
 AIMessage(content="\nI checked the database, but it seems I don't have the transaction data for ICICI account XXXXXXXX6193 for June 2025. I will now fetch the bank statement from Gmail, decrypt it, and extract the transactions.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7d51e7ea-38a4-406b-b657-73d2ad30a3ea-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, 'id': '67b2c352-cefa-4841-b003-29c528127905', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2161, 'output_tokens': 97, 'total_tokens': 2258, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_007505631.pdf', name='fetch_gmail_pdfs', id='b12b14f2-54c9-4122-bbad-0b019d0e15e4', tool_call_id='67b2c352-cefa-4841-b003-29c528127905'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--d1998e7f-2eab-425d-a4df-9401268a9066-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631.pdf', 'bank': 'ICICI'}, 'id': '8a3604ca-76e1-4b34-81f5-6018cdd47690', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2238, 'output_tokens': 33, 'total_tokens': 2271, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='downloads/Statement_2025MTH06_007505631_decrypted.pdf', name='decrypt_pdf_tool', id='5aded70b-8fc6-4e16-a9cd-3e4142263620', tool_call_id='8a3604ca-76e1-4b34-81f5-6018cdd47690'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631_decrypted.pdf", "account_no": "XXXXXXXX6193", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7480cbe1-e7e3-408a-89df-c990e0045b79-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631_decrypted.pdf', 'account_no': 'XXXXXXXX6193', 'bank': 'ICICI'}, 'id': '007b8a48-03a1-4bfe-a759-41ec31013071', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2303, 'output_tokens': 47, 'total_tokens': 2350, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='Inserted 26 new transactions out of 27 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='17bbffdd-c840-40b3-bb87-220f230270c1', tool_call_id='007b8a48-03a1-4bfe-a759-41ec31013071'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--38884b49-0aa6-4e47-a1c8-1606f25eb708-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '04f96ae3-0144-4501-8e48-2fdd2fec4db2', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2381, 'output_tokens': 69, 'total_tokens': 2450, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|       39270.3 |', name='query_duckdb_tool', id='d99af43a-899a-40d9-a44d-6c88e28931ad', tool_call_id='04f96ae3-0144-4501-8e48-2fdd2fec4db2'),
 SystemMessage(content='User intends to ask: find the total expense for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:03:17,460 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='The total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--5b60770d-17e2-4311-89af-f2ef69cf951f-0', usage_metadata={'input_tokens': 2479, 'output_tokens': 31, 'total_tokens': 2510, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:03:17,468 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='70d9ad1e-8782-4a2d-8e7c-3734140cf5df'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e33a41e0-7900-43d4-98a5-f607e9f70e47'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='99bc3278-afbb-4332-993c-c62e5fd924a8'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='33fd12f9-9579-4120-a29f-b43be1a3dc94'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='188fc958-72aa-45e8-a7a6-32b1a70aebab'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83085e07-8059-46b9-a2b0-eaef3f0f4a9d'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='819d8589-3960-4bbe-9939-34ac039d18b3'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e519d07-20ee-490a-be59-a310f218e517'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='3585e45a-d0c1-41ab-bdfb-d22d47a99086'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='462998ce-ebf2-4924-a781-826d0b911aa3'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b630e5c8-36a1-4fab-8507-a5ea9929f382'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ef17f73c-4f2d-4471-b486-82df53b96fa0'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='602c1a18-1ad0-4656-9070-e658fe030f68'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c0da22ed-da3c-40ae-999c-1e6aaa68073b'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='b4d240d6-edc5-4fb2-93ee-0de9b5c22b18'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='20dcd4a7-b352-446f-b8e7-47970e5ca372'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='45776622-fb3f-4d96-bb87-13fe4e00feea'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f3a494a6-254c-4a9f-b01e-b28e1336608e'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='eeb8e0c5-3b8a-49ea-86a9-fa68f0e38105'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='8d0823e6-a92b-43d3-af1f-80847bacd588'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dbc688f7-09d5-400f-9baa-e27d52aa9616'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='f3e52556-a71e-424f-a920-28df5d04e040'),
              AIMessage(content='\n\n\nI will start by querying the database to see if the transaction data for ICICI account XXXXXXXX6193 for June 2025 is already available.', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--a6fa6d2f-053c-4945-8206-d340c75a014e-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '588de3f0-ea93-48c6-8033-30ca1301e0c9', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2069, 'output_tokens': 105, 'total_tokens': 2174, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='|   sum(amount) |\n|--------------:|\n|           nan |', name='query_duckdb_tool', id='921ae9d0-5707-4ae4-ae9b-9be4719c4f40', tool_call_id='588de3f0-ea93-48c6-8033-30ca1301e0c9'),
              AIMessage(content="\nI checked the database, but it seems I don't have the transaction data for ICICI account XXXXXXXX6193 for June 2025. I will now fetch the bank statement from Gmail, decrypt it, and extract the transactions.", additional_kwargs={'function_call': {'name': 'fetch_gmail_pdfs', 'arguments': '{"query": "subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7d51e7ea-38a4-406b-b657-73d2ad30a3ea-0', tool_calls=[{'name': 'fetch_gmail_pdfs', 'args': {'query': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, 'id': '67b2c352-cefa-4841-b003-29c528127905', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2161, 'output_tokens': 97, 'total_tokens': 2258, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='Downloaded: downloads/Statement_2025MTH06_007505631.pdf', name='fetch_gmail_pdfs', id='b12b14f2-54c9-4122-bbad-0b019d0e15e4', tool_call_id='67b2c352-cefa-4841-b003-29c528127905'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'decrypt_pdf_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631.pdf", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--d1998e7f-2eab-425d-a4df-9401268a9066-0', tool_calls=[{'name': 'decrypt_pdf_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631.pdf', 'bank': 'ICICI'}, 'id': '8a3604ca-76e1-4b34-81f5-6018cdd47690', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2238, 'output_tokens': 33, 'total_tokens': 2271, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='downloads/Statement_2025MTH06_007505631_decrypted.pdf', name='decrypt_pdf_tool', id='5aded70b-8fc6-4e16-a9cd-3e4142263620', tool_call_id='8a3604ca-76e1-4b34-81f5-6018cdd47690'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'extract_and_store_transactions_tool', 'arguments': '{"path": "downloads/Statement_2025MTH06_007505631_decrypted.pdf", "account_no": "XXXXXXXX6193", "bank": "ICICI"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--7480cbe1-e7e3-408a-89df-c990e0045b79-0', tool_calls=[{'name': 'extract_and_store_transactions_tool', 'args': {'path': 'downloads/Statement_2025MTH06_007505631_decrypted.pdf', 'account_no': 'XXXXXXXX6193', 'bank': 'ICICI'}, 'id': '007b8a48-03a1-4bfe-a759-41ec31013071', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2303, 'output_tokens': 47, 'total_tokens': 2350, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='Inserted 26 new transactions out of 27 into DuckDB database. Check the database now.', name='extract_and_store_transactions_tool', id='17bbffdd-c840-40b3-bb87-220f230270c1', tool_call_id='007b8a48-03a1-4bfe-a759-41ec31013071'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--38884b49-0aa6-4e47-a1c8-1606f25eb708-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': '04f96ae3-0144-4501-8e48-2fdd2fec4db2', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2381, 'output_tokens': 69, 'total_tokens': 2450, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='|   sum(amount) |\n|--------------:|\n|       39270.3 |', name='query_duckdb_tool', id='d99af43a-899a-40d9-a44d-6c88e28931ad', tool_call_id='04f96ae3-0144-4501-8e48-2fdd2fec4db2'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--5b60770d-17e2-4311-89af-f2ef69cf951f-0', usage_metadata={'input_tokens': 2479, 'output_tokens': 31, 'total_tokens': 2510, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='find the total expense', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193')}
2025-07-14 06:03:56,663 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:03:56,664 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='find the total expense', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193')
2025-07-14 06:03:56,664 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}], 'validated_query': {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}}
2025-07-14 06:03:56,668 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e5837d0> default_metadata=() model_kwargs={}
2025-07-14 06:03:56,702 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:03:56,702 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}
2025-07-14 06:03:56,703 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:03:58,861 - graph - INFO - Existing vq : {'intent': 'find the total expense', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}
2025-07-14 06:03:58,862 - graph - INFO - vq after - new parsed message from user: {'intent': 'get spending details', 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:03:58,862 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX6193, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: total amount spent on UPI 
2025-07-14 06:03:58,862 - graph - INFO - Start routing logic
2025-07-14 06:03:58,862 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:03:58,862 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:03:58,863 - graph - INFO - Confirm node start...
2025-07-14 06:03:58,864 - graph - INFO - user's last message: content='what is the total amount spent on UPI ?' additional_kwargs={} response_metadata={} id='dac52d52-4195-4710-88dd-e3f531c246f8'
2025-07-14 06:03:58,864 - graph - INFO - Start routing logic
2025-07-14 06:03:58,869 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='1e48fa4c-9b8f-4849-8c43-c733346b2d2b'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bd34f1e1-c5ea-462e-8e74-69514106636d'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='2fd8a899-92df-41e4-bb1a-0f0c9b890fa1'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='0325b6e6-7e87-4747-94a6-369fcfb2db29'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='87a7804c-0443-489e-92ad-7855bba869ef'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='79b59f9d-d8f2-4c5c-82d1-ede5140c0264'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d0392872-8bf3-4346-ba4e-028594f3f0e7'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='b0cc6bdd-f38a-4312-9c61-648dce5561da'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='ca74a4d0-f152-48a2-8dba-e05739a01d74'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4da0cd5d-1691-490a-94fc-b4c5d137f998'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='399898e2-9a84-49e6-a9d1-4e7b7ac849cf'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='ceaa8b78-5c0d-46e2-a9e7-9dc8f8a7791d'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='e2f36f9e-ce11-4a9c-94b5-e6d17931adcd'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='660814dd-6a77-4eed-8a35-ce9231db864b'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='e42e6f6f-da61-4ee1-834e-ab8f0a058120'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bb8cb107-3a1a-4489-ad77-ca823b5d0a27'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='79ada431-2cd0-460b-99eb-5959730f64b9'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='8073801a-60ec-456b-8816-e12af4d1a63b'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='3921fb46-e9dd-4344-879e-39ca10e6fe0b'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='3b6506dc-7d9e-4f8f-b664-16deb30332db'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='dac52d52-4195-4710-88dd-e3f531c246f8'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='5314baf8-eb54-4fa0-8b44-6a87f9bf5e8e'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='15447867-1772-47ff-bd50-5564bf6a2bf4')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='total amount spent on UPI')}
2025-07-14 06:04:09,020 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:04:09,020 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='total amount spent on UPI')
2025-07-14 06:04:09,020 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}}
2025-07-14 06:04:09,023 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12bd44cb0> default_metadata=() model_kwargs={}
2025-07-14 06:04:09,060 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:04:09,060 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:04:09,061 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:04:11,114 - graph - INFO - Existing vq : {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:04:11,115 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:04:11,115 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX6193, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: total amount spent on UPI 
2025-07-14 06:04:11,116 - graph - INFO - Start routing logic
2025-07-14 06:04:11,116 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:04:11,116 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:04:11,117 - graph - INFO - Confirm node start...
2025-07-14 06:04:11,117 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='61241287-cb0e-46a2-ab04-678ea9bdac23'
2025-07-14 06:04:11,118 - graph - INFO - Start routing logic
2025-07-14 06:04:11,118 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:04:11,118 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 06:04:11,119 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:04:11,121 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='8c48f314-79c8-4600-a716-f80add14b7ca'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9e3e87af-bd67-4a0f-80ce-e61dee60dc70'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='a288e728-c544-4bac-bda9-11c91dc9627b'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='47718625-4d13-43c6-b4f2-88d45b69eacc'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='3856daf4-fbee-404a-a8e6-4952b56912dc'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='70ffecfd-0b88-49cc-9622-98d33ae72b6b'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='6ca36e0d-62ab-494a-9b80-8406f45c1186'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='6753e0cf-4946-47c8-8ae8-7f03c83838af'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='a9dc1914-76c1-4d8e-af87-1931e464929e'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b172b4e1-36e2-44bb-b199-4077cd68d8ae'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='949d513e-caf6-4c2c-8845-11fd8d940634'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='de0c7e91-17fb-41cf-a392-db8e5a453545'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='9934c337-5739-42c2-ab3b-6d6ffc75786d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f2dc7f58-26d6-4f8a-a891-88280da773fa'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='f0468a47-9f18-4b20-a782-d1ffe82bcd56'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f33307ee-a57d-4c2a-963e-c3d28f5d1a3a'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='fc87eb29-e0d8-4b39-b68b-171f804521d1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c2b8ba02-ec6d-428a-9b7d-e00893a9b06f'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='9a11953d-0057-44c0-b6a2-5bf88a841fe4'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='7bd69c4f-0796-4d66-bb1d-58ff0a000744'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='32ad599d-0e8e-425f-a5a4-b6bc0e97704f'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ab1cdbf3-18db-4ef3-8ef0-6c738e85f081'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='61241287-cb0e-46a2-ab04-678ea9bdac23'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='0969b1c1-9492-49a9-91dd-e590f96a9eda'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='5e936699-a4fc-4ec2-91bb-ca75ce40adbe'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c4529f73-feb7-4168-973d-09ac4ef61221'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:04:12,296 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT sum(amount) FROM TRANSACTIONS WHERE account_no = \'XXXXXXXX6193\' AND bank = \'ICICI\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND mode = \'UPI\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--aa2bb00a-92e2-4fde-86f2-3a099be86159-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT sum(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX6193' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND mode = 'UPI' AND type = 'DEBIT'"}, 'id': 'dc2c36c9-ad6c-4560-acb0-4ad7ff5d09dd', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2166, 'output_tokens': 76, 'total_tokens': 2242, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:04:12,298 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:04:12,321 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:04:12,323 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='8c48f314-79c8-4600-a716-f80add14b7ca'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9e3e87af-bd67-4a0f-80ce-e61dee60dc70'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='a288e728-c544-4bac-bda9-11c91dc9627b'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='47718625-4d13-43c6-b4f2-88d45b69eacc'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='3856daf4-fbee-404a-a8e6-4952b56912dc'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='70ffecfd-0b88-49cc-9622-98d33ae72b6b'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='6ca36e0d-62ab-494a-9b80-8406f45c1186'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='6753e0cf-4946-47c8-8ae8-7f03c83838af'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='a9dc1914-76c1-4d8e-af87-1931e464929e'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b172b4e1-36e2-44bb-b199-4077cd68d8ae'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='949d513e-caf6-4c2c-8845-11fd8d940634'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='de0c7e91-17fb-41cf-a392-db8e5a453545'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='9934c337-5739-42c2-ab3b-6d6ffc75786d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f2dc7f58-26d6-4f8a-a891-88280da773fa'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='f0468a47-9f18-4b20-a782-d1ffe82bcd56'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f33307ee-a57d-4c2a-963e-c3d28f5d1a3a'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='fc87eb29-e0d8-4b39-b68b-171f804521d1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c2b8ba02-ec6d-428a-9b7d-e00893a9b06f'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='9a11953d-0057-44c0-b6a2-5bf88a841fe4'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='7bd69c4f-0796-4d66-bb1d-58ff0a000744'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='32ad599d-0e8e-425f-a5a4-b6bc0e97704f'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ab1cdbf3-18db-4ef3-8ef0-6c738e85f081'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='61241287-cb0e-46a2-ab04-678ea9bdac23'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='0969b1c1-9492-49a9-91dd-e590f96a9eda'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='5e936699-a4fc-4ec2-91bb-ca75ce40adbe'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c4529f73-feb7-4168-973d-09ac4ef61221'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT sum(amount) FROM TRANSACTIONS WHERE account_no = \'XXXXXXXX6193\' AND bank = \'ICICI\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND mode = \'UPI\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--aa2bb00a-92e2-4fde-86f2-3a099be86159-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT sum(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX6193' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND mode = 'UPI' AND type = 'DEBIT'"}, 'id': 'dc2c36c9-ad6c-4560-acb0-4ad7ff5d09dd', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2166, 'output_tokens': 76, 'total_tokens': 2242, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|       12053.5 |', name='query_duckdb_tool', id='e356ced7-08aa-4c2d-a796-8160d67cea7f', tool_call_id='dc2c36c9-ad6c-4560-acb0-4ad7ff5d09dd'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX6193 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:04:13,348 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='The total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--c90fc87e-db1b-4c35-8a94-1f89949a85dd-0', usage_metadata={'input_tokens': 2270, 'output_tokens': 34, 'total_tokens': 2304, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:04:13,354 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='8c48f314-79c8-4600-a716-f80add14b7ca'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9e3e87af-bd67-4a0f-80ce-e61dee60dc70'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='a288e728-c544-4bac-bda9-11c91dc9627b'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='47718625-4d13-43c6-b4f2-88d45b69eacc'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='3856daf4-fbee-404a-a8e6-4952b56912dc'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='70ffecfd-0b88-49cc-9622-98d33ae72b6b'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='6ca36e0d-62ab-494a-9b80-8406f45c1186'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='6753e0cf-4946-47c8-8ae8-7f03c83838af'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='a9dc1914-76c1-4d8e-af87-1931e464929e'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b172b4e1-36e2-44bb-b199-4077cd68d8ae'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='949d513e-caf6-4c2c-8845-11fd8d940634'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='de0c7e91-17fb-41cf-a392-db8e5a453545'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='9934c337-5739-42c2-ab3b-6d6ffc75786d'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f2dc7f58-26d6-4f8a-a891-88280da773fa'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='f0468a47-9f18-4b20-a782-d1ffe82bcd56'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f33307ee-a57d-4c2a-963e-c3d28f5d1a3a'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='fc87eb29-e0d8-4b39-b68b-171f804521d1'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c2b8ba02-ec6d-428a-9b7d-e00893a9b06f'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='9a11953d-0057-44c0-b6a2-5bf88a841fe4'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='7bd69c4f-0796-4d66-bb1d-58ff0a000744'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='32ad599d-0e8e-425f-a5a4-b6bc0e97704f'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ab1cdbf3-18db-4ef3-8ef0-6c738e85f081'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='61241287-cb0e-46a2-ab04-678ea9bdac23'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='0969b1c1-9492-49a9-91dd-e590f96a9eda'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='5e936699-a4fc-4ec2-91bb-ca75ce40adbe'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='c4529f73-feb7-4168-973d-09ac4ef61221'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT sum(amount) FROM TRANSACTIONS WHERE account_no = \'XXXXXXXX6193\' AND bank = \'ICICI\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND mode = \'UPI\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--aa2bb00a-92e2-4fde-86f2-3a099be86159-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT sum(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX6193' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND mode = 'UPI' AND type = 'DEBIT'"}, 'id': 'dc2c36c9-ad6c-4560-acb0-4ad7ff5d09dd', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2166, 'output_tokens': 76, 'total_tokens': 2242, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='|   sum(amount) |\n|--------------:|\n|       12053.5 |', name='query_duckdb_tool', id='e356ced7-08aa-4c2d-a796-8160d67cea7f', tool_call_id='dc2c36c9-ad6c-4560-acb0-4ad7ff5d09dd'),
              AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--c90fc87e-db1b-4c35-8a94-1f89949a85dd-0', usage_metadata={'input_tokens': 2270, 'output_tokens': 34, 'total_tokens': 2304, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='total amount spent on UPI')}
2025-07-14 06:05:07,518 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:05:07,519 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'), Message(role='user', content='explain this month transaction based on different modes?')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX6193', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='total amount spent on UPI')
2025-07-14 06:05:07,519 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'}, {'role': 'user', 'content': 'explain this month transaction based on different modes?'}], 'validated_query': {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}}
2025-07-14 06:05:07,523 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12bd44f70> default_metadata=() model_kwargs={}
2025-07-14 06:05:07,558 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:05:07,559 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:05:07,559 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:05:09,875 - graph - INFO - Existing vq : {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:05:09,875 - graph - INFO - vq after - new parsed message from user: {'intent': 'explain transactions', 'bank': None, 'account_no': None, 'month': 'this month', 'year': None, 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': None}
2025-07-14 06:05:09,876 - graph - INFO - Merged final_query: Intent: explain transactions, Bank: ICICI, Account No: XXXXXXXX6193, Month: this month, Year: 2025, Date Range: 01-06-2024 to 30-06-2024 Query Hint: total amount spent on UPI 
2025-07-14 06:05:09,876 - graph - INFO - Start routing logic
2025-07-14 06:05:09,877 - graph - INFO - Validated Query Check: {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:05:09,877 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:05:09,877 - graph - INFO - Confirm node start...
2025-07-14 06:05:09,878 - graph - INFO - user's last message: content='explain this month transaction based on different modes?' additional_kwargs={} response_metadata={} id='f6648f63-dda8-4b50-94fd-73177ac118a2'
2025-07-14 06:05:09,878 - graph - INFO - Start routing logic
2025-07-14 06:05:09,883 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='a608f51f-1479-498a-a52f-21a665aa7f9c'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='2e40e0b6-fc89-4c73-85b1-5c1251d8b98d'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='386fa3cb-d85d-44ce-8a81-5e3f1000c7a1'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='89031ad2-6b75-4fbd-b676-2b4369de8483'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='ebf22d2e-8f97-4aad-b3a4-c63f5e4dddff'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='5547ab96-1fbb-49d6-bfe6-20b22f0cc3ca'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='c6fd6fce-2ba6-4a77-a3d7-0903247ca61f'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='7e0da43d-b694-49cb-976f-657294c77894'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='01b9698d-0739-4fd5-b272-44c4bd42796f'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='722a7d42-90a3-4593-b538-079037d6e4ae'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='1ce6f3e6-5877-4390-b36e-cb68d01ac9c7'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='fdcdd0d2-2d56-4cad-bea6-49cfd8fb343e'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='6e83d717-1475-4f5b-8c2b-03dfb0b5fa4e'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bd0295b4-a7bf-48f0-bcce-ee5aa08e4e8a'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='575b256e-14b4-41a1-9964-d9338da3a0e3'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='6f87602d-9fd6-4fca-ac6a-4bde83fa19da'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='73412c07-8504-4707-9e49-828e93599402'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='dab2085d-0875-43e9-b65a-9f0a8f8f52c5'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7a7d8007-c3f0-452a-abcc-ff466b9b77e3'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='62292e21-d764-430d-8fca-fdefa6e96177'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='b67b8c7a-c051-416d-a7f3-1094551a4bd4'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9935184b-42fe-415d-a600-2d1d2655c871'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='85b269ef-ebc9-4220-adc8-2fb64c6f5d53'),
              AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='0562230a-8b6d-45e5-983e-dd59e22b9fb0'),
              HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='f6648f63-dda8-4b50-94fd-73177ac118a2'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='cd6d0f33-ce0e-4c53-af48-dc0924b0c7db'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d3b0abd8-e2cc-4645-b489-c334691ca4bb')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='explain transactions', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')}
2025-07-14 06:05:18,827 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:05:18,828 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'), Message(role='user', content='explain this month transaction based on different modes?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='explain transactions', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')
2025-07-14 06:05:18,828 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'}, {'role': 'user', 'content': 'explain this month transaction based on different modes?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}}
2025-07-14 06:05:18,831 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e5bb2f0> default_metadata=() model_kwargs={}
2025-07-14 06:05:18,865 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:05:18,865 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:05:18,866 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:05:20,932 - graph - INFO - Existing vq : {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:05:20,932 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:05:20,932 - graph - INFO - Merged final_query: Intent: explain transactions, Bank: ICICI, Account No: XXXXXXXX6193, Month: this month, Year: 2025, Date Range: 01-06-2024 to 30-06-2024 Query Hint: total amount spent on UPI 
2025-07-14 06:05:20,932 - graph - INFO - Start routing logic
2025-07-14 06:05:20,932 - graph - INFO - Validated Query Check: {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:05:20,933 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:05:20,933 - graph - INFO - Confirm node start...
2025-07-14 06:05:20,933 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='c78eb3f5-117a-473b-8c16-afd80ba6ee50'
2025-07-14 06:05:20,934 - graph - INFO - Start routing logic
2025-07-14 06:05:20,934 - graph - INFO - Validated Query Check: {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:05:20,934 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 06:05:20,935 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:05:20,938 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='b659d6e4-f324-4a7a-8dad-3f11f653693d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='943af164-f1ca-45bf-9d67-91cd15c81c10'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5acaee17-8445-41d7-9a7c-dc0bb5314680'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='8f9d37ee-471a-47be-a0fb-206f3bb3945f'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='9e0903f9-2f8c-493b-9099-514c36793cde'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='fa2823b0-4793-419f-bdfa-68b69ce0af8c'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d866ed13-8a5d-415b-b87b-8db3d124bbcc'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='db9a6854-459f-4093-bcb0-7b67a47bc122'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='c32242ce-163a-48fc-8399-647ebaa7d6b8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0b175382-d4ba-4235-a22f-91dc80fe788a'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7d1820a4-a973-4025-82e4-3c6b7cb9d42b'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='aef4e3e6-306e-4700-b8fc-97d37d415e3c'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='134d47af-68f9-4624-87fc-3c546ea4b3b2'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e12df796-ee1e-40e5-a97f-b3c5f37fb535'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='9db4c1ea-798e-4678-adb2-45f3e31f103f'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f2c269c0-f06b-412b-9f47-53abb50e9ba2'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='01fdd1f3-d095-4957-ae52-3c50e087bfc8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='826d70b1-4d1a-45fa-a007-978acf58ee9f'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='f49fdd35-80c7-4a76-aa71-0b825d3516b1'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='7aabb78b-ec7d-48b5-9cab-8521c64bec24'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='cdd38174-37f3-4a1f-acb4-344cae150a95'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='fc487573-ab39-44eb-beb2-25820bec0386'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e62e5812-432f-484d-9534-67ab402866e9'),
 AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='524f29b5-45ff-4884-86a5-7523457c4a72'),
 HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='42b810dc-52dd-4f43-bc08-633a19ea0b9e'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d5ac38f8-062c-46f1-b226-e1f88636a1d1'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='c78eb3f5-117a-473b-8c16-afd80ba6ee50'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='e67562e2-24fe-4e6d-91d8-4ffbeb26ebf4'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='da712543-8669-424f-83c9-8697decc99db'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='a4713433-14b2-44de-b2c7-712099a71f75'),
 SystemMessage(content='User intends to ask: explain transactions for ICICI account XXXXXXXX6193 in this month 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:05:22,220 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT mode, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' GROUP BY mode"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6346a4ec-2721-4153-a1e4-c8a983454102-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT mode, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' GROUP BY mode"}, 'id': 'da703d50-daf0-421e-a1e1-9c0a45302541', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2300, 'output_tokens': 72, 'total_tokens': 2372, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:05:22,224 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:05:22,251 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:05:22,253 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='b659d6e4-f324-4a7a-8dad-3f11f653693d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='943af164-f1ca-45bf-9d67-91cd15c81c10'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5acaee17-8445-41d7-9a7c-dc0bb5314680'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='8f9d37ee-471a-47be-a0fb-206f3bb3945f'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='9e0903f9-2f8c-493b-9099-514c36793cde'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='fa2823b0-4793-419f-bdfa-68b69ce0af8c'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d866ed13-8a5d-415b-b87b-8db3d124bbcc'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='db9a6854-459f-4093-bcb0-7b67a47bc122'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='c32242ce-163a-48fc-8399-647ebaa7d6b8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0b175382-d4ba-4235-a22f-91dc80fe788a'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7d1820a4-a973-4025-82e4-3c6b7cb9d42b'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='aef4e3e6-306e-4700-b8fc-97d37d415e3c'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='134d47af-68f9-4624-87fc-3c546ea4b3b2'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e12df796-ee1e-40e5-a97f-b3c5f37fb535'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='9db4c1ea-798e-4678-adb2-45f3e31f103f'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f2c269c0-f06b-412b-9f47-53abb50e9ba2'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='01fdd1f3-d095-4957-ae52-3c50e087bfc8'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='826d70b1-4d1a-45fa-a007-978acf58ee9f'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='f49fdd35-80c7-4a76-aa71-0b825d3516b1'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='7aabb78b-ec7d-48b5-9cab-8521c64bec24'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='cdd38174-37f3-4a1f-acb4-344cae150a95'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='fc487573-ab39-44eb-beb2-25820bec0386'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e62e5812-432f-484d-9534-67ab402866e9'),
 AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='524f29b5-45ff-4884-86a5-7523457c4a72'),
 HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='42b810dc-52dd-4f43-bc08-633a19ea0b9e'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d5ac38f8-062c-46f1-b226-e1f88636a1d1'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='c78eb3f5-117a-473b-8c16-afd80ba6ee50'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='e67562e2-24fe-4e6d-91d8-4ffbeb26ebf4'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='da712543-8669-424f-83c9-8697decc99db'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='a4713433-14b2-44de-b2c7-712099a71f75'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT mode, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' GROUP BY mode"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6346a4ec-2721-4153-a1e4-c8a983454102-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT mode, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' GROUP BY mode"}, 'id': 'da703d50-daf0-421e-a1e1-9c0a45302541', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2300, 'output_tokens': 72, 'total_tokens': 2372, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='| mode        |   total_amount |\n|:------------|---------------:|\n| NET BANKING |        27216.8 |\n| 8f          |          360   |\n| UPI         |        69559.6 |', name='query_duckdb_tool', id='b8f0c679-d275-487f-bd97-9162a782cb9b', tool_call_id='da703d50-daf0-421e-a1e1-9c0a45302541'),
 SystemMessage(content='User intends to ask: explain transactions for ICICI account XXXXXXXX6193 in this month 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:05:23,595 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="OK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8e2ff144-e72e-48ef-9770-c69275bee706-0', usage_metadata={'input_tokens': 2435, 'output_tokens': 104, 'total_tokens': 2539, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:05:23,601 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='b659d6e4-f324-4a7a-8dad-3f11f653693d'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='943af164-f1ca-45bf-9d67-91cd15c81c10'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5acaee17-8445-41d7-9a7c-dc0bb5314680'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='8f9d37ee-471a-47be-a0fb-206f3bb3945f'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='9e0903f9-2f8c-493b-9099-514c36793cde'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='fa2823b0-4793-419f-bdfa-68b69ce0af8c'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d866ed13-8a5d-415b-b87b-8db3d124bbcc'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='db9a6854-459f-4093-bcb0-7b67a47bc122'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='c32242ce-163a-48fc-8399-647ebaa7d6b8'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0b175382-d4ba-4235-a22f-91dc80fe788a'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7d1820a4-a973-4025-82e4-3c6b7cb9d42b'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='aef4e3e6-306e-4700-b8fc-97d37d415e3c'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='134d47af-68f9-4624-87fc-3c546ea4b3b2'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e12df796-ee1e-40e5-a97f-b3c5f37fb535'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='9db4c1ea-798e-4678-adb2-45f3e31f103f'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='f2c269c0-f06b-412b-9f47-53abb50e9ba2'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='01fdd1f3-d095-4957-ae52-3c50e087bfc8'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='826d70b1-4d1a-45fa-a007-978acf58ee9f'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='f49fdd35-80c7-4a76-aa71-0b825d3516b1'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='7aabb78b-ec7d-48b5-9cab-8521c64bec24'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='cdd38174-37f3-4a1f-acb4-344cae150a95'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='fc487573-ab39-44eb-beb2-25820bec0386'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e62e5812-432f-484d-9534-67ab402866e9'),
              AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='524f29b5-45ff-4884-86a5-7523457c4a72'),
              HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='42b810dc-52dd-4f43-bc08-633a19ea0b9e'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='d5ac38f8-062c-46f1-b226-e1f88636a1d1'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='c78eb3f5-117a-473b-8c16-afd80ba6ee50'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='e67562e2-24fe-4e6d-91d8-4ffbeb26ebf4'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='da712543-8669-424f-83c9-8697decc99db'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='a4713433-14b2-44de-b2c7-712099a71f75'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT mode, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' GROUP BY mode"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--6346a4ec-2721-4153-a1e4-c8a983454102-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT mode, SUM(amount) AS total_amount FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' GROUP BY mode"}, 'id': 'da703d50-daf0-421e-a1e1-9c0a45302541', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2300, 'output_tokens': 72, 'total_tokens': 2372, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='| mode        |   total_amount |\n|:------------|---------------:|\n| NET BANKING |        27216.8 |\n| 8f          |          360   |\n| UPI         |        69559.6 |', name='query_duckdb_tool', id='b8f0c679-d275-487f-bd97-9162a782cb9b', tool_call_id='da703d50-daf0-421e-a1e1-9c0a45302541'),
              AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--8e2ff144-e72e-48ef-9770-c69275bee706-0', usage_metadata={'input_tokens': 2435, 'output_tokens': 104, 'total_tokens': 2539, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='explain transactions', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')}
2025-07-14 06:06:12,967 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:06:12,968 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'), Message(role='user', content='explain this month transaction based on different modes?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."), Message(role='user', content='summerise UPI transactions based on debit and credit')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='explain transactions', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')
2025-07-14 06:06:12,969 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'}, {'role': 'user', 'content': 'explain this month transaction based on different modes?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."}, {'role': 'user', 'content': 'summerise UPI transactions based on debit and credit'}], 'validated_query': {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}}
2025-07-14 06:06:12,972 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e5c93b0> default_metadata=() model_kwargs={}
2025-07-14 06:06:13,007 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:06:13,007 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:06:13,007 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:06:15,131 - graph - INFO - Existing vq : {'intent': 'explain transactions', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:06:15,132 - graph - INFO - vq after - new parsed message from user: {'intent': 'summarise UPI transactions based on debit and credit', 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:06:15,133 - graph - INFO - Merged final_query: Intent: summarise UPI transactions based on debit and credit, Bank: ICICI, Account No: XXXXXXXX6193, Month: this month, Year: 2025, Date Range: 01-06-2024 to 30-06-2024 Query Hint: total amount spent on UPI 
2025-07-14 06:06:15,133 - graph - INFO - Start routing logic
2025-07-14 06:06:15,134 - graph - INFO - Validated Query Check: {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:06:15,134 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:06:15,135 - graph - INFO - Confirm node start...
2025-07-14 06:06:15,135 - graph - INFO - user's last message: content='summerise UPI transactions based on debit and credit' additional_kwargs={} response_metadata={} id='d19c5fdd-3b7d-4330-aea3-4092537030b1'
2025-07-14 06:06:15,136 - graph - INFO - Start routing logic
2025-07-14 06:06:15,141 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='790a24f4-e58c-45bf-a3d9-bec27d1d8e5a'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='975b9796-1b13-4b46-b6d5-28f3ff0d229f'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b0a78069-7486-44f0-a6ec-62ededd6f8a2'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='d524181e-8d77-482c-8327-b1ea0375ccf0'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='2931f4ac-bad5-4a86-8268-3fb4e049262b'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='3c1ab9f6-6018-4ebe-b519-bae41811056b'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='370b377a-46e5-415a-b4b9-b3b5d1905f6f'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='c52337bc-1d2a-4688-83b1-c48fadfb521d'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='f7bbcb53-6a95-496b-95b5-60bcc3ba1def'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0185dc59-96f4-44fe-9e2f-0f6a1cb4b7c1'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='36b4482c-7faa-443f-bf41-0508bdbb398f'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='e436793c-6576-4483-912f-3ffef66e17f9'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='a7d04888-2a0e-4891-8aa9-f7ef7444cfb3'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='45a9ce95-aebc-4276-8bd0-88489e027678'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='31e81b65-8520-4dac-ab57-b3c0bea76ef4'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='411a2ed3-4f7a-4f10-bf26-35c6d8fcb152'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='b2403d09-eb0e-4ab5-8770-a5b310024d40'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ab97806f-f801-4087-ba38-807f1735ec4a'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='076ef1dc-9da5-4e5a-b942-3d33c0354f6d'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='ffb5eb63-bbd2-4b95-9676-664530ce309c'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='4e80a48d-8eb7-4eba-8ee8-16bca60fdb3a'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='256c52eb-e707-43cb-949a-9cf5ce72aa17'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='3c95b7a2-88f5-41c5-bbd8-13dc7f8107ae'),
              AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='10851a81-ec21-4afa-9d0a-d3b3afb59118'),
              HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='4b4595e3-daad-4501-bd38-3b4d83dc8464'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bd0edc9c-548b-424e-b77d-3b7ce2e9ad87'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='f444ef10-5440-41fc-8603-378596c09cba'),
              AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='704cc65c-c99d-4bad-aeb1-3e1f61c79667'),
              HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='d19c5fdd-3b7d-4330-aea3-4092537030b1'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='85df6028-d8fe-414c-8881-d197357e341a'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='5031a84f-633a-48c2-9d75-3bf02aafa15d')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='summarise UPI transactions based on debit and credit', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')}
2025-07-14 06:06:21,616 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:06:21,617 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'), Message(role='user', content='explain this month transaction based on different modes?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."), Message(role='user', content='summerise UPI transactions based on debit and credit'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='summarise UPI transactions based on debit and credit', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')
2025-07-14 06:06:21,618 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'}, {'role': 'user', 'content': 'explain this month transaction based on different modes?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."}, {'role': 'user', 'content': 'summerise UPI transactions based on debit and credit'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}}
2025-07-14 06:06:21,622 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e5bb2f0> default_metadata=() model_kwargs={}
2025-07-14 06:06:21,655 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:06:21,655 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:06:21,655 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:06:23,908 - graph - INFO - Existing vq : {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:06:23,908 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:06:23,908 - graph - INFO - Merged final_query: Intent: summarise UPI transactions based on debit and credit, Bank: ICICI, Account No: XXXXXXXX6193, Month: this month, Year: 2025, Date Range: 01-06-2024 to 30-06-2024 Query Hint: total amount spent on UPI 
2025-07-14 06:06:23,908 - graph - INFO - Start routing logic
2025-07-14 06:06:23,909 - graph - INFO - Validated Query Check: {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:06:23,909 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:06:23,909 - graph - INFO - Confirm node start...
2025-07-14 06:06:23,910 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='3c44c452-14a0-4556-92a0-3245d8371a4c'
2025-07-14 06:06:23,910 - graph - INFO - Start routing logic
2025-07-14 06:06:23,910 - graph - INFO - Validated Query Check: {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:06:23,910 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 06:06:23,911 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:06:23,914 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='03233452-82ed-4470-8986-16a7936588c3'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1ad5e863-5d73-4f27-987d-4ef2a4abe5e1'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='941b569e-0578-4d03-b636-4a7d15ba75a3'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='f0e62ec7-ab08-468f-8ce5-0596bfb7ac6a'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='ef664097-727f-4e5b-9d5d-476684c1564b'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e87dab31-4d9d-46a9-b50d-b87294e8d816'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='1f3fb089-117e-43ef-afb2-11ab02fe72b5'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='f785fc12-38f7-45da-a604-37ad0efe0318'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='d1ca457b-6a14-44db-9dd7-c4f58f65a8df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='441b2003-2a35-45c2-b882-f9f923de5821'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d7940683-e0c7-429e-8ac5-bb3c3a89863f'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='7cc7bcc7-1ea6-4026-bab1-7637e47f0517'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='8826ee96-bcae-4f80-8011-f5e8134bcea6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='aaa7bf0e-0c68-4b82-a95c-5f3e1798d853'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='3226452f-445a-43d0-ad90-fe674d108311'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0198f776-b823-4c4a-b0af-74ae9e0dc927'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='f6209afa-09c4-442e-b4df-da878ff3f5bc'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='009c5ec2-6e42-4c11-81e9-fe3457ca9031'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='832195ba-1ded-4316-95d2-f75f34fb8a07'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='6687fcf9-c48e-46b6-855f-2c347fba5cf5'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='85dd78e9-b194-47ae-9402-069334646d30'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1693a856-43c7-400e-884e-9182bd847207'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='8c5afb3f-be59-4abe-95bb-39cdd4015036'),
 AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='fe10ac78-9c01-4a20-b085-450de21bd80c'),
 HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='0090ac63-966d-41d7-834c-140a16c2b31e'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b04e7aad-08b6-47de-9c25-386887bb7c81'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7a75df9e-5a8a-4aa8-8db5-8418c6b5a008'),
 AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='66c6bd9d-bb19-41b4-923a-88c8e2d24a6a'),
 HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='f4515721-320c-4bc1-a2b0-a54cd82e13f1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4bc852ab-6866-49cf-870c-d34857c92346'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='3c44c452-14a0-4556-92a0-3245d8371a4c'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='5d067664-8dbc-4435-a322-7f67541ca057'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='25dfc3a6-9769-4551-aec4-76212f49edbd'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='bab4293a-a071-493d-8ac3-02a3443c8835'),
 SystemMessage(content='User intends to ask: summarise UPI transactions based on debit and credit for ICICI account XXXXXXXX6193 in this month 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:06:25,138 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT type, SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND mode = \'UPI\' GROUP BY type"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--51d2acaa-15ef-4cdb-bf0b-932b0e059164-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT type, SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND mode = 'UPI' GROUP BY type"}, 'id': '416f355a-8a3b-45e8-9a72-a21cb8021ecf', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2523, 'output_tokens': 74, 'total_tokens': 2597, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:06:25,142 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:06:25,167 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:06:25,169 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='03233452-82ed-4470-8986-16a7936588c3'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1ad5e863-5d73-4f27-987d-4ef2a4abe5e1'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='941b569e-0578-4d03-b636-4a7d15ba75a3'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='f0e62ec7-ab08-468f-8ce5-0596bfb7ac6a'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='ef664097-727f-4e5b-9d5d-476684c1564b'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e87dab31-4d9d-46a9-b50d-b87294e8d816'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='1f3fb089-117e-43ef-afb2-11ab02fe72b5'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='f785fc12-38f7-45da-a604-37ad0efe0318'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='d1ca457b-6a14-44db-9dd7-c4f58f65a8df'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='441b2003-2a35-45c2-b882-f9f923de5821'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d7940683-e0c7-429e-8ac5-bb3c3a89863f'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='7cc7bcc7-1ea6-4026-bab1-7637e47f0517'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='8826ee96-bcae-4f80-8011-f5e8134bcea6'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='aaa7bf0e-0c68-4b82-a95c-5f3e1798d853'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='3226452f-445a-43d0-ad90-fe674d108311'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0198f776-b823-4c4a-b0af-74ae9e0dc927'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='f6209afa-09c4-442e-b4df-da878ff3f5bc'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='009c5ec2-6e42-4c11-81e9-fe3457ca9031'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='832195ba-1ded-4316-95d2-f75f34fb8a07'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='6687fcf9-c48e-46b6-855f-2c347fba5cf5'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='85dd78e9-b194-47ae-9402-069334646d30'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1693a856-43c7-400e-884e-9182bd847207'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='8c5afb3f-be59-4abe-95bb-39cdd4015036'),
 AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='fe10ac78-9c01-4a20-b085-450de21bd80c'),
 HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='0090ac63-966d-41d7-834c-140a16c2b31e'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b04e7aad-08b6-47de-9c25-386887bb7c81'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7a75df9e-5a8a-4aa8-8db5-8418c6b5a008'),
 AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='66c6bd9d-bb19-41b4-923a-88c8e2d24a6a'),
 HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='f4515721-320c-4bc1-a2b0-a54cd82e13f1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4bc852ab-6866-49cf-870c-d34857c92346'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='3c44c452-14a0-4556-92a0-3245d8371a4c'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='5d067664-8dbc-4435-a322-7f67541ca057'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='25dfc3a6-9769-4551-aec4-76212f49edbd'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='bab4293a-a071-493d-8ac3-02a3443c8835'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT type, SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND mode = \'UPI\' GROUP BY type"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--51d2acaa-15ef-4cdb-bf0b-932b0e059164-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT type, SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND mode = 'UPI' GROUP BY type"}, 'id': '416f355a-8a3b-45e8-9a72-a21cb8021ecf', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2523, 'output_tokens': 74, 'total_tokens': 2597, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='| type   |   sum(amount) |\n|:-------|--------------:|\n| DEBIT  |       12053.5 |\n| CREDIT |       57506   |', name='query_duckdb_tool', id='638613db-26ab-44ae-854f-cd1d0bbe15d5', tool_call_id='416f355a-8a3b-45e8-9a72-a21cb8021ecf'),
 SystemMessage(content='User intends to ask: summarise UPI transactions based on debit and credit for ICICI account XXXXXXXX6193 in this month 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:06:26,208 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content="Here's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--cfa0e82d-a21a-4cf8-b9f4-9ddc5442414a-0', usage_metadata={'input_tokens': 2646, 'output_tokens': 53, 'total_tokens': 2699, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:06:26,215 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='03233452-82ed-4470-8986-16a7936588c3'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1ad5e863-5d73-4f27-987d-4ef2a4abe5e1'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='941b569e-0578-4d03-b636-4a7d15ba75a3'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='f0e62ec7-ab08-468f-8ce5-0596bfb7ac6a'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='ef664097-727f-4e5b-9d5d-476684c1564b'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e87dab31-4d9d-46a9-b50d-b87294e8d816'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='1f3fb089-117e-43ef-afb2-11ab02fe72b5'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='f785fc12-38f7-45da-a604-37ad0efe0318'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='d1ca457b-6a14-44db-9dd7-c4f58f65a8df'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='441b2003-2a35-45c2-b882-f9f923de5821'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d7940683-e0c7-429e-8ac5-bb3c3a89863f'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='7cc7bcc7-1ea6-4026-bab1-7637e47f0517'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='8826ee96-bcae-4f80-8011-f5e8134bcea6'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='aaa7bf0e-0c68-4b82-a95c-5f3e1798d853'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='3226452f-445a-43d0-ad90-fe674d108311'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0198f776-b823-4c4a-b0af-74ae9e0dc927'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='f6209afa-09c4-442e-b4df-da878ff3f5bc'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='009c5ec2-6e42-4c11-81e9-fe3457ca9031'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='832195ba-1ded-4316-95d2-f75f34fb8a07'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='6687fcf9-c48e-46b6-855f-2c347fba5cf5'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='85dd78e9-b194-47ae-9402-069334646d30'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1693a856-43c7-400e-884e-9182bd847207'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='8c5afb3f-be59-4abe-95bb-39cdd4015036'),
              AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='fe10ac78-9c01-4a20-b085-450de21bd80c'),
              HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='0090ac63-966d-41d7-834c-140a16c2b31e'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b04e7aad-08b6-47de-9c25-386887bb7c81'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7a75df9e-5a8a-4aa8-8db5-8418c6b5a008'),
              AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='66c6bd9d-bb19-41b4-923a-88c8e2d24a6a'),
              HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='f4515721-320c-4bc1-a2b0-a54cd82e13f1'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='4bc852ab-6866-49cf-870c-d34857c92346'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='3c44c452-14a0-4556-92a0-3245d8371a4c'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='5d067664-8dbc-4435-a322-7f67541ca057'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='25dfc3a6-9769-4551-aec4-76212f49edbd'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='bab4293a-a071-493d-8ac3-02a3443c8835'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT type, SUM(amount) FROM TRANSACTIONS WHERE bank = \'ICICI\' AND account_no = \'XXXXXXXX6193\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND mode = \'UPI\' GROUP BY type"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--51d2acaa-15ef-4cdb-bf0b-932b0e059164-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT type, SUM(amount) FROM TRANSACTIONS WHERE bank = 'ICICI' AND account_no = 'XXXXXXXX6193' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND mode = 'UPI' GROUP BY type"}, 'id': '416f355a-8a3b-45e8-9a72-a21cb8021ecf', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2523, 'output_tokens': 74, 'total_tokens': 2597, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='| type   |   sum(amount) |\n|:-------|--------------:|\n| DEBIT  |       12053.5 |\n| CREDIT |       57506   |', name='query_duckdb_tool', id='638613db-26ab-44ae-854f-cd1d0bbe15d5', tool_call_id='416f355a-8a3b-45e8-9a72-a21cb8021ecf'),
              AIMessage(content="\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506", additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--cfa0e82d-a21a-4cf8-b9f4-9ddc5442414a-0', usage_metadata={'input_tokens': 2646, 'output_tokens': 53, 'total_tokens': 2699, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='summarise UPI transactions based on debit and credit', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')}
2025-07-14 06:07:54,147 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:07:54,149 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'), Message(role='user', content='explain this month transaction based on different modes?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."), Message(role='user', content='summerise UPI transactions based on debit and credit'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506"), Message(role='user', content='can you tell me the total expense from both accounts 6193 and 9469 in the month of june')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='summarise UPI transactions based on debit and credit', bank='ICICI', account_no='XXXXXXXX6193', month='this month', year='2025', date_range='01-06-2024 to 30-06-2024', query_hint='total amount spent on UPI')
2025-07-14 06:07:54,150 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'}, {'role': 'user', 'content': 'explain this month transaction based on different modes?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."}, {'role': 'user', 'content': 'summerise UPI transactions based on debit and credit'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506"}, {'role': 'user', 'content': 'can you tell me the total expense from both accounts 6193 and 9469 in the month of june'}], 'validated_query': {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}}
2025-07-14 06:07:54,160 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x12a09cf50> default_metadata=() model_kwargs={}
2025-07-14 06:07:54,198 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:07:54,198 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:07:54,199 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:07:56,472 - graph - INFO - Existing vq : {'intent': 'summarise UPI transactions based on debit and credit', 'bank': 'ICICI', 'account_no': 'XXXXXXXX6193', 'month': 'this month', 'year': '2025', 'date_range': '01-06-2024 to 30-06-2024', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:07:56,473 - graph - INFO - vq after - new parsed message from user: {'intent': 'get spending details', 'bank': None, 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': None, 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': None}
2025-07-14 06:07:56,473 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: total amount spent on UPI 
2025-07-14 06:07:56,474 - graph - INFO - Start routing logic
2025-07-14 06:07:56,474 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:07:56,474 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:07:56,476 - graph - INFO - Confirm node start...
2025-07-14 06:07:56,476 - graph - INFO - user's last message: content='can you tell me the total expense from both accounts 6193 and 9469 in the month of june' additional_kwargs={} response_metadata={} id='979967ed-c834-4909-ab1a-5855bf8d7e9c'
2025-07-14 06:07:56,477 - graph - INFO - Start routing logic
2025-07-14 06:07:56,482 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='bf782991-4d98-48a6-a622-167949b440df'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b4beb1d5-ecd1-48ae-bc21-adfa9161bd7c'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='186f3605-01ef-45a0-ab50-c00eebb0f57e'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='7fa6bf45-3664-4ec6-b177-d79ea5f090e5'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='3d2db1ee-2527-4748-9487-86374df6e7da'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c490fb39-7e06-477b-8a8e-3e21666e0fc1'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='52e9f659-900e-4770-afb7-a69cf87771ef'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='858e2692-f3da-4300-94be-19d0b2564975'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='cde11138-1ba7-4bfc-b25f-b180597f45b8'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='1df4854a-b35c-42fd-bacc-42322592c5a1'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b702ffff-671c-4b29-be8c-d311fe10dc21'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='5aa3d667-4442-417a-94cd-8b0fc0704924'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='7833178b-ceec-4088-ab20-7ec45597bbdd'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='6575b8a6-6026-4026-91ac-e4800b1e2b56'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='90f60353-dcea-4b8e-98d4-2a8c5c788e50'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='093475c7-75a7-47d4-b455-52dd371faa9c'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='b03f73be-7d2a-4a2b-a419-6c627915f62c'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='83285d45-21cc-4e5a-82be-5796a8102c4f'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='94ce8508-d2ec-4caa-96f0-b3591f97e4f2'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='7e26d784-e759-4ff0-9a67-4184b67cd202'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='57bf6179-e5f3-4d20-a9d7-58b2d56b661e'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='198cdc15-aa39-40d9-85b5-31fcde2940be'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='3b5c9d39-d5a1-43e8-9717-b9ea30ffaa5b'),
              AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='36e03bac-4116-49dd-899d-fc5c449bdbd0'),
              HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='419e638f-fccd-4281-8494-2911c8e0d847'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b74557c0-1a9e-4579-8263-97f6b1816168'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='bf6229a6-826f-4264-ab6e-ec5105ea36ef'),
              AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='2eb63bc9-3164-4f5f-aab7-bde2ed6eb164'),
              HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='9509f2c1-4e2f-4d82-a5a7-0e27aca316c1'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b8159ce9-2a2e-44b1-a532-07ba545ad786'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='2ecd892a-3b9f-4fb7-b91f-586ba9083a88'),
              AIMessage(content="\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506", additional_kwargs={}, response_metadata={}, id='07f9474e-73b6-4fa9-85ef-877518e539df'),
              HumanMessage(content='can you tell me the total expense from both accounts 6193 and 9469 in the month of june', additional_kwargs={}, response_metadata={}, id='979967ed-c834-4909-ab1a-5855bf8d7e9c'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='1a4df525-d49b-4e1d-9565-4555bb6a6fd4'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='380df4cd-9d97-4d0f-b7c1-841657ba1f85')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='total amount spent on UPI')}
2025-07-14 06:08:02,107 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 06:08:02,108 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='analyse the ICICI bank account 9469 for the month of June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"), Message(role='user', content='tell me the highest transactions made in a single day in the month of June?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'), Message(role='user', content='who is the receiver of this amount?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'), Message(role='user', content='i want change account number to 6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='modify the intent to find the total expense'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'), Message(role='user', content='what is the total amount spent on UPI ?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'), Message(role='user', content='explain this month transaction based on different modes?'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."), Message(role='user', content='summerise UPI transactions based on debit and credit'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes'), Message(role='ai', content="\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506"), Message(role='user', content='can you tell me the total expense from both accounts 6193 and 9469 in the month of june'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"), Message(role='user', content='yes')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='total amount spent on UPI')
2025-07-14 06:08:02,108 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'analyse the ICICI bank account 9469 for the month of June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI"}, {'role': 'user', 'content': 'tell me the highest transactions made in a single day in the month of June?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.'}, {'role': 'user', 'content': 'who is the receiver of this amount?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.'}, {'role': 'user', 'content': 'i want change account number to 6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'modify the intent to find the total expense'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.'}, {'role': 'user', 'content': 'what is the total amount spent on UPI ?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': '\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.'}, {'role': 'user', 'content': 'explain this month transaction based on different modes?'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI."}, {'role': 'user', 'content': 'summerise UPI transactions based on debit and credit'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}, {'role': 'ai', 'content': "\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506"}, {'role': 'user', 'content': 'can you tell me the total expense from both accounts 6193 and 9469 in the month of june'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'yes'}], 'validated_query': {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}}
2025-07-14 06:08:02,112 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e50b430> default_metadata=() model_kwargs={}
2025-07-14 06:08:02,146 - graph - INFO - 1.Planning Node entered...
2025-07-14 06:08:02,146 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:08:02,146 - graph - INFO - 2.Validation Node entered...
2025-07-14 06:08:04,363 - graph - INFO - Existing vq : {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'}
2025-07-14 06:08:04,363 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 06:08:04,363 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: total amount spent on UPI 
2025-07-14 06:08:04,364 - graph - INFO - Start routing logic
2025-07-14 06:08:04,364 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:08:04,364 - graph - INFO - Awaiting user confirmation.
2025-07-14 06:08:04,365 - graph - INFO - Confirm node start...
2025-07-14 06:08:04,366 - graph - INFO - user's last message: content='yes' additional_kwargs={} response_metadata={} id='b6fcc7dd-7f9f-4291-bfa2-4ceb535db52f'
2025-07-14 06:08:04,367 - graph - INFO - Start routing logic
2025-07-14 06:08:04,368 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'total amount spent on UPI'} ‚Äî Missing: []
2025-07-14 06:08:04,369 - graph - INFO - ‚úÖ Confirmed. Proceeding.
2025-07-14 06:08:04,370 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:08:04,374 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='607c4826-bc9a-42bb-b9fa-15b5e8b331b1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='48dcb757-f4c6-4655-92e6-6d5f227a6521'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='bd146858-7a30-44a7-b5fa-f1a5b6730a48'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='adf08d3d-5c8c-43d3-a127-aa86216097c6'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='41f2bb2a-74a5-4409-8bc3-3ac59e328f6a'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c12d1832-6ac4-4685-b144-ab1426cfcb2d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e3585dd3-10d0-4001-a2cb-7039f708101e'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='5cef942d-710b-4d19-a9d8-780d210b15a8'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='a5501bbc-976d-40c6-a6cd-eb3dbfd3c9cb'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b18280bb-fb53-453a-a567-0d4ef48b9426'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5ef7792a-11cb-46e9-95af-84c6d2d1043b'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='6f69d6ae-ad4d-4a0f-809a-bb7e0fd83de7'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='a7bf6a59-9296-4af8-9405-5ea207cc3262'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='778c2474-95bd-4b86-8a64-73737ec24696'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='6c15a567-5000-4b11-a194-f53d4ea145f3'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='7eec4d5d-4e57-4105-a6dd-af04195fc504'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='3304ef23-1ced-4d05-914f-d0d9fdf30693'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ee369d9d-d16b-4103-beeb-1655d84003f2'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='10eaaee0-6348-4f62-8399-6f4030f8ca00'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='3fd58c8d-9f99-445f-805a-b353d75f2684'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='60be23db-21f6-4178-9463-8e98a3dd02f9'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0a094f6a-3391-45ca-a93c-cf704cef79ba'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d6f6dc4a-f72d-4fec-a045-4ec3e8b9d97e'),
 AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='20db0375-d3aa-408b-886d-7c6a7eb9952f'),
 HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='3cd69f5b-ee53-406e-afae-bf130ba754c3'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='31689d5f-d1d9-4ae5-96ff-4a4b8f7929e9'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7302142e-eda9-47d9-85b6-7b702be748fd'),
 AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='32edf576-9314-414e-a326-9d69a86dacb8'),
 HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='2d4c9c30-876b-43fe-a439-38efb93e8320'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='64e7d463-c675-4449-b88d-9d48e2686a2e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e84f92f0-313b-4fb5-a14f-610d25b95ab3'),
 AIMessage(content="\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506", additional_kwargs={}, response_metadata={}, id='992dea7b-8771-427f-9927-f1ed4120c34a'),
 HumanMessage(content='can you tell me the total expense from both accounts 6193 and 9469 in the month of june', additional_kwargs={}, response_metadata={}, id='c791fc7e-d0d4-485b-a111-38dac924d058'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bfe8650b-0a24-41fa-97f3-030bb2537c33'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b6fcc7dd-7f9f-4291-bfa2-4ceb535db52f'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='daab7f42-d985-4292-b4eb-e89a0bec936d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='aa22b6ff-56be-42ba-881e-6c2b54e34b5d'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='34b83167-fb87-4bcb-bf3d-efd09bbaa452'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:08:06,000 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = \'XXXXXXXX9469\' AND bank = \'ICICI\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--dcbb0809-5dae-4ba7-82cf-0b275a20178b-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX6193' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': 'b0052b61-155b-4e3b-a074-0b997a116f93', 'type': 'tool_call'}, {'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX9469' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': 'fb1de078-cca3-4a89-8542-c4dd2eb6a54c', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2682, 'output_tokens': 139, 'total_tokens': 2821, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:08:06,006 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:08:06,007 - duckdb_tools - INFO - Entering query_duckdb_tool() ...
2025-07-14 06:08:06,032 - graph - INFO - ****** Entering chatbot ...

2025-07-14 06:08:06,034 - graph - INFO - Input Message Starts ------------------------------------------------------------ 
[SystemMessage(content="\nYou are a financial assistant. Today's date is 2025-07-14. This date is in yyyy-mm-dd format. You can use this to reason time-based queries.\nYou can do following to answer queries.\n- From user input message derive the query terms to find the relevant data.\n- Relevant data may be there in DuckDB database. Check first.\n- If it is not there in database, pull it from Gmail.\n- Fetch bank statements from Gmail and download the attahment\n- Extract and store transactions in database\nAlways create a plan and follow through, using tools as needed.\n", additional_kwargs={}, response_metadata={}),
 HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='607c4826-bc9a-42bb-b9fa-15b5e8b331b1'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='48dcb757-f4c6-4655-92e6-6d5f227a6521'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='bd146858-7a30-44a7-b5fa-f1a5b6730a48'),
 AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='adf08d3d-5c8c-43d3-a127-aa86216097c6'),
 HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='41f2bb2a-74a5-4409-8bc3-3ac59e328f6a'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c12d1832-6ac4-4685-b144-ab1426cfcb2d'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e3585dd3-10d0-4001-a2cb-7039f708101e'),
 AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='5cef942d-710b-4d19-a9d8-780d210b15a8'),
 HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='a5501bbc-976d-40c6-a6cd-eb3dbfd3c9cb'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b18280bb-fb53-453a-a567-0d4ef48b9426'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5ef7792a-11cb-46e9-95af-84c6d2d1043b'),
 AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='6f69d6ae-ad4d-4a0f-809a-bb7e0fd83de7'),
 HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='a7bf6a59-9296-4af8-9405-5ea207cc3262'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='778c2474-95bd-4b86-8a64-73737ec24696'),
 HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='6c15a567-5000-4b11-a194-f53d4ea145f3'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='7eec4d5d-4e57-4105-a6dd-af04195fc504'),
 HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='3304ef23-1ced-4d05-914f-d0d9fdf30693'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ee369d9d-d16b-4103-beeb-1655d84003f2'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='10eaaee0-6348-4f62-8399-6f4030f8ca00'),
 AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='3fd58c8d-9f99-445f-805a-b353d75f2684'),
 HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='60be23db-21f6-4178-9463-8e98a3dd02f9'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0a094f6a-3391-45ca-a93c-cf704cef79ba'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d6f6dc4a-f72d-4fec-a045-4ec3e8b9d97e'),
 AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='20db0375-d3aa-408b-886d-7c6a7eb9952f'),
 HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='3cd69f5b-ee53-406e-afae-bf130ba754c3'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='31689d5f-d1d9-4ae5-96ff-4a4b8f7929e9'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7302142e-eda9-47d9-85b6-7b702be748fd'),
 AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='32edf576-9314-414e-a326-9d69a86dacb8'),
 HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='2d4c9c30-876b-43fe-a439-38efb93e8320'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='64e7d463-c675-4449-b88d-9d48e2686a2e'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e84f92f0-313b-4fb5-a14f-610d25b95ab3'),
 AIMessage(content="\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506", additional_kwargs={}, response_metadata={}, id='992dea7b-8771-427f-9927-f1ed4120c34a'),
 HumanMessage(content='can you tell me the total expense from both accounts 6193 and 9469 in the month of june', additional_kwargs={}, response_metadata={}, id='c791fc7e-d0d4-485b-a111-38dac924d058'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bfe8650b-0a24-41fa-97f3-030bb2537c33'),
 HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b6fcc7dd-7f9f-4291-bfa2-4ceb535db52f'),
 AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='daab7f42-d985-4292-b4eb-e89a0bec936d'),
 AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='aa22b6ff-56be-42ba-881e-6c2b54e34b5d'),
 AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='34b83167-fb87-4bcb-bf3d-efd09bbaa452'),
 AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = \'XXXXXXXX9469\' AND bank = \'ICICI\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--dcbb0809-5dae-4ba7-82cf-0b275a20178b-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX6193' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': 'b0052b61-155b-4e3b-a074-0b997a116f93', 'type': 'tool_call'}, {'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX9469' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': 'fb1de078-cca3-4a89-8542-c4dd2eb6a54c', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2682, 'output_tokens': 139, 'total_tokens': 2821, 'input_token_details': {'cache_read': 0}}),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|       39270.3 |', name='query_duckdb_tool', id='2e418526-1b2d-4c04-a6b5-665329c9ab46', tool_call_id='b0052b61-155b-4e3b-a074-0b997a116f93'),
 ToolMessage(content='|   sum(amount) |\n|--------------:|\n|             3 |', name='query_duckdb_tool', id='82ea668a-491c-46ef-b8a4-b90528ac1657', tool_call_id='fb1de078-cca3-4a89-8542-c4dd2eb6a54c'),
 SystemMessage(content='User intends to ask: get spending details for ICICI account XXXXXXXX9469 in June 2025', additional_kwargs={}, response_metadata={})]
 Input Message End ------------------------------------------------------------
2025-07-14 06:08:07,127 - graph - INFO - AI Response Starts here ------------------------------------------------------------ 
AIMessage(content='The total expense from account XXXXXXXX6193 in June 2025 is 39270.3 and the total expense from account XXXXXXXX9469 is 3. The combined total expense from both accounts is 39273.3.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--837e1c05-1c87-4358-b47a-7f140ee56b43-0', usage_metadata={'input_tokens': 2872, 'output_tokens': 61, 'total_tokens': 2933, 'input_token_details': {'cache_read': 0}})
 ------------------------------------------------------------
2025-07-14 06:08:07,137 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': False,
 'confirmed': True,
 'messages': [HumanMessage(content='analyse the ICICI bank account 9469 for the month of June', additional_kwargs={}, response_metadata={}, id='607c4826-bc9a-42bb-b9fa-15b5e8b331b1'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='48dcb757-f4c6-4655-92e6-6d5f227a6521'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='bd146858-7a30-44a7-b5fa-f1a5b6730a48'),
              AIMessage(content="\nHere's the analysis of your ICICI bank account XXXXXXXX9469 for June 2025:\n\n*   **Balance Forward:** 2025-06-01, Amount: 0, Balance: 276.25\n*   **Debit:** 2025-06-13, Description: MMT/IMPS/516407166609/SATYA SUND/SBIN0018701, Amount: 3, Balance: 273.25\n*   **Credit:** 2025-06-20, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/517131647124/, Amount: 2000, Balance: 2273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-29, Description: UPI/6370246997@idfc/Pay request/IDFC FIRST BANK/518037130771/, Amount: 3000, Balance: 5273.25, Receiver: 6370246997@idfc\n*   **Credit:** 2025-06-30, Description: Int.Pd:29-03-2025 to 29-06-2025, Amount: 7, Balance: 5280.25, Receiver: ICICI", additional_kwargs={}, response_metadata={}, id='adf08d3d-5c8c-43d3-a127-aa86216097c6'),
              HumanMessage(content='tell me the highest transactions made in a single day in the month of June?', additional_kwargs={}, response_metadata={}, id='41f2bb2a-74a5-4409-8bc3-3ac59e328f6a'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get highest transactions\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c12d1832-6ac4-4685-b144-ab1426cfcb2d'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e3585dd3-10d0-4001-a2cb-7039f708101e'),
              AIMessage(content='\nThe highest transaction made in a single day in June 2025 for ICICI account XXXXXXXX9469 was on 2025-06-29 with a total amount of 3000.0.', additional_kwargs={}, response_metadata={}, id='5cef942d-710b-4d19-a9d8-780d210b15a8'),
              HumanMessage(content='who is the receiver of this amount?', additional_kwargs={}, response_metadata={}, id='a5501bbc-976d-40c6-a6cd-eb3dbfd3c9cb'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='b18280bb-fb53-453a-a567-0d4ef48b9426'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='5ef7792a-11cb-46e9-95af-84c6d2d1043b'),
              AIMessage(content='\nThe receiver of the amount 3000.0 on 2025-06-29 for ICICI account XXXXXXXX9469 is 6370246997@idfc.', additional_kwargs={}, response_metadata={}, id='6f69d6ae-ad4d-4a0f-809a-bb7e0fd83de7'),
              HumanMessage(content='i want change account number to 6193', additional_kwargs={}, response_metadata={}, id='a7bf6a59-9296-4af8-9405-5ea207cc3262'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: who is the receiver of this amount?\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='778c2474-95bd-4b86-8a64-73737ec24696'),
              HumanMessage(content='modify the intent to find the total expense', additional_kwargs={}, response_metadata={}, id='6c15a567-5000-4b11-a194-f53d4ea145f3'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='7eec4d5d-4e57-4105-a6dd-af04195fc504'),
              HumanMessage(content='update the query hint subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193', additional_kwargs={}, response_metadata={}, id='3304ef23-1ced-4d05-914f-d0d9fdf30693'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: find the total expense\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX6193\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ee369d9d-d16b-4103-beeb-1655d84003f2'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='10eaaee0-6348-4f62-8399-6f4030f8ca00'),
              AIMessage(content='\nThe total expense for ICICI account XXXXXXXX6193 in June 2025 is 39270.3.', additional_kwargs={}, response_metadata={}, id='3fd58c8d-9f99-445f-805a-b353d75f2684'),
              HumanMessage(content='what is the total amount spent on UPI ?', additional_kwargs={}, response_metadata={}, id='60be23db-21f6-4178-9463-8e98a3dd02f9'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='0a094f6a-3391-45ca-a93c-cf704cef79ba'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='d6f6dc4a-f72d-4fec-a045-4ec3e8b9d97e'),
              AIMessage(content='\nThe total amount spent on UPI for ICICI account XXXXXXXX6193 in June 2025 is 12053.5.', additional_kwargs={}, response_metadata={}, id='20db0375-d3aa-408b-886d-7c6a7eb9952f'),
              HumanMessage(content='explain this month transaction based on different modes?', additional_kwargs={}, response_metadata={}, id='3cd69f5b-ee53-406e-afae-bf130ba754c3'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: explain transactions\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='31689d5f-d1d9-4ae5-96ff-4a4b8f7929e9'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='7302142e-eda9-47d9-85b6-7b702be748fd'),
              AIMessage(content="\nOK. Here's a breakdown of the transactions for ICICI account XXXXXXXX6193 in June 2025, based on different modes:\n\n*   **Net Banking:** A total of 27216.8 was transacted through Net Banking.\n*   **8f:** A total of 360 was transacted through mode 8f.\n*   **UPI:** A total of 69559.6 was transacted through UPI.", additional_kwargs={}, response_metadata={}, id='32edf576-9314-414e-a326-9d69a86dacb8'),
              HumanMessage(content='summerise UPI transactions based on debit and credit', additional_kwargs={}, response_metadata={}, id='2d4c9c30-876b-43fe-a439-38efb93e8320'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: summarise UPI transactions based on debit and credit\nbank: ICICI\naccount_no: XXXXXXXX6193\nmonth: this month\nyear: 2025\ndate_range: 01-06-2024 to 30-06-2024\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='64e7d463-c675-4449-b88d-9d48e2686a2e'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='e84f92f0-313b-4fb5-a14f-610d25b95ab3'),
              AIMessage(content="\nHere's a summary of the UPI transactions for ICICI account XXXXXXXX6193 in June 2025:\n\n*   **Debit:** ‚Çπ12053.5\n*   **Credit:** ‚Çπ57506", additional_kwargs={}, response_metadata={}, id='992dea7b-8771-427f-9927-f1ed4120c34a'),
              HumanMessage(content='can you tell me the total expense from both accounts 6193 and 9469 in the month of june', additional_kwargs={}, response_metadata={}, id='c791fc7e-d0d4-485b-a111-38dac924d058'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='bfe8650b-0a24-41fa-97f3-030bb2537c33'),
              HumanMessage(content='yes', additional_kwargs={}, response_metadata={}, id='b6fcc7dd-7f9f-4291-bfa2-4ceb535db52f'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='daab7f42-d985-4292-b4eb-e89a0bec936d'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: total amount spent on UPI\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='aa22b6ff-56be-42ba-881e-6c2b54e34b5d'),
              AIMessage(content='‚úÖ Great! Proceeding now...', additional_kwargs={}, response_metadata={}, id='34b83167-fb87-4bcb-bf3d-efd09bbaa452'),
              AIMessage(content='\n', additional_kwargs={'function_call': {'name': 'query_duckdb_tool', 'arguments': '{"query": "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = \'XXXXXXXX9469\' AND bank = \'ICICI\' AND date BETWEEN \'2025-06-01\' AND \'2025-06-30\' AND type = \'DEBIT\'"}'}}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--dcbb0809-5dae-4ba7-82cf-0b275a20178b-0', tool_calls=[{'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX6193' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': 'b0052b61-155b-4e3b-a074-0b997a116f93', 'type': 'tool_call'}, {'name': 'query_duckdb_tool', 'args': {'query': "SELECT SUM(amount) FROM TRANSACTIONS WHERE account_no = 'XXXXXXXX9469' AND bank = 'ICICI' AND date BETWEEN '2025-06-01' AND '2025-06-30' AND type = 'DEBIT'"}, 'id': 'fb1de078-cca3-4a89-8542-c4dd2eb6a54c', 'type': 'tool_call'}], usage_metadata={'input_tokens': 2682, 'output_tokens': 139, 'total_tokens': 2821, 'input_token_details': {'cache_read': 0}}),
              ToolMessage(content='|   sum(amount) |\n|--------------:|\n|       39270.3 |', name='query_duckdb_tool', id='2e418526-1b2d-4c04-a6b5-665329c9ab46', tool_call_id='b0052b61-155b-4e3b-a074-0b997a116f93'),
              ToolMessage(content='|   sum(amount) |\n|--------------:|\n|             3 |', name='query_duckdb_tool', id='82ea668a-491c-46ef-b8a4-b90528ac1657', tool_call_id='fb1de078-cca3-4a89-8542-c4dd2eb6a54c'),
              AIMessage(content='\nThe total expense from account XXXXXXXX6193 in June 2025 is 39270.3 and the total expense from account XXXXXXXX9469 is 3. The combined total expense from both accounts is 39273.3.', additional_kwargs={}, response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []}, id='run--837e1c05-1c87-4358-b47a-7f140ee56b43-0', usage_metadata={'input_tokens': 2872, 'output_tokens': 61, 'total_tokens': 2933, 'input_token_details': {'cache_read': 0}})],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='total amount spent on UPI')}
2025-07-14 07:23:44,881 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 07:23:44,884 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi')] model='gemini:gemini-2.0-flash' validated_query=None
2025-07-14 07:23:44,884 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}], 'validated_query': None}
2025-07-14 07:23:44,900 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e5bb610> default_metadata=() model_kwargs={}
2025-07-14 07:23:44,941 - graph - INFO - 1.Planning Node entered...
2025-07-14 07:23:44,941 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {}
2025-07-14 07:23:44,941 - graph - INFO - 2.Validation Node entered...
2025-07-14 07:23:47,105 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 07:23:47,105 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 07:23:47,105 - graph - INFO - Merged final_query: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: None 
2025-07-14 07:23:47,105 - graph - WARNING - Missing required fields: bank or month or account_no
2025-07-14 07:23:47,106 - graph - INFO - Start routing logic
2025-07-14 07:23:47,106 - graph - INFO - Validated Query Check: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None} ‚Äî Missing: ['bank', 'month', 'account_no']
2025-07-14 07:23:47,106 - graph - INFO - üîÅ Clarify Node: Asking user to fill missing fields.
2025-07-14 07:23:47,107 - graph - INFO - Current state at start of Clarify Node 
{'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='4d91eaaf-9ddb-4600-b3c2-6aa7a39389ba'), AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='3da5ab01-e639-4302-b3b4-e5be1b0ec071'), AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='c1d03d95-c8b1-4d08-9f79-422633fc99cd')], 'plan': "<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint=None), 'confirmed': False}

2025-07-14 07:23:47,107 - graph - INFO - q from state: Intent: None, Bank: None, Account No: None, Month: None, Year: None, Date Range: None Query Hint: None 
2025-07-14 07:23:47,109 - main - INFO - === FINAL STATE ===
{'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='4d91eaaf-9ddb-4600-b3c2-6aa7a39389ba'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='3da5ab01-e639-4302-b3b4-e5be1b0ec071'),
              AIMessage(content='Please provide missing details like bank, month, and account number.', additional_kwargs={}, response_metadata={}, id='c1d03d95-c8b1-4d08-9f79-422633fc99cd'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='923b215c-c209-46d7-9d7c-3407455d0ad0')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint=None)}
2025-07-14 07:24:20,458 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 07:24:20,459 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='ICICI bank, account number is 9469 and month is June')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent=None, bank=None, account_no=None, month=None, year=None, date_range=None, query_hint=None)
2025-07-14 07:24:20,459 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'ICICI bank, account number is 9469 and month is June'}], 'validated_query': {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}}
2025-07-14 07:24:20,463 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e5bb570> default_metadata=() model_kwargs={}
2025-07-14 07:24:20,498 - graph - INFO - 1.Planning Node entered...
2025-07-14 07:24:20,499 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 07:24:20,499 - graph - INFO - 2.Validation Node entered...
2025-07-14 07:24:22,944 - graph - INFO - Existing vq : {'intent': None, 'bank': None, 'account_no': None, 'month': None, 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 07:24:22,945 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': None, 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 07:24:22,946 - graph - INFO - Merged final_query: Intent: None, Bank: ICICI, Account No: XXXXXXXX9469, Month: June, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 07:24:22,946 - graph - INFO - Start routing logic
2025-07-14 07:24:22,946 - graph - INFO - Validated Query Check: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 07:24:22,946 - graph - INFO - Awaiting user confirmation.
2025-07-14 07:24:22,947 - graph - INFO - Confirm node start...
2025-07-14 07:24:22,947 - graph - INFO - user's last message: content='ICICI bank, account number is 9469 and month is June' additional_kwargs={} response_metadata={} id='0a70a4b3-7876-4146-ace9-f13165589184'
2025-07-14 07:24:22,948 - graph - INFO - Start routing logic
2025-07-14 07:24:22,949 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='7826a8c0-c957-46f3-9f83-937734a9096b'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='924c2212-a469-4a67-a626-6725d0a9ffc9'),
              HumanMessage(content='ICICI bank, account number is 9469 and month is June', additional_kwargs={}, response_metadata={}, id='0a70a4b3-7876-4146-ace9-f13165589184'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='a21f4400-d0e7-4600-9b04-0ceb82ec6208'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='9cd56d61-d375-4607-a753-4ca6ca09293c')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 07:25:49,525 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 07:25:49,527 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='ICICI bank, account number is 9469 and month is June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='change the intent to get spending details, also change month to April')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent=None, bank='ICICI', account_no='XXXXXXXX9469', month='June', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 07:25:49,528 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'ICICI bank, account number is 9469 and month is June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'change the intent to get spending details, also change month to April'}], 'validated_query': {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 07:25:49,531 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e508af0> default_metadata=() model_kwargs={}
2025-07-14 07:25:49,565 - graph - INFO - 1.Planning Node entered...
2025-07-14 07:25:49,565 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 07:25:49,566 - graph - INFO - 2.Validation Node entered...
2025-07-14 07:25:51,727 - graph - INFO - Existing vq : {'intent': None, 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'June', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 07:25:51,727 - graph - INFO - vq after - new parsed message from user: {'intent': 'get spending details', 'bank': None, 'account_no': None, 'month': 'April', 'year': None, 'date_range': None, 'query_hint': None}
2025-07-14 07:25:51,728 - graph - INFO - Merged final_query: Intent: get spending details, Bank: ICICI, Account No: XXXXXXXX9469, Month: April, Year: 2025, Date Range: 01-06-2025 to 30-06-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 07:25:51,728 - graph - INFO - Start routing logic
2025-07-14 07:25:51,729 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'April', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 07:25:51,729 - graph - INFO - Awaiting user confirmation.
2025-07-14 07:25:51,730 - graph - INFO - Confirm node start...
2025-07-14 07:25:51,730 - graph - INFO - user's last message: content='change the intent to get spending details, also change month to April' additional_kwargs={} response_metadata={} id='df4ecda6-9be9-4a91-9b84-84e1c12fefa3'
2025-07-14 07:25:51,730 - graph - INFO - Start routing logic
2025-07-14 07:25:51,732 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='13e74430-6df2-4541-8a73-6400aa7533c0'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='52a104ab-9b89-45d5-9a61-1468ba16070d'),
              HumanMessage(content='ICICI bank, account number is 9469 and month is June', additional_kwargs={}, response_metadata={}, id='3623896c-a3b0-4fb0-8266-7c973fabe464'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='c247ee4b-484d-44b3-b3fd-5600f01d7b0f'),
              HumanMessage(content='change the intent to get spending details, also change month to April', additional_kwargs={}, response_metadata={}, id='df4ecda6-9be9-4a91-9b84-84e1c12fefa3'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='2da411a1-77e1-4687-8e54-b11c4297752b'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: April\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='41a756ae-1f2f-4ed0-803c-1650e7e184f2')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='April', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
2025-07-14 07:27:16,497 - main - INFO - 
============================================================ START RUN ============================================================
2025-07-14 07:27:16,499 - main - INFO - ***Incoming Request: messages=[Message(role='user', content='hi'), Message(role='ai', content=' To proceed, could you specify your bank and account_number and month?'), Message(role='user', content='ICICI bank, account number is 9469 and month is June'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='change the intent to get spending details, also change month to April'), Message(role='ai', content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: April\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"), Message(role='user', content='change bank to SBI and month to may also change the date_range as per the month')] model='gemini:gemini-2.0-flash' validated_query=QueryInfo(intent='get spending details', bank='ICICI', account_no='XXXXXXXX9469', month='April', year='2025', date_range='01-06-2025 to 30-06-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')
2025-07-14 07:27:16,500 - main - INFO - created state variable: 
 {'messages': [{'role': 'user', 'content': 'hi'}, {'role': 'ai', 'content': ' To proceed, could you specify your bank and account_number and month?'}, {'role': 'user', 'content': 'ICICI bank, account number is 9469 and month is June'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'change the intent to get spending details, also change month to April'}, {'role': 'ai', 'content': "‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: April\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?"}, {'role': 'user', 'content': 'change bank to SBI and month to may also change the date_range as per the month'}], 'validated_query': {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'April', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}}
2025-07-14 07:27:16,512 - graph - INFO - Selected Model: model='models/gemini-2.0-flash' google_api_key=SecretStr('**********') client=<google.ai.generativelanguage_v1beta.services.generative_service.client.GenerativeServiceClient object at 0x11e50bb10> default_metadata=() model_kwargs={}
2025-07-14 07:27:16,555 - graph - INFO - 1.Planning Node entered...
2025-07-14 07:27:16,556 - graph - INFO - Before returning from Planning Node...
 Merged Query:: {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'April', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 07:27:16,556 - graph - INFO - 2.Validation Node entered...
2025-07-14 07:27:17,630 - graph - INFO - Existing vq : {'intent': 'get spending details', 'bank': 'ICICI', 'account_no': 'XXXXXXXX9469', 'month': 'April', 'year': '2025', 'date_range': '01-06-2025 to 30-06-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'}
2025-07-14 07:27:17,630 - graph - INFO - vq after - new parsed message from user: {'intent': None, 'bank': 'SBI', 'account_no': None, 'month': 'May', 'year': None, 'date_range': '01-05-2025 to 31-05-2025', 'query_hint': None}
2025-07-14 07:27:17,630 - graph - INFO - Merged final_query: Intent: get spending details, Bank: SBI, Account No: XXXXXXXX9469, Month: May, Year: 2025, Date Range: 01-05-2025 to 31-05-2025 Query Hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469 
2025-07-14 07:27:17,630 - graph - INFO - Start routing logic
2025-07-14 07:27:17,630 - graph - INFO - Validated Query Check: {'intent': 'get spending details', 'bank': 'SBI', 'account_no': 'XXXXXXXX9469', 'month': 'May', 'year': '2025', 'date_range': '01-05-2025 to 31-05-2025', 'query_hint': 'subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469'} ‚Äî Missing: []
2025-07-14 07:27:17,630 - graph - INFO - Awaiting user confirmation.
2025-07-14 07:27:17,631 - graph - INFO - Confirm node start...
2025-07-14 07:27:17,631 - graph - INFO - user's last message: content='change bank to SBI and month to may also change the date_range as per the month' additional_kwargs={} response_metadata={} id='4fa2d4ae-1b1c-4720-95f4-69e431a9251d'
2025-07-14 07:27:17,631 - graph - INFO - Start routing logic
2025-07-14 07:27:17,632 - main - INFO - === FINAL STATE ===
{'awaiting_confirmation': True,
 'confirmed': False,
 'messages': [HumanMessage(content='hi', additional_kwargs={}, response_metadata={}, id='d3922594-0928-4a50-95c8-552ec8400ccf'),
              AIMessage(content=' To proceed, could you specify your bank and account_number and month?', additional_kwargs={}, response_metadata={}, id='cf2b7c81-5abd-474a-8725-f9dee729ae6c'),
              HumanMessage(content='ICICI bank, account number is 9469 and month is June', additional_kwargs={}, response_metadata={}, id='e5f79f14-e4b2-44bf-a359-66af7c14bee0'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: None\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: June\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='e20eaff0-00fc-474e-bdeb-144cfde8e21a'),
              HumanMessage(content='change the intent to get spending details, also change month to April', additional_kwargs={}, response_metadata={}, id='5d9dfffc-351e-44a2-8256-c9a109dc2287'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: ICICI\naccount_no: XXXXXXXX9469\nmonth: April\nyear: 2025\ndate_range: 01-06-2025 to 30-06-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ff410698-d607-450c-a25f-c67072feed5b'),
              HumanMessage(content='change bank to SBI and month to may also change the date_range as per the month', additional_kwargs={}, response_metadata={}, id='4fa2d4ae-1b1c-4720-95f4-69e431a9251d'),
              AIMessage(content="<plan>\n1. Understand the user's intent from the query.\n2. Check DuckDB for relevant finance data.\n3. If not found, fetch bank statements from Gmail.\n4. Decrypt and extract transactions.\n5. Store in database if needed.\n6. Generate final answer using all context.\n</plan>", additional_kwargs={}, response_metadata={}, id='9fa605c7-947b-4647-8886-d1a10f95b592'),
              AIMessage(content="‚úÖ Got it! Here's what I know:\nintent: get spending details\nbank: SBI\naccount_no: XXXXXXXX9469\nmonth: May\nyear: 2025\ndate_range: 01-05-2025 to 31-05-2025\nquery_hint: subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469\n\nDo you want to proceed ?", additional_kwargs={}, response_metadata={}, id='ea49cd64-a5d9-4e1d-bf43-bef37e140a24')],
 'plan': '<plan>\n'
         "1. Understand the user's intent from the query.\n"
         '2. Check DuckDB for relevant finance data.\n'
         '3. If not found, fetch bank statements from Gmail.\n'
         '4. Decrypt and extract transactions.\n'
         '5. Store in database if needed.\n'
         '6. Generate final answer using all context.\n'
         '</plan>',
 'validated_query': QueryInfo(intent='get spending details', bank='SBI', account_no='XXXXXXXX9469', month='May', year='2025', date_range='01-05-2025 to 31-05-2025', query_hint='subject:ICICI Bank Statement from 01-06-2025 to 30-06-2025 for XXXXXXXX9469')}
